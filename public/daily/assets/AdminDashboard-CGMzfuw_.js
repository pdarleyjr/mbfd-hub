import{r as reactExports,j as jsxRuntimeExports,R as React,g as getAugmentedNamespace,u as useNavigate}from"./index-CTqLvJ19.js";import{c as createLucideIcon,f as fetchInventory,g as fetchTasks,h as updateTask,u as useApparatusStatus,B as Button,C as Card,a as CardContent,i as generateAIInsights,j as fetchAIInsights,A as APPARATUS_LIST,k as formatDateTime,l as fetchVehicleChangeRequests,r as reviewVehicleChangeRequest,s as submitVehicleChangeRequest,d as CardHeader,W as WORKER_URL,m as markTasksViewed}from"./useApparatusStatus-D3iYQgib.js";import{T as TriangleAlert,b as CircleCheckBig,g as githubService,M as Modal,X,U as Upload,a as Calendar,C as Check}from"./github-DwNqGJYJ.js";const __iconNode$s=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Activity=createLucideIcon("activity",__iconNode$s);const __iconNode$r=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ArrowDown=createLucideIcon("arrow-down",__iconNode$r);const __iconNode$q=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ArrowLeft=createLucideIcon("arrow-left",__iconNode$q);const __iconNode$p=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],ArrowUp=createLucideIcon("arrow-up",__iconNode$p);const __iconNode$o=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Brain=createLucideIcon("brain",__iconNode$o);const __iconNode$n=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],CircleAlert=createLucideIcon("circle-alert",__iconNode$n);const __iconNode$m=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],CircleX=createLucideIcon("circle-x",__iconNode$m);const __iconNode$l=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ClipboardList=createLucideIcon("clipboard-list",__iconNode$l);const __iconNode$k=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Clock=createLucideIcon("clock",__iconNode$k);const __iconNode$j=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],FileUp=createLucideIcon("file-up",__iconNode$j);const __iconNode$i=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],House=createLucideIcon("house",__iconNode$i);const __iconNode$h=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Image$1=createLucideIcon("image",__iconNode$h);const __iconNode$g=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Lightbulb=createLucideIcon("lightbulb",__iconNode$g);const __iconNode$f=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],List=createLucideIcon("list",__iconNode$f);const __iconNode$e=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Loader=createLucideIcon("loader",__iconNode$e);const __iconNode$d=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Lock=createLucideIcon("lock",__iconNode$d);const __iconNode$c=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Mail=createLucideIcon("mail",__iconNode$c);const __iconNode$b=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Menu=createLucideIcon("menu",__iconNode$b);const __iconNode$a=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Package=createLucideIcon("package",__iconNode$a);const __iconNode$9=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Pen=createLucideIcon("pen",__iconNode$9);const __iconNode$8=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Plus=createLucideIcon("plus",__iconNode$8);const __iconNode$7=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],RefreshCw=createLucideIcon("refresh-cw",__iconNode$7);const __iconNode$6=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Save=createLucideIcon("save",__iconNode$6);const __iconNode$5=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Search=createLucideIcon("search",__iconNode$5);const __iconNode$4=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Sparkles=createLucideIcon("sparkles",__iconNode$4);const __iconNode$3=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Trash2=createLucideIcon("trash-2",__iconNode$3);const __iconNode$2=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],TrendingUp=createLucideIcon("trending-up",__iconNode$2);const __iconNode$1=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],Truck=createLucideIcon("truck",__iconNode$1);const __iconNode=[["path",{d:"M18 21V10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v11",key:"pb2vm6"}],["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 1.132-1.803l7.95-3.974a2 2 0 0 1 1.837 0l7.948 3.974A2 2 0 0 1 22 8z",key:"doq5xv"}],["path",{d:"M6 13h12",key:"yf64js"}],["path",{d:"M6 17h12",key:"1jwigz"}]],Warehouse=createLucideIcon("warehouse",__iconNode);function useInventory(){const[D,i]=reactExports.useState([]),[R,o]=reactExports.useState(!1),[f,I]=reactExports.useState(null),[A,T]=reactExports.useState(null),P=reactExports.useCallback(async()=>{o(!0),I(null);try{const n=await fetchInventory();i(n.items),T(n.fetchedAt)}catch(n){const t=n instanceof Error?n.message:"Failed to load inventory";I(t),console.error("Error loading inventory:",n)}finally{o(!1)}},[]);return reactExports.useEffect(()=>{P()},[P]),{items:D,isLoading:R,error:f,lastFetchedAt:A,refresh:P}}function useSupplyTasks(D="pending"){const[i,R]=reactExports.useState([]),[o,f]=reactExports.useState(!1),[I,A]=reactExports.useState(null),[T,P]=reactExports.useState(0),n=reactExports.useCallback(async()=>{f(!0),A(null);try{const a=await fetchTasks(D);R(a.tasks),P(a.count)}catch(a){const c=a instanceof Error?a.message:"Failed to load tasks";A(c),console.error("Error loading tasks:",a)}finally{f(!1)}},[D]),t=reactExports.useCallback(async(a,c,e,d)=>{try{await updateTask(a,{status:"completed",chosenReplacement:c,completedBy:e,notes:d}),await n()}catch(m){throw m}},[n]),s=reactExports.useCallback(async(a,c)=>{try{await updateTask(a,{status:"canceled",notes:c}),await n()}catch(e){throw e}},[n]);return reactExports.useEffect(()=>{n()},[n]),{tasks:i,isLoading:o,error:I,count:T,refresh:n,completeTask:t,cancelTask:s}}const DashboardHome=({adminPassword:D})=>{const[i,R]=reactExports.useState(!0),[o,f]=reactExports.useState(!1),[I,A]=reactExports.useState(null),[T,P]=reactExports.useState([]),[n,t]=reactExports.useState(0),[s,a]=reactExports.useState([]),[c,e]=reactExports.useState(null),[d,m]=reactExports.useState(null),{items:r,isLoading:b}=useInventory(),{tasks:w,isLoading:j}=useSupplyTasks("pending"),{allVehicles:p,loading:g}=useApparatusStatus(),[M,O]=reactExports.useState({totalDefects:0,criticalIssues:0,pendingTasks:0,outOfServiceVehicles:0,lowStockItems:0,todaySubmissions:0}),_=async(K=!0)=>{K?R(!0):f(!0);try{await H(),await z(),et(),A(new Date)}catch(nt){console.error("Error loading dashboard data:",nt)}finally{R(!1),f(!1)}},H=async()=>{try{const K=await githubService.getAllDefects();console.log("ðŸ  Dashboard Home: Loaded defects from API:",K.length,K),a(K);const nt=[],J=K.filter(k=>k.status==="missing");J.length>0&&nt.push({text:`${J.length} critical item${J.length!==1?"s":""} missing across the fleet - immediate action required`,type:"critical"});const L=K.filter(k=>k.status==="damaged");L.length>0&&nt.push({text:`${L.length} damaged item${L.length!==1?"s":""} requiring repair or replacement`,type:"warning"});const y=new Map;K.forEach(k=>{y.set(k.apparatus,(y.get(k.apparatus)||0)+1)});const h=Array.from(y.entries()).filter(([k,N])=>N>=3).sort((k,N)=>N[1]-k[1]);if(h.length>0){const[k,N]=h[0];nt.push({text:`${k} has ${N} open issues - prioritize for comprehensive inspection`,type:"warning"})}const u=y.size,E=Math.max(0,100-u*7-K.length*2);t(E),console.log("ðŸ  Dashboard Home: Fleet health score:",E),E>=90&&K.length===0?nt.push({text:`Fleet operating at optimal condition with ${E}% health score`,type:"positive"}):E>=90&&nt.push({text:`Fleet health score: ${E}% - minor issues detected but overall good condition`,type:"info"}),P(nt),console.log("ðŸ  Dashboard Home: Generated insights:",nt)}catch(K){console.error("Error loading fleet data:",K),P([{text:"Unable to load fleet data. Please refresh or check your connection.",type:"warning"}])}},z=async()=>{try{const K=await fetchAIInsights();if(K.insights&&K.insights.length>0){const nt=K.insights[0];e(nt);try{const J=JSON.parse(nt.insight_json);m(J)}catch(J){console.error("Failed to parse inventory insights:",J),m(null)}}else e(null),m(null)}catch(K){console.error("Error loading inventory insights:",K),e(null),m(null)}},st=async()=>{f(!0);try{await generateAIInsights({tasks:w,inventory:r}),await _(!1)}catch(K){console.error("Error re-analyzing:",K),alert("Failed to re-analyze data. Please try again.")}finally{f(!1)}},et=()=>{const K=s.filter(L=>L.status==="missing").length,nt=p.filter(L=>L.status.toLowerCase().includes("out of service")).length,J=new Set(w.filter(L=>L.deficiencyType==="missing").map(L=>L.itemName)).size;O({totalDefects:s.length,criticalIssues:K,pendingTasks:w.length,outOfServiceVehicles:nt,lowStockItems:J,todaySubmissions:0})};return reactExports.useEffect(()=>{D&&!b&&!j&&!g&&_()},[D,b,j,g]),reactExports.useEffect(()=>{!i&&s.length>=0&&et()},[s,w,p]),i?jsxRuntimeExports.jsxs("div",{className:"py-12 text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 animate-pulse",children:jsxRuntimeExports.jsx(Brain,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Loading Dashboard"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Gathering fleet data and AI insights..."})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[jsxRuntimeExports.jsx(Brain,{className:"w-7 h-7 lg:w-8 lg:h-8 text-blue-600"}),"AI-Powered Fleet Overview"]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Real-time insights powered by AI â€¢ ",I?`Updated ${I.toLocaleTimeString()}`:"Loading..."]})]}),jsxRuntimeExports.jsxs(Button,{onClick:st,disabled:o,variant:"secondary",className:"flex items-center gap-2 whitespace-nowrap",children:[jsxRuntimeExports.jsx(RefreshCw,{className:`w-4 h-4 ${o?"animate-spin":""}`}),o?"Re-Analyzing...":"Re-Analyze"]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 sm:gap-4",children:[jsxRuntimeExports.jsx(Card,{className:"border-blue-300 bg-gradient-to-br from-blue-50 to-blue-100",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-5 h-5 text-blue-600"}),jsxRuntimeExports.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[n,"%"]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-blue-900",children:"Fleet Health"})]})}),jsxRuntimeExports.jsx(Card,{className:`border-${M.criticalIssues>0?"red":"green"}-300 bg-gradient-to-br from-${M.criticalIssues>0?"red":"green"}-50 to-${M.criticalIssues>0?"red":"green"}-100`,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:`w-5 h-5 text-${M.criticalIssues>0?"red":"green"}-600`}),jsxRuntimeExports.jsx("span",{className:`text-2xl font-bold text-${M.criticalIssues>0?"red":"green"}-600`,children:M.criticalIssues})]}),jsxRuntimeExports.jsx("p",{className:`text-xs font-semibold text-${M.criticalIssues>0?"red":"green"}-900`,children:"Critical Issues"})]})}),jsxRuntimeExports.jsx(Card,{className:"border-orange-300 bg-gradient-to-br from-orange-50 to-orange-100",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5 text-orange-600"}),jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-orange-600",children:M.totalDefects})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-orange-900",children:"Total Issues"})]})}),jsxRuntimeExports.jsx(Card,{className:"border-purple-300 bg-gradient-to-br from-purple-50 to-purple-100",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx(Activity,{className:"w-5 h-5 text-purple-600"}),jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-purple-600",children:M.pendingTasks})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-purple-900",children:"Pending Tasks"})]})}),jsxRuntimeExports.jsx(Card,{className:"border-yellow-300 bg-gradient-to-br from-yellow-50 to-yellow-100",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx(Package,{className:"w-5 h-5 text-yellow-600"}),jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-yellow-600",children:M.lowStockItems})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-yellow-900",children:"Low Stock Items"})]})}),jsxRuntimeExports.jsx(Card,{className:"border-gray-300 bg-gradient-to-br from-gray-50 to-gray-100",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx(Truck,{className:"w-5 h-5 text-gray-600"}),jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-gray-600",children:M.outOfServiceVehicles})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Out of Service"})]})})]}),T.length>0&&jsxRuntimeExports.jsx(Card,{className:"border-blue-300",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Brain,{className:"w-6 h-6 text-blue-600"}),"AI Fleet Insights - Priority Alerts"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:T.map((K,nt)=>{const L={critical:{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"},warning:{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:"text-yellow-600"},positive:{bg:"bg-green-50",border:"border-green-200",text:"text-green-800",icon:"text-green-600"},info:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"}}[K.type],y=K.type==="critical"||K.type==="warning"?TriangleAlert:K.type==="positive"?CircleCheckBig:TrendingUp;return jsxRuntimeExports.jsxs("div",{className:`flex items-start gap-3 p-4 ${L.bg} rounded-lg border ${L.border}`,children:[jsxRuntimeExports.jsx(y,{className:`w-5 h-5 ${L.icon} flex-shrink-0 mt-0.5`}),jsxRuntimeExports.jsx("p",{className:`text-sm font-medium ${L.text} flex-1`,children:K.text})]},nt)})})]})}),d&&jsxRuntimeExports.jsx(Card,{className:"border-green-300",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Package,{className:"w-6 h-6 text-green-600"}),"Inventory Intelligence"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[d.summary&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-blue-900",children:d.summary})}),d.reorderSuggestions&&d.reorderSuggestions.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Lightbulb,{className:"w-5 h-5 text-green-600"}),"Recommended Actions"]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.reorderSuggestions.slice(0,4).map((K,nt)=>jsxRuntimeExports.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-green-900 text-sm truncate",children:K.item}),jsxRuntimeExports.jsx("p",{className:"text-green-700 text-xs mt-1",children:K.reason})]}),jsxRuntimeExports.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold whitespace-nowrap ${K.urgency?.toLowerCase()==="high"?"bg-red-100 text-red-800":K.urgency?.toLowerCase()==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:K.urgency||"Low"})]})},nt))})]}),d.recurringIssues&&d.recurringIssues.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 rounded",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-orange-900 mb-2",children:"âš ï¸ Recurring Issues"}),jsxRuntimeExports.jsx("ul",{className:"space-y-1",children:d.recurringIssues.slice(0,3).map((K,nt)=>jsxRuntimeExports.jsxs("li",{className:"text-sm text-orange-800",children:["â€¢ ",K]},nt))})]})]}),c&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500 mt-4 pt-4 border-t border-gray-200",children:["Generated: ",new Date(c.created_at).toLocaleString()]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Quick Actions"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[jsxRuntimeExports.jsxs(Button,{onClick:()=>window.location.hash="#/admin?tab=fleet",variant:"secondary",className:"w-full justify-start",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-4 h-4 mr-2"}),"View All Issues"]}),jsxRuntimeExports.jsxs(Button,{onClick:()=>window.location.hash="#/admin?tab=inventory",variant:"secondary",className:"w-full justify-start",children:[jsxRuntimeExports.jsx(Package,{className:"w-4 h-4 mr-2"}),"Manage Inventory"]}),jsxRuntimeExports.jsxs(Button,{onClick:()=>window.location.hash="#/admin?tab=apparatus-status",variant:"secondary",className:"w-full justify-start",children:[jsxRuntimeExports.jsx(Truck,{className:"w-4 h-4 mr-2"}),"Fleet Status"]}),jsxRuntimeExports.jsxs(Button,{onClick:st,disabled:o,className:"w-full justify-start",children:[jsxRuntimeExports.jsx(RefreshCw,{className:`w-4 h-4 mr-2 ${o?"animate-spin":""}`}),"Refresh Data"]})]})]})}),T.length===0&&!d&&jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Fleet Operating Optimally"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"No critical issues or actionable insights at this time."}),jsxRuntimeExports.jsxs(Button,{onClick:st,variant:"secondary",className:"mt-4",children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 mr-2"}),"Refresh Analysis"]})]})})]})},AIFleetInsights=({adminPassword:D,onCriticalAlertCount:i})=>{const[R,o]=reactExports.useState(null),[f,I]=reactExports.useState(!1),[A,T]=reactExports.useState(null),[P,n]=reactExports.useState("week"),[t,s]=reactExports.useState("all"),a=async()=>{if(!D){T("Admin authentication required");return}I(!0),T(null);try{const e=t==="all"?void 0:t,d=await githubService.getAIInsights(D,P,e);o(d);const m=d.insights.filter(r=>r.toLowerCase().includes("critical")||r.toLowerCase().includes("immediate")||r.toLowerCase().includes("urgent")).length;i&&i(m)}catch(e){console.error("Error loading AI insights:",e),T(e.message||"Failed to load AI insights")}finally{I(!1)}},c=(e,d)=>{const m=e.toLowerCase().includes("critical")||e.toLowerCase().includes("urgent"),r=e.toLowerCase().includes("warning")||e.toLowerCase().includes("attention"),b=e.toLowerCase().includes("good")||e.toLowerCase().includes("excellent")||e.toLowerCase().includes("optimal");let w="bg-blue-50",j="border-blue-200",p="text-blue-800",g=jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5 text-blue-600"});return m?(w="bg-red-50",j="border-red-200",p="text-red-800",g=jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-red-600"})):r?(w="bg-yellow-50",j="border-yellow-200",p="text-yellow-800",g=jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-yellow-600"})):b&&(w="bg-green-50",j="border-green-200",p="text-green-800",g=jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5 text-green-600"})),jsxRuntimeExports.jsxs("div",{className:`flex items-start gap-3 p-4 ${w} rounded-lg border ${j}`,children:[g,jsxRuntimeExports.jsx("p",{className:`text-sm font-medium ${p} flex-1`,children:e})]},d)};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Brain,{className:"w-7 h-7 text-blue-600"}),"Fleet Insights - AI Analysis"]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-4 h-4 text-purple-600"}),"Powered by Cloudflare Workers AI (Llama 3 8B)"]})]}),jsxRuntimeExports.jsxs(Button,{onClick:a,disabled:f,variant:"secondary",className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(RefreshCw,{className:`w-4 h-4 ${f?"animate-spin":""}`}),"Refresh Analysis"]})]}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Analysis Timeframe"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:[{value:"week",label:"Last Week"},{value:"month",label:"Last Month"},{value:"all",label:"All Time"}].map(({value:e,label:d})=>jsxRuntimeExports.jsx("button",{onClick:()=>n(e),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${P===e?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:d},e))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Filter by Apparatus"}),jsxRuntimeExports.jsxs("select",{value:t,onChange:e=>s(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[jsxRuntimeExports.jsx("option",{value:"all",children:"All Apparatus"}),APPARATUS_LIST.map(e=>jsxRuntimeExports.jsx("option",{value:e,children:e},e))]})]})]}),jsxRuntimeExports.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:jsxRuntimeExports.jsxs(Button,{onClick:a,disabled:f,className:"w-full md:w-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx(Brain,{className:"w-5 h-5"}),f?"Analyzing Fleet...":"Analyze Fleet"]})})]})}),f&&jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsx(CardContent,{className:"py-12",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 animate-pulse",children:jsxRuntimeExports.jsx(Sparkles,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"AI Analysis in Progress"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Analyzing inspection data and generating insights..."}),jsxRuntimeExports.jsx("div",{className:"mt-4 w-48 h-2 bg-gray-200 rounded-full mx-auto overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-600 animate-pulse"})})]})})}),A&&!f&&jsxRuntimeExports.jsx(Card,{className:"border-red-300",children:jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-1"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-red-900 mb-2",children:"Analysis Unavailable"}),jsxRuntimeExports.jsx("p",{className:"text-red-700 text-sm mb-4",children:A}),A.includes("503")||A.includes("enabled")?jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-sm text-red-800",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold mb-2",children:"AI service is temporarily unavailable."}),jsxRuntimeExports.jsx("p",{children:"This could be due to:"}),jsxRuntimeExports.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[jsxRuntimeExports.jsx("li",{children:"Cloudflare Workers AI service maintenance"}),jsxRuntimeExports.jsx("li",{children:"AI features not configured in the worker"}),jsxRuntimeExports.jsx("li",{children:"Network connectivity issues"})]}),jsxRuntimeExports.jsx("p",{className:"mt-3 font-medium",children:"You can still view raw data in other dashboard tabs."})]}):jsxRuntimeExports.jsx(Button,{onClick:a,variant:"secondary",children:"Try Again"})]})]})})}),!R&&!f&&!A&&jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(Brain,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Analysis Data"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:"No inspection data available for this timeframe."}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Try expanding the timeframe or checking other apparatus."})]})}),R&&!f&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(Card,{className:"border-blue-300 bg-gradient-to-br from-blue-50 to-purple-50",children:jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 p-3 rounded-full",children:jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6 text-white"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Analysis Summary"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Data Points"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-blue-600",children:R.dataPoints})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Timeframe"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900 capitalize",children:R.timeframe})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Apparatus"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:R.apparatus||"All"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Insights Found"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-purple-600",children:R.insights.length})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:["Generated at: ",new Date(R.generatedAt).toLocaleString()]})]})]})})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-orange-600"}),"AI-Generated Insights"]}),R.insights.length>0?jsxRuntimeExports.jsx("div",{className:"space-y-3",children:R.insights.map((e,d)=>c(e,d))}):jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Fleet Operating Optimally"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-2",children:"AI analysis found no issues or recommendations at this time."})]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Package,{className:"w-5 h-5 text-green-600"}),"Fleet Health Score"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Overall Fleet Health"}),jsxRuntimeExports.jsxs("span",{className:`text-lg font-bold ${R.dataPoints>0?"text-green-600":"text-gray-500"}`,children:[R.dataPoints>0?Math.max(70,100-R.insights.length*5):0,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:jsxRuntimeExports.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 transition-all duration-500",style:{width:`${R.dataPoints>0?Math.max(70,100-R.insights.length*5):0}%`}})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Critical"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-red-600",children:R.insights.filter(e=>e.toLowerCase().includes("critical")).length})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Warnings"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:R.insights.filter(e=>e.toLowerCase().includes("warning")).length})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Recommendations"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-blue-600",children:R.insights.filter(e=>!e.toLowerCase().includes("critical")&&!e.toLowerCase().includes("warning")).length})]})]})]})]})})]})]})},SupplyListPanel=({items:D,isLoading:i,error:R,onRefresh:o})=>{const[f,I]=reactExports.useState(""),[A,T]=reactExports.useState("name"),[P,n]=reactExports.useState("asc"),t=reactExports.useMemo(()=>{let a=D;if(f){const c=f.toLowerCase();a=a.filter(e=>e.equipmentName.toLowerCase().includes(c)||e.equipmentType.toLowerCase().includes(c)||e.location?.toLowerCase().includes(c)||e.description?.toLowerCase().includes(c))}return a=[...a].sort((c,e)=>{let d=0;switch(A){case"name":d=c.equipmentName.localeCompare(e.equipmentName);break;case"quantity":d=c.quantity-e.quantity;break;case"location":d=(c.location||"").localeCompare(e.location||"");break}return P==="asc"?d:-d}),a},[D,f,A,P]),s=a=>{A===a?n(P==="asc"?"desc":"asc"):(T(a),n("asc"))};return R?jsxRuntimeExports.jsx(Card,{className:"border-red-300",children:jsxRuntimeExports.jsxs(CardContent,{className:"py-8 text-center",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error Loading Inventory"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm mb-4",children:R}),jsxRuntimeExports.jsx(Button,{onClick:o,variant:"secondary",children:"Try Again"})]})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 z-10 bg-white rounded-lg shadow-sm border border-gray-200 p-4 space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"relative flex-1",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search inventory...",value:f,onChange:a=>I(a.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-base"})]}),jsxRuntimeExports.jsx(Button,{onClick:o,variant:"secondary",className:"flex-shrink-0 min-w-[44px] min-h-[44px] flex items-center justify-center",disabled:i,"aria-label":"Refresh inventory",children:jsxRuntimeExports.jsx(RefreshCw,{className:`w-5 h-5 ${i?"animate-spin":""}`})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 flex-wrap",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>s("name"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${A==="name"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Name ",A==="name"&&(P==="asc"?"â†‘":"â†“")]}),jsxRuntimeExports.jsxs("button",{onClick:()=>s("quantity"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${A==="quantity"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Quantity ",A==="quantity"&&(P==="asc"?"â†‘":"â†“")]}),jsxRuntimeExports.jsxs("button",{onClick:()=>s("location"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${A==="location"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Location ",A==="location"&&(P==="asc"?"â†‘":"â†“")]})]})]}),i?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading inventory..."})]}):t.length===0?jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:f?"No items found":"No inventory items"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-1",children:f?"Try adjusting your search terms":"Inventory list is empty"})]})}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:t.map(a=>{const c=a.minQty&&a.quantity<=a.minQty;return jsxRuntimeExports.jsx(Card,{className:`hover:shadow-md transition-shadow ${c?"border-orange-300":""}`,children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(Package,{className:`w-5 h-5 flex-shrink-0 ${c?"text-orange-600":"text-blue-600"}`}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-900 truncate",children:a.equipmentName}),c&&jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-orange-600 flex-shrink-0"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 text-sm",children:[jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Type:"})," ",a.equipmentType]}),a.location&&jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Location:"})," ",a.location," (Shelf ",a.shelf,", Row ",a.row,")"]}),a.manufacturer&&jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Mfg:"})," ",a.manufacturer]}),a.description&&jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-xs mt-2 line-clamp-2",children:a.description})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 text-right",children:[jsxRuntimeExports.jsx("div",{className:`text-3xl font-bold ${c?"text-orange-600":"text-blue-600"}`,children:a.quantity}),jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a.minQty?`Min: ${a.minQty}`:"in stock"}),c&&jsxRuntimeExports.jsx("div",{className:"text-xs font-semibold text-orange-600 mt-1",children:"LOW STOCK"})]})]})})},a.id)})}),!i&&t.length>0&&jsxRuntimeExports.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:["Showing ",t.length," of ",D.length," items"]})]})},TasksPanel=()=>{const[D,i]=reactExports.useState("pending"),{tasks:R,isLoading:o,error:f,completeTask:I,cancelTask:A,refresh:T}=useSupplyTasks(D),[P,n]=reactExports.useState(null),t=async(a,c)=>{if(confirm(`Mark "${c}" task as completed?`)){n(a);try{await I(a,void 0,"Admin","Completed from dashboard"),alert("Task marked as completed successfully")}catch(e){alert(`Error: ${e instanceof Error?e.message:"Failed to complete task"}`)}finally{n(null)}}},s=async(a,c)=>{const e=prompt(`Cancel "${c}" task? Enter reason (optional):`);if(e!==null){n(a);try{await A(a,e||"Canceled from dashboard"),alert("Task canceled successfully")}catch(d){alert(`Error: ${d instanceof Error?d.message:"Failed to cancel task"}`)}finally{n(null)}}};return f?jsxRuntimeExports.jsx(Card,{className:"border-red-300",children:jsxRuntimeExports.jsxs(CardContent,{className:"py-8 text-center",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error Loading Tasks"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm mb-4",children:f}),jsxRuntimeExports.jsx(Button,{onClick:T,variant:"secondary",children:"Try Again"})]})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-2 border-b border-gray-200 overflow-x-auto",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>i("pending"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${D==="pending"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Clock,{className:"w-5 h-5"}),"Pending"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>i("completed"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${D==="completed"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5"}),"Completed"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>i("canceled"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${D==="canceled"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(CircleX,{className:"w-5 h-5"}),"Canceled"]})]}),o?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading tasks..."})]}):R.length===0?jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),jsxRuntimeExports.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["No ",D," tasks"]}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-1",children:D==="pending"?"All supply tasks are up to date":`No tasks have been ${D}`})]})}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:R.map(a=>jsxRuntimeExports.jsx(Card,{className:"hover:shadow-md transition-shadow",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:a.apparatus}),jsxRuntimeExports.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${a.deficiencyType==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:a.deficiencyType==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:a.itemName}),a.compartment&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["Compartment: ",a.compartment]})]}),D==="pending"&&jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx(Clock,{className:"w-6 h-6 text-orange-600"})}),D==="completed"&&jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-6 h-6 text-green-600"})}),D==="canceled"&&jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx(CircleX,{className:"w-6 h-6 text-gray-600"})})]}),jsxRuntimeExports.jsxs("div",{className:"text-sm space-y-1",children:[jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Created by:"})," ",a.createdBy]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Created:"})," ",formatDateTime(a.createdAt)]}),a.completedBy&&a.completedAt&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Completed by:"})," ",a.completedBy]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Completed:"})," ",formatDateTime(a.completedAt)]})]}),a.notes&&jsxRuntimeExports.jsxs("p",{className:"text-gray-700 bg-gray-50 p-2 rounded mt-2",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Notes:"})," ",a.notes]})]}),D==="pending"&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2 pt-2",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>t(a.id,a.itemName),variant:"primary",size:"sm",className:"flex-1 min-h-[44px]",disabled:P===a.id,children:P===a.id?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4 mr-2"}),"Mark Complete"]})}),jsxRuntimeExports.jsxs(Button,{onClick:()=>s(a.id,a.itemName),variant:"secondary",size:"sm",className:"flex-1 min-h-[44px] bg-red-50 hover:bg-red-100 text-red-700",disabled:P===a.id,children:[jsxRuntimeExports.jsx(CircleX,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})})},a.id))}),!o&&R.length>0&&jsxRuntimeExports.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:[R.length," ",D," task",R.length!==1?"s":""]})]})},SuggestionsPanel=()=>{const{tasks:D,isLoading:i}=useSupplyTasks("pending"),{items:R,isLoading:o}=useInventory(),f=i||o,I=React.useMemo(()=>D.map(A=>{const T=[];if(A.suggestedReplacements&&A.suggestedReplacements.length>0)return{task:A,suggestions:A.suggestedReplacements.map(n=>({...n,inStock:n.qtyOnHand>0}))};const P=A.itemName.toLowerCase();return R.forEach(n=>{const t=n.equipmentName.toLowerCase(),s=n.equipmentType.toLowerCase();let a=0;t.includes(P)||P.includes(t)?a=.8:(s.includes(P)||P.includes(s))&&(a=.6),a>0&&T.push({itemId:n.id,itemName:n.equipmentName,qtyOnHand:n.quantity,location:n.location,confidence:a,inStock:n.quantity>0})}),T.sort((n,t)=>n.inStock&&!t.inStock?-1:!n.inStock&&t.inStock?1:(t.confidence||0)-(n.confidence||0)),{task:A,suggestions:T.slice(0,3)}}),[D,R]);return f?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading suggestions..."})]}):D.length===0?jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(Lightbulb,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Pending Tasks"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-1",children:"Suggestions will appear when there are pending supply tasks"})]})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Lightbulb,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-900 font-semibold",children:"Inventory Suggestions"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800 mt-1",children:"Suggested replacements from inventory for pending tasks. Match confidence and stock availability shown."})]})]})}),I.map(({task:A,suggestions:T})=>jsxRuntimeExports.jsx(Card,{className:"hover:shadow-md transition-shadow",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:A.apparatus}),jsxRuntimeExports.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${A.deficiencyType==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:A.deficiencyType==="missing"?"Missing":"Damaged"})]}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-900",children:A.itemName}),A.compartment&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["Compartment: ",A.compartment]})]}),T.length===0?jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-center",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-6 h-6 text-gray-400 mx-auto mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"No matching items found in inventory"})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Suggested Replacements:"}),T.map((P,n)=>jsxRuntimeExports.jsx("div",{className:`p-3 rounded-lg border-2 ${P.inStock?"bg-green-50 border-green-300":"bg-gray-50 border-gray-300"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx(Package,{className:`w-4 h-4 ${P.inStock?"text-green-600":"text-gray-400"}`}),jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:P.itemName})]}),P.location&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-600",children:["Location: ",P.location]}),P.confidence&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Match: ",Math.round(P.confidence*100),"%"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 text-right",children:[jsxRuntimeExports.jsx("div",{className:`text-2xl font-bold ${P.inStock?"text-green-600":"text-gray-400"}`,children:P.qtyOnHand}),jsxRuntimeExports.jsx("div",{className:`text-xs font-semibold ${P.inStock?"text-green-600":"text-gray-500"}`,children:P.inStock?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3 h-3"}),"IN STOCK"]}):"OUT OF STOCK"})]})]})},`${P.itemId}-${n}`))]}),T.some(P=>P.inStock)&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-blue-900",children:["ðŸ’¡ ",jsxRuntimeExports.jsx("strong",{children:"Tip:"})," When marking this task as complete in the Tasks tab, you can select one of these items as the replacement to automatically update inventory."]})})]})})},A.id)),jsxRuntimeExports.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:[I.length," task",I.length!==1?"s":""," with suggestions"]})]})};function AIInsightsPanel({inventory:D,tasks:i}){const[R,o]=reactExports.useState(!1),[f,I]=reactExports.useState([]),[A,T]=reactExports.useState(!1),[P,n]=reactExports.useState(null),[t,s]=reactExports.useState(!1);reactExports.useEffect(()=>{a()},[]);async function a(){T(!0),n(null);try{const r=await fetchAIInsights();I(r.insights)}catch(r){console.error("Failed to load insights:",r),n(r instanceof Error?r.message:"Failed to load insights")}finally{T(!1)}}async function c(){o(!0),n(null),s(!1);try{const r=await generateAIInsights({tasks:i.filter(b=>b.status==="pending"),inventory:D});r.ok?setTimeout(()=>{a()},2e3):(s(!0),n(r.message))}catch(r){console.error("Failed to generate insights:",r),n(r instanceof Error?r.message:"Failed to generate insights")}finally{o(!1)}}function e(r){try{return JSON.parse(r)}catch{return null}}const d=f.length>0?f[0]:null,m=d?e(d.insight_json):null;return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"AI Insights"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Automated inventory analysis and recommendations"})]}),jsxRuntimeExports.jsx(Button,{onClick:c,disabled:R||D.length===0,className:"min-h-[44px] whitespace-nowrap",children:R?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"animate-spin mr-2",children:"âš™ï¸"}),"Generating..."]}):"ðŸ¤– Generate Insights"})]}),P&&jsxRuntimeExports.jsx("div",{className:`p-4 rounded-lg ${t?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:jsxRuntimeExports.jsx("p",{className:`text-sm ${t?"text-yellow-800":"text-red-800"}`,children:t?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("strong",{children:"âš ï¸ AI Not Configured:"})," ",P,jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("span",{className:"text-xs mt-1 block",children:"This is an optional feature. The system works fully without it."})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("strong",{children:"Error:"})," ",P]})})}),A&&jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"inline-block animate-spin text-4xl",children:"âš™ï¸"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-2",children:"Loading insights..."})]}),!A&&d&&m&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-500",children:["Generated: ",new Date(d.created_at).toLocaleString(),d.model&&jsxRuntimeExports.jsxs("span",{className:"ml-2",children:["â€¢ Model: ",d.model.split("/").pop()]})]}),m.summary&&jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ“Š Summary"}),jsxRuntimeExports.jsx("p",{className:"text-blue-800 text-sm",children:m.summary})]}),m.recurringIssues&&m.recurringIssues.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"ðŸ”„ Recurring Issues"}),jsxRuntimeExports.jsx("ul",{className:"space-y-1",children:m.recurringIssues.map((r,b)=>jsxRuntimeExports.jsxs("li",{className:"text-orange-800 text-sm",children:["â€¢ ",r]},b))})]}),m.reorderSuggestions&&m.reorderSuggestions.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"ðŸ“¦ Reorder Suggestions"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:m.reorderSuggestions.map((r,b)=>jsxRuntimeExports.jsx("div",{className:"bg-white rounded p-3 border border-green-100",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-green-900 text-sm",children:r.item}),jsxRuntimeExports.jsx("p",{className:"text-green-700 text-xs mt-1",children:r.reason})]}),jsxRuntimeExports.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${r.urgency?.toLowerCase()==="high"?"bg-red-100 text-red-800":r.urgency?.toLowerCase()==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.urgency||"Normal"})]})},b))})]}),m.anomalies&&m.anomalies.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"ðŸ” Anomalies Detected"}),jsxRuntimeExports.jsx("ul",{className:"space-y-1",children:m.anomalies.map((r,b)=>jsxRuntimeExports.jsxs("li",{className:"text-purple-800 text-sm",children:["â€¢ ",r]},b))})]})]}),!A&&f.length===0&&!P&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[jsxRuntimeExports.jsx("div",{className:"text-6xl mb-4",children:"ðŸ¤–"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 font-medium",children:"No insights generated yet"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm mt-2",children:'Click "Generate Insights" to analyze your inventory'})]}),f.length>1&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-200",children:[f.length," insights stored â€¢ Showing most recent"]})]})}const InventoryTab=()=>{const[D,i]=reactExports.useState("list"),{items:R,isLoading:o,error:f,refresh:I,lastFetchedAt:A}=useInventory(),{tasks:T}=useSupplyTasks();return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage supply inventory, tasks, and suggested replacements"})]}),A&&!o&&jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date(A).toLocaleString()]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 border-b border-gray-200 overflow-x-auto",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>i("list"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${D==="list"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Package,{className:"w-5 h-5"}),"Inventory List"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>i("tasks"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${D==="tasks"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(ClipboardList,{className:"w-5 h-5"}),"Supply Tasks"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>i("suggestions"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${D==="suggestions"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Lightbulb,{className:"w-5 h-5"}),"Suggestions"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>i("ai-insights"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${D==="ai-insights"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Brain,{className:"w-5 h-5"}),"AI Insights"]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-6",children:[D==="list"&&jsxRuntimeExports.jsx(SupplyListPanel,{items:R,isLoading:o,error:f,onRefresh:I}),D==="tasks"&&jsxRuntimeExports.jsx(TasksPanel,{}),D==="suggestions"&&jsxRuntimeExports.jsx(SuggestionsPanel,{}),D==="ai-insights"&&jsxRuntimeExports.jsx(AIInsightsPanel,{inventory:R,tasks:T})]})]})};function useVehicleChangeRequests(D={}){const{status:i,pollInterval:R=3e4,autoFetch:o=!0}=D,[f,I]=reactExports.useState([]),[A,T]=reactExports.useState(o),[P,n]=reactExports.useState(null),[t,s]=reactExports.useState(0),[a,c]=reactExports.useState(0),e=reactExports.useCallback(async()=>{T(!0),n(null);try{const b=await fetchVehicleChangeRequests(i);I(b.requests),s(b.pending),c(b.total)}catch(b){console.error("Error fetching vehicle change requests:",b),n(b instanceof Error?b.message:"Failed to fetch vehicle change requests")}finally{T(!1)}},[i]),d=async b=>{try{await submitVehicleChangeRequest(b),await e()}catch(w){throw console.error("Error submitting vehicle change request:",w),w}},m=async(b,w,j)=>{try{await reviewVehicleChangeRequest(b,"approve",w,j),await e()}catch(p){throw console.error("Error approving vehicle change request:",p),p}},r=async(b,w,j)=>{try{await reviewVehicleChangeRequest(b,"reject",w,j),await e()}catch(p){throw console.error("Error rejecting vehicle change request:",p),p}};return reactExports.useEffect(()=>{o&&e()},[e,o]),reactExports.useEffect(()=>{if(R>0){const b=setInterval(e,R);return()=>clearInterval(b)}},[R,e]),{requests:f,loading:A,error:P,pendingCount:t,totalCount:a,refetch:e,submitRequest:d,approveRequest:m,rejectRequest:r}}const ApparatusStatusTab=()=>{const{statuses:D,allVehicles:i,loading:R,error:o,refetch:f}=useApparatusStatus(),{requests:I,loading:A,pendingCount:T,approveRequest:P,rejectRequest:n,refetch:t}=useVehicleChangeRequests({pollInterval:3e4}),[s,a]=reactExports.useState(null),[c,e]=reactExports.useState(!1),[d,m]=reactExports.useState(null),[r,b]=reactExports.useState(""),w=async _=>{if(confirm("Approve this vehicle change? This will update the Google Sheet.")){a(_);try{await P(_,"Admin","Approved by admin dashboard"),alert("Vehicle change approved and sheet updated!"),await f()}catch(H){console.error("Error approving request:",H),alert("Failed to approve request. Please try again.")}finally{a(null)}}},j=async()=>{if(d){a(d);try{await n(d,"Admin",r||"Rejected by admin"),alert("Vehicle change request rejected."),e(!1),m(null),b("")}catch(_){console.error("Error rejecting request:",_),alert("Failed to reject request. Please try again.")}finally{a(null)}}},p=_=>{m(_),e(!0)};if(R||A)return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center p-12",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 font-semibold",children:"Loading apparatus status..."})]})});if(o)return jsxRuntimeExports.jsx("div",{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-xl p-6 text-center",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-12 h-12 text-red-600 mx-auto mb-3"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-red-900 mb-2",children:"Error Loading Apparatus Status"}),jsxRuntimeExports.jsx("p",{className:"text-red-700 mb-4",children:o}),jsxRuntimeExports.jsxs(Button,{onClick:f,variant:"secondary",children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 mr-2"}),"Retry"]})]})});const g=_=>D.find(z=>z.vehicleNo===_)?.unit||null,M=_=>_.toLowerCase().includes("out of service")?"border-2 border-red-500 bg-red-50 hover:border-red-600":"border-2 border-gray-300 bg-white hover:border-blue-400",O=_=>{const H=_.toLowerCase();return H.includes("out of service")?"bg-red-600 text-white":H.includes("in service")?"bg-green-600 text-white":"bg-gray-600 text-white"};return jsxRuntimeExports.jsxs("div",{className:"space-y-6 p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Fleet Status"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-1",children:"All vehicles and current assignments"})]}),jsxRuntimeExports.jsxs(Button,{onClick:()=>{f(),t()},variant:"secondary",children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),T>0&&jsxRuntimeExports.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-xl p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Clock,{className:"w-6 h-6 text-amber-700 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h3",{className:"font-bold text-amber-900 mb-1",children:[T," Pending Vehicle Change Request",T!==1?"s":""]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-800",children:"Review and approve/reject vehicle changes reported by field personnel below."})]})]})}),jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Truck,{className:"w-6 h-6 text-blue-700"}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"All Vehicles"})]})}),jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(_=>{const H=g(_.vehicleNo),z=_.status.toLowerCase().includes("out of service");return jsxRuntimeExports.jsxs("div",{className:`${M(_.status)} rounded-lg p-4 transition-colors`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h4",{className:"text-3xl font-bold text-blue-700",children:["#",_.vehicleNo]}),H&&jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:H}),!H&&_.designation&&jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:_.designation})]}),jsxRuntimeExports.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded ${O(_.status)}`,children:_.status})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 text-sm",children:[_.assignment&&jsxRuntimeExports.jsxs("p",{className:"text-gray-700",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Assignment:"})," ",_.assignment]}),_.currentLocation&&jsxRuntimeExports.jsxs("p",{className:"text-gray-700",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Location:"})," ",_.currentLocation]}),_.notes&&jsxRuntimeExports.jsx("p",{className:`text-xs italic mt-2 ${z?"text-red-700 font-semibold":"text-gray-500"}`,children:_.notes})]}),!H&&!_.designation&&jsxRuntimeExports.jsx("div",{className:"mt-2 pt-2 border-t border-gray-300",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Reserve"})})]},_.vehicleNo)})}),i.length===0&&jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500 py-8",children:"No vehicle data available"})]})]}),jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Clock,{className:"w-6 h-6 text-orange-700"}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Vehicle Change Requests"})]})}),jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[I.filter(_=>_.status==="pending").map(_=>jsxRuntimeExports.jsx("div",{className:"border-2 border-orange-300 rounded-lg p-4 bg-orange-50",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-gray-900 text-lg",children:_.apparatus}),jsxRuntimeExports.jsx("span",{className:"px-2 py-1 text-xs font-bold bg-orange-200 text-orange-900 rounded",children:"PENDING"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 text-sm",children:[jsxRuntimeExports.jsxs("p",{className:"text-gray-700",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Old Vehicle:"})," #",_.oldVehicleNo||"None"," â†’ ",jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"New Vehicle:"})," #",_.newVehicleNo]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Reported by:"})," ",_.reportedBy]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Date:"})," ",new Date(_.reportedAt).toLocaleString()]}),_.notes&&jsxRuntimeExports.jsx("p",{className:"text-gray-500 italic mt-2",children:_.notes})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2",children:[jsxRuntimeExports.jsxs(Button,{onClick:()=>w(_.id),disabled:s===_.id,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),"Approve"]}),jsxRuntimeExports.jsxs(Button,{onClick:()=>p(_.id),disabled:s===_.id,variant:"secondary",className:"flex items-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-900",children:[jsxRuntimeExports.jsx(CircleX,{className:"w-4 h-4"}),"Reject"]})]})]})},_.id)),I.filter(_=>_.status==="pending").length===0&&jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500 py-8",children:"No pending vehicle change requests"})]}),I.filter(_=>_.status!=="pending").length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-gray-700 mb-4",children:"Recently Processed"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:I.filter(_=>_.status!=="pending").slice(0,5).map(_=>jsxRuntimeExports.jsx("div",{className:"border border-gray-300 rounded-lg p-3 bg-gray-50 text-sm",children:jsxRuntimeExports.jsx("div",{className:"flex items-start justify-between",children:jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-gray-900",children:_.apparatus}),jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 text-xs font-bold rounded ${_.status==="approved"?"bg-green-200 text-green-900":"bg-red-200 text-red-900"}`,children:_.status.toUpperCase()})]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600 text-xs",children:["#",_.oldVehicleNo||"None"," â†’ #",_.newVehicleNo," â€¢ Reported by ",_.reportedBy]}),_.reviewedBy&&jsxRuntimeExports.jsxs("p",{className:"text-gray-500 text-xs mt-1",children:["Reviewed by ",_.reviewedBy," on"," ",new Date(_.reviewedAt).toLocaleString()]})]})})},_.id))})]})]})]}),c&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Reject Vehicle Change Request"}),jsxRuntimeExports.jsx("p",{className:"text-gray-700 mb-4",children:"Provide a reason for rejecting this vehicle change request:"}),jsxRuntimeExports.jsx("textarea",{value:r,onChange:_=>b(_.target.value),placeholder:"Enter reason for rejection...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none mb-4",rows:4}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>{e(!1),m(null),b("")},variant:"secondary",className:"flex-1",children:"Cancel"}),jsxRuntimeExports.jsx(Button,{onClick:j,disabled:s===d,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:"Confirm Reject"})]})]})})]})},FormEditor=({templateId:D,adminPassword:i,onClose:R,onSaved:o})=>{const[f,I]=reactExports.useState(!0),[A,T]=reactExports.useState(!1),[P,n]=reactExports.useState(null),[t,s]=reactExports.useState(null),[a,c]=reactExports.useState({name:"",apparatus:[]});reactExports.useEffect(()=>{(async()=>{I(!0),n(null);try{const M=await fetch(`${WORKER_URL}/api/forms/template/${D}`,{headers:{"X-Admin-Password":i}});if(!M.ok)throw new Error(`Failed: ${M.status}`);const O=await M.json();s(O.formJson),c({name:O.name,apparatus:O.apparatus_list})}catch(M){n(M instanceof Error?M.message:"Failed to load template")}finally{I(!1)}})()},[D,i]);const e=async()=>{if(t){T(!0);try{const g=await fetch(`${WORKER_URL}/api/forms/${D}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Admin-Password":i},body:JSON.stringify({formJson:t,publish:!0})});if(!g.ok)throw new Error(`Failed: ${g.status}`);o()}catch(g){alert(g instanceof Error?g.message:"Failed to save template")}finally{T(!1)}}},d=()=>{if(!t)return;const g={id:`comp_${Date.now()}`,title:"New Compartment",items:[]};s({...t,compartments:[...t.compartments,g]})},m=g=>{t&&confirm("Delete this compartment?")&&s({...t,compartments:t.compartments.filter((M,O)=>O!==g)})},r=(g,M)=>{if(!t)return;const O=[...t.compartments],_=M==="up"?g-1:g+1;_<0||_>=O.length||([O[g],O[_]]=[O[_],O[g]],s({...t,compartments:O}))},b=(g,M)=>{if(!t)return;const O=[...t.compartments];O[g]={...O[g],title:M},s({...t,compartments:O})},w=g=>{if(!t)return;const M={name:"New Item",inputType:"checkbox",expectedQuantity:1},O=[...t.compartments];O[g]={...O[g],items:[...O[g].items,M]},s({...t,compartments:O})},j=(g,M)=>{if(!t)return;const O=[...t.compartments];O[g]={...O[g],items:O[g].items.filter((_,H)=>H!==M)},s({...t,compartments:O})},p=(g,M,O)=>{if(!t)return;const _=[...t.compartments],H=_[g].items[M],z=typeof H=="string"?{name:H,inputType:"checkbox"}:H;_[g].items[M]={...z,...O},s({...t,compartments:_})};return f?jsxRuntimeExports.jsx(Modal,{isOpen:!0,onClose:R,title:"Loading...",children:jsxRuntimeExports.jsx("div",{className:"p-8 text-center",children:"Loading form template..."})}):P||!t?jsxRuntimeExports.jsxs(Modal,{isOpen:!0,onClose:R,title:"Error",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5"}),P||"Failed to load template"]}),jsxRuntimeExports.jsx("div",{className:"mt-4 flex justify-end",children:jsxRuntimeExports.jsx(Button,{onClick:R,children:"Close"})})]}):jsxRuntimeExports.jsx(Modal,{isOpen:!0,onClose:R,title:`Edit Template: ${a.name}`,children:jsxRuntimeExports.jsxs("div",{className:"max-h-[80vh] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[jsxRuntimeExports.jsxs("div",{className:"font-medium text-blue-900 mb-2",children:["Template: ",a.name]}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-blue-700",children:["Used by: ",a.apparatus.join(", ")||"No apparatus assigned"]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Form Title"}),jsxRuntimeExports.jsx("input",{type:"text",value:t.title,onChange:g=>s({...t,title:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold",children:"Compartments"}),jsxRuntimeExports.jsxs(Button,{onClick:d,className:"flex items-center gap-1 text-sm",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),"Add Compartment"]})]}),t.compartments.map((g,M)=>jsxRuntimeExports.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[jsxRuntimeExports.jsx("input",{type:"text",value:g.title,onChange:O=>b(M,O.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-medium"}),jsxRuntimeExports.jsx("button",{onClick:()=>r(M,"up"),disabled:M===0,className:"p-2 text-gray-600 hover:text-blue-600 disabled:opacity-30",children:jsxRuntimeExports.jsx(ArrowUp,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:()=>r(M,"down"),disabled:M===t.compartments.length-1,className:"p-2 text-gray-600 hover:text-blue-600 disabled:opacity-30",children:jsxRuntimeExports.jsx(ArrowDown,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:()=>m(M),className:"p-2 text-red-600 hover:text-red-700",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 ml-4",children:[g.items.map((O,_)=>{const H=typeof O=="string"?{name:O,inputType:"checkbox"}:O;return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-white p-2 rounded border border-gray-200",children:[jsxRuntimeExports.jsx("input",{type:"text",value:H.name,onChange:z=>p(M,_,{name:z.target.value}),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Item name"}),jsxRuntimeExports.jsxs("select",{value:H.inputType||"checkbox",onChange:z=>p(M,_,{inputType:z.target.value}),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[jsxRuntimeExports.jsx("option",{value:"checkbox",children:"Checkbox"}),jsxRuntimeExports.jsx("option",{value:"text",children:"Text"}),jsxRuntimeExports.jsx("option",{value:"number",children:"Number"}),jsxRuntimeExports.jsx("option",{value:"percentage",children:"Percentage"}),jsxRuntimeExports.jsx("option",{value:"radio",children:"Radio"})]}),jsxRuntimeExports.jsx("input",{type:"number",value:H.expectedQuantity||"",onChange:z=>p(M,_,{expectedQuantity:z.target.value?parseInt(z.target.value):void 0}),className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Qty"}),jsxRuntimeExports.jsx("button",{onClick:()=>j(M,_),className:"p-1 text-red-600 hover:text-red-700",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]},_)}),jsxRuntimeExports.jsxs(Button,{onClick:()=>w(M),variant:"secondary",className:"text-sm flex items-center gap-1",children:[jsxRuntimeExports.jsx(Plus,{className:"w-3 h-3"}),"Add Item"]})]})]},g.id))]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 justify-end border-t pt-4",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:R,disabled:A,children:"Cancel"}),jsxRuntimeExports.jsxs(Button,{onClick:e,disabled:A,className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Save,{className:"w-4 h-4"}),A?"Saving...":"Save & Publish"]})]})]})})};function commonjsRequire(D){throw new Error('Could not dynamically require "'+D+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);var hasRequiredPdf;function requirePdf(){return hasRequiredPdf||(hasRequiredPdf=1,(function(module,exports$1){(function(i,R){module.exports=i.pdfjsLib=R()})(globalThis,()=>(()=>{var __webpack_modules__=[,((D,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.VerbosityLevel=i.Util=i.UnknownErrorException=i.UnexpectedResponseException=i.TextRenderingMode=i.RenderingIntentFlag=i.PromiseCapability=i.PermissionFlag=i.PasswordResponses=i.PasswordException=i.PageActionEventType=i.OPS=i.MissingPDFException=i.MAX_IMAGE_SIZE_TO_CACHE=i.LINE_FACTOR=i.LINE_DESCENT_FACTOR=i.InvalidPDFException=i.ImageKind=i.IDENTITY_MATRIX=i.FormatError=i.FeatureTest=i.FONT_IDENTITY_MATRIX=i.DocumentActionEventType=i.CMapCompressionType=i.BaseException=i.BASELINE_FACTOR=i.AnnotationType=i.AnnotationReplyType=i.AnnotationPrefix=i.AnnotationMode=i.AnnotationFlag=i.AnnotationFieldFlag=i.AnnotationEditorType=i.AnnotationEditorPrefix=i.AnnotationEditorParamsType=i.AnnotationBorderStyleType=i.AnnotationActionEventType=i.AbortException=void 0,i.assert=h,i.bytesToString=U,i.createValidAbsoluteUrl=E,i.getModificationDate=vt,i.getUuid=Ct,i.getVerbosityLevel=nt,i.info=J,i.isArrayBuffer=xt,i.isArrayEqual=yt,i.isNodeJS=void 0,i.normalizeUnicode=_t,i.objectFromMap=$,i.objectSize=at,i.setVerbosityLevel=K,i.shadow=k,i.string32=G,i.stringToBytes=W,i.stringToPDFString=ht,i.stringToUTF8String=ut,i.unreachable=y,i.utf8StringToString=mt,i.warn=L;const R=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");i.isNodeJS=R;const o=[1,0,0,1,0,0];i.IDENTITY_MATRIX=o;const f=[.001,0,0,.001,0,0];i.FONT_IDENTITY_MATRIX=f;const I=1e7;i.MAX_IMAGE_SIZE_TO_CACHE=I;const A=1.35;i.LINE_FACTOR=A;const T=.35;i.LINE_DESCENT_FACTOR=T;const P=T/A;i.BASELINE_FACTOR=P;const n={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};i.RenderingIntentFlag=n;const t={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};i.AnnotationMode=t;const s="pdfjs_internal_editor_";i.AnnotationEditorPrefix=s;const a={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};i.AnnotationEditorType=a;const c={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};i.AnnotationEditorParamsType=c;const e={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};i.PermissionFlag=e;const d={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};i.TextRenderingMode=d;const m={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};i.ImageKind=m;const r={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};i.AnnotationType=r;const b={GROUP:"Group",REPLY:"R"};i.AnnotationReplyType=b;const w={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};i.AnnotationFlag=w;const j={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};i.AnnotationFieldFlag=j;const p={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};i.AnnotationBorderStyleType=p;const g={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};i.AnnotationActionEventType=g;const M={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};i.DocumentActionEventType=M;const O={O:"PageOpen",C:"PageClose"};i.PageActionEventType=O;const _={ERRORS:0,WARNINGS:1,INFOS:5};i.VerbosityLevel=_;const H={NONE:0,BINARY:1};i.CMapCompressionType=H;const z={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};i.OPS=z;const st={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};i.PasswordResponses=st;let et=_.WARNINGS;function K(rt){Number.isInteger(rt)&&(et=rt)}function nt(){return et}function J(rt){et>=_.INFOS&&console.log(`Info: ${rt}`)}function L(rt){et>=_.WARNINGS&&console.log(`Warning: ${rt}`)}function y(rt){throw new Error(rt)}function h(rt,V){rt||y(V)}function u(rt){switch(rt?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function E(rt,V=null,q=null){if(!rt)return null;try{if(q&&typeof rt=="string"&&(q.addDefaultProtocol&&rt.startsWith("www.")&&rt.match(/\./g)?.length>=2&&(rt=`http://${rt}`),q.tryConvertEncoding))try{rt=ut(rt)}catch{}const lt=V?new URL(rt,V):new URL(rt);if(u(lt))return lt}catch{}return null}function k(rt,V,q,lt=!1){return Object.defineProperty(rt,V,{value:q,enumerable:!lt,configurable:!0,writable:!1}),q}const N=(function(){function V(q,lt){this.constructor===V&&y("Cannot initialize BaseException."),this.message=q,this.name=lt}return V.prototype=new Error,V.constructor=V,V})();i.BaseException=N;class B extends N{constructor(V,q){super(V,"PasswordException"),this.code=q}}i.PasswordException=B;class C extends N{constructor(V,q){super(V,"UnknownErrorException"),this.details=q}}i.UnknownErrorException=C;class l extends N{constructor(V){super(V,"InvalidPDFException")}}i.InvalidPDFException=l;class x extends N{constructor(V){super(V,"MissingPDFException")}}i.MissingPDFException=x;class v extends N{constructor(V,q){super(V,"UnexpectedResponseException"),this.status=q}}i.UnexpectedResponseException=v;class S extends N{constructor(V){super(V,"FormatError")}}i.FormatError=S;class F extends N{constructor(V){super(V,"AbortException")}}i.AbortException=F;function U(rt){(typeof rt!="object"||rt?.length===void 0)&&y("Invalid argument for bytesToString");const V=rt.length,q=8192;if(V<q)return String.fromCharCode.apply(null,rt);const lt=[];for(let ft=0;ft<V;ft+=q){const gt=Math.min(ft+q,V),bt=rt.subarray(ft,gt);lt.push(String.fromCharCode.apply(null,bt))}return lt.join("")}function W(rt){typeof rt!="string"&&y("Invalid argument for stringToBytes");const V=rt.length,q=new Uint8Array(V);for(let lt=0;lt<V;++lt)q[lt]=rt.charCodeAt(lt)&255;return q}function G(rt){return String.fromCharCode(rt>>24&255,rt>>16&255,rt>>8&255,rt&255)}function at(rt){return Object.keys(rt).length}function $(rt){const V=Object.create(null);for(const[q,lt]of rt)V[q]=lt;return V}function Q(){const rt=new Uint8Array(4);return rt[0]=1,new Uint32Array(rt.buffer,0,1)[0]===1}function tt(){try{return new Function(""),!0}catch{return!1}}class Z{static get isLittleEndian(){return k(this,"isLittleEndian",Q())}static get isEvalSupported(){return k(this,"isEvalSupported",tt())}static get isOffscreenCanvasSupported(){return k(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?k(this,"platform",{isWin:!1,isMac:!1}):k(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return k(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}i.FeatureTest=Z;const it=[...Array(256).keys()].map(rt=>rt.toString(16).padStart(2,"0"));class ot{static makeHexColor(V,q,lt){return`#${it[V]}${it[q]}${it[lt]}`}static scaleMinMax(V,q){let lt;V[0]?(V[0]<0&&(lt=q[0],q[0]=q[1],q[1]=lt),q[0]*=V[0],q[1]*=V[0],V[3]<0&&(lt=q[2],q[2]=q[3],q[3]=lt),q[2]*=V[3],q[3]*=V[3]):(lt=q[0],q[0]=q[2],q[2]=lt,lt=q[1],q[1]=q[3],q[3]=lt,V[1]<0&&(lt=q[2],q[2]=q[3],q[3]=lt),q[2]*=V[1],q[3]*=V[1],V[2]<0&&(lt=q[0],q[0]=q[1],q[1]=lt),q[0]*=V[2],q[1]*=V[2]),q[0]+=V[4],q[1]+=V[4],q[2]+=V[5],q[3]+=V[5]}static transform(V,q){return[V[0]*q[0]+V[2]*q[1],V[1]*q[0]+V[3]*q[1],V[0]*q[2]+V[2]*q[3],V[1]*q[2]+V[3]*q[3],V[0]*q[4]+V[2]*q[5]+V[4],V[1]*q[4]+V[3]*q[5]+V[5]]}static applyTransform(V,q){const lt=V[0]*q[0]+V[1]*q[2]+q[4],ft=V[0]*q[1]+V[1]*q[3]+q[5];return[lt,ft]}static applyInverseTransform(V,q){const lt=q[0]*q[3]-q[1]*q[2],ft=(V[0]*q[3]-V[1]*q[2]+q[2]*q[5]-q[4]*q[3])/lt,gt=(-V[0]*q[1]+V[1]*q[0]+q[4]*q[1]-q[5]*q[0])/lt;return[ft,gt]}static getAxialAlignedBoundingBox(V,q){const lt=this.applyTransform(V,q),ft=this.applyTransform(V.slice(2,4),q),gt=this.applyTransform([V[0],V[3]],q),bt=this.applyTransform([V[2],V[1]],q);return[Math.min(lt[0],ft[0],gt[0],bt[0]),Math.min(lt[1],ft[1],gt[1],bt[1]),Math.max(lt[0],ft[0],gt[0],bt[0]),Math.max(lt[1],ft[1],gt[1],bt[1])]}static inverseTransform(V){const q=V[0]*V[3]-V[1]*V[2];return[V[3]/q,-V[1]/q,-V[2]/q,V[0]/q,(V[2]*V[5]-V[4]*V[3])/q,(V[4]*V[1]-V[5]*V[0])/q]}static singularValueDecompose2dScale(V){const q=[V[0],V[2],V[1],V[3]],lt=V[0]*q[0]+V[1]*q[2],ft=V[0]*q[1]+V[1]*q[3],gt=V[2]*q[0]+V[3]*q[2],bt=V[2]*q[1]+V[3]*q[3],wt=(lt+bt)/2,St=Math.sqrt((lt+bt)**2-4*(lt*bt-gt*ft))/2,Rt=wt+St||1,At=wt-St||1;return[Math.sqrt(Rt),Math.sqrt(At)]}static normalizeRect(V){const q=V.slice(0);return V[0]>V[2]&&(q[0]=V[2],q[2]=V[0]),V[1]>V[3]&&(q[1]=V[3],q[3]=V[1]),q}static intersect(V,q){const lt=Math.max(Math.min(V[0],V[2]),Math.min(q[0],q[2])),ft=Math.min(Math.max(V[0],V[2]),Math.max(q[0],q[2]));if(lt>ft)return null;const gt=Math.max(Math.min(V[1],V[3]),Math.min(q[1],q[3])),bt=Math.min(Math.max(V[1],V[3]),Math.max(q[1],q[3]));return gt>bt?null:[lt,gt,ft,bt]}static bezierBoundingBox(V,q,lt,ft,gt,bt,wt,St){const Rt=[],At=[[],[]];let kt,Nt,Ft,Et,It,Lt,Dt,Ot;for(let Bt=0;Bt<2;++Bt){if(Bt===0?(Nt=6*V-12*lt+6*gt,kt=-3*V+9*lt-9*gt+3*wt,Ft=3*lt-3*V):(Nt=6*q-12*ft+6*bt,kt=-3*q+9*ft-9*bt+3*St,Ft=3*ft-3*q),Math.abs(kt)<1e-12){if(Math.abs(Nt)<1e-12)continue;Et=-Ft/Nt,0<Et&&Et<1&&Rt.push(Et);continue}Dt=Nt*Nt-4*Ft*kt,Ot=Math.sqrt(Dt),!(Dt<0)&&(It=(-Nt+Ot)/(2*kt),0<It&&It<1&&Rt.push(It),Lt=(-Nt-Ot)/(2*kt),0<Lt&&Lt<1&&Rt.push(Lt))}let Tt=Rt.length,jt;const Pt=Tt;for(;Tt--;)Et=Rt[Tt],jt=1-Et,At[0][Tt]=jt*jt*jt*V+3*jt*jt*Et*lt+3*jt*Et*Et*gt+Et*Et*Et*wt,At[1][Tt]=jt*jt*jt*q+3*jt*jt*Et*ft+3*jt*Et*Et*bt+Et*Et*Et*St;return At[0][Pt]=V,At[1][Pt]=q,At[0][Pt+1]=wt,At[1][Pt+1]=St,At[0].length=At[1].length=Pt+2,[Math.min(...At[0]),Math.min(...At[1]),Math.max(...At[0]),Math.max(...At[1])]}}i.Util=ot;const ct=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function ht(rt){if(rt[0]>="Ã¯"){let q;if(rt[0]==="Ã¾"&&rt[1]==="Ã¿"?q="utf-16be":rt[0]==="Ã¿"&&rt[1]==="Ã¾"?q="utf-16le":rt[0]==="Ã¯"&&rt[1]==="Â»"&&rt[2]==="Â¿"&&(q="utf-8"),q)try{const lt=new TextDecoder(q,{fatal:!0}),ft=W(rt);return lt.decode(ft)}catch(lt){L(`stringToPDFString: "${lt}".`)}}const V=[];for(let q=0,lt=rt.length;q<lt;q++){const ft=ct[rt.charCodeAt(q)];V.push(ft?String.fromCharCode(ft):rt.charAt(q))}return V.join("")}function ut(rt){return decodeURIComponent(escape(rt))}function mt(rt){return unescape(encodeURIComponent(rt))}function xt(rt){return typeof rt=="object"&&rt?.byteLength!==void 0}function yt(rt,V){if(rt.length!==V.length)return!1;for(let q=0,lt=rt.length;q<lt;q++)if(rt[q]!==V[q])return!1;return!0}function vt(rt=new Date){return[rt.getUTCFullYear().toString(),(rt.getUTCMonth()+1).toString().padStart(2,"0"),rt.getUTCDate().toString().padStart(2,"0"),rt.getUTCHours().toString().padStart(2,"0"),rt.getUTCMinutes().toString().padStart(2,"0"),rt.getUTCSeconds().toString().padStart(2,"0")].join("")}class Y{#t=!1;constructor(){this.promise=new Promise((V,q)=>{this.resolve=lt=>{this.#t=!0,V(lt)},this.reject=lt=>{this.#t=!0,q(lt)}})}get settled(){return this.#t}}i.PromiseCapability=Y;let dt=null,pt=null;function _t(rt){return dt||(dt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,pt=new Map([["ï¬…","Å¿t"]])),rt.replaceAll(dt,(V,q,lt)=>q?q.normalize("NFKC"):pt.get(lt))}function Ct(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const rt=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(rt);else for(let V=0;V<32;V++)rt[V]=Math.floor(Math.random()*255);return U(rt)}const Mt="pdfjs_internal_id_";i.AnnotationPrefix=Mt}),((__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(D){if(typeof D=="string"||D instanceof URL?D={url:D}:(0,_util.isArrayBuffer)(D)&&(D={data:D}),typeof D!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!D.url&&!D.data&&!D.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const i=new PDFDocumentLoadingTask,{docId:R}=i,o=D.url?getUrlProp(D.url):null,f=D.data?getDataProp(D.data):null,I=D.httpHeaders||null,A=D.withCredentials===!0,T=D.password??null,P=D.range instanceof PDFDataRangeTransport?D.range:null,n=Number.isInteger(D.rangeChunkSize)&&D.rangeChunkSize>0?D.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let t=D.worker instanceof PDFWorker?D.worker:null;const s=D.verbosity,a=typeof D.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(D.docBaseUrl)?D.docBaseUrl:null,c=typeof D.cMapUrl=="string"?D.cMapUrl:null,e=D.cMapPacked!==!1,d=D.CMapReaderFactory||DefaultCMapReaderFactory,m=typeof D.standardFontDataUrl=="string"?D.standardFontDataUrl:null,r=D.StandardFontDataFactory||DefaultStandardFontDataFactory,b=D.stopAtErrors!==!0,w=Number.isInteger(D.maxImageSize)&&D.maxImageSize>-1?D.maxImageSize:-1,j=D.isEvalSupported!==!1,p=typeof D.isOffscreenCanvasSupported=="boolean"?D.isOffscreenCanvasSupported:!_util.isNodeJS,g=Number.isInteger(D.canvasMaxAreaInBytes)?D.canvasMaxAreaInBytes:-1,M=typeof D.disableFontFace=="boolean"?D.disableFontFace:_util.isNodeJS,O=D.fontExtraProperties===!0,_=D.enableXfa===!0,H=D.ownerDocument||globalThis.document,z=D.disableRange===!0,st=D.disableStream===!0,et=D.disableAutoFetch===!0,K=D.pdfBug===!0,nt=P?P.length:D.length??NaN,J=typeof D.useSystemFonts=="boolean"?D.useSystemFonts:!_util.isNodeJS&&!M,L=typeof D.useWorkerFetch=="boolean"?D.useWorkerFetch:d===_display_utils.DOMCMapReaderFactory&&r===_display_utils.DOMStandardFontDataFactory&&c&&m&&(0,_display_utils.isValidFetchUrl)(c,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(m,document.baseURI),y=D.canvasFactory||new DefaultCanvasFactory({ownerDocument:H}),h=D.filterFactory||new DefaultFilterFactory({docId:R,ownerDocument:H}),u=null;(0,_util.setVerbosityLevel)(s);const E={canvasFactory:y,filterFactory:h};if(L||(E.cMapReaderFactory=new d({baseUrl:c,isCompressed:e}),E.standardFontDataFactory=new r({baseUrl:m})),!t){const B={verbosity:s,port:_worker_options.GlobalWorkerOptions.workerPort};t=B.port?PDFWorker.fromPort(B):new PDFWorker(B),i._worker=t}const k={docId:R,apiVersion:"3.11.174",data:f,password:T,disableAutoFetch:et,rangeChunkSize:n,length:nt,docBaseUrl:a,enableXfa:_,evaluatorOptions:{maxImageSize:w,disableFontFace:M,ignoreErrors:b,isEvalSupported:j,isOffscreenCanvasSupported:p,canvasMaxAreaInBytes:g,fontExtraProperties:O,useSystemFonts:J,cMapUrl:L?c:null,standardFontDataUrl:L?m:null}},N={ignoreErrors:b,isEvalSupported:j,disableFontFace:M,fontExtraProperties:O,enableXfa:_,ownerDocument:H,disableAutoFetch:et,pdfBug:K,styleElement:u};return t.promise.then(function(){if(i.destroyed)throw new Error("Loading aborted");const B=_fetchDocument(t,k),C=new Promise(function(l){let x;P?x=new _transport_stream.PDFDataTransportStream({length:nt,initialData:P.initialData,progressiveDone:P.progressiveDone,contentDispositionFilename:P.contentDispositionFilename,disableRange:z,disableStream:st},P):f||(x=(S=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(S):(0,_display_utils.isValidFetchUrl)(S.url)?new _displayFetch_stream.PDFFetchStream(S):new _displayNetwork.PDFNetworkStream(S))({url:o,length:nt,httpHeaders:I,withCredentials:A,rangeChunkSize:n,disableRange:z,disableStream:st})),l(x)});return Promise.all([B,C]).then(function([l,x]){if(i.destroyed)throw new Error("Loading aborted");const v=new _message_handler.MessageHandler(R,l,t.port),S=new WorkerTransport(v,i,x,N,E);i._transport=S,v.send("Ready",null)})}).catch(i._capability.reject),i}async function _fetchDocument(D,i){if(D.destroyed)throw new Error("Worker was destroyed");const R=await D.messageHandler.sendWithPromise("GetDocRequest",i,i.data?[i.data.buffer]:null);if(D.destroyed)throw new Error("Worker was destroyed");return R}function getUrlProp(D){if(D instanceof URL)return D.href;try{return new URL(D,window.location).href}catch{if(_util.isNodeJS&&typeof D=="string")return D}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(D){if(_util.isNodeJS&&typeof Buffer<"u"&&D instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(D instanceof Uint8Array&&D.byteLength===D.buffer.byteLength)return D;if(typeof D=="string")return(0,_util.stringToBytes)(D);if(typeof D=="object"&&!isNaN(D?.length)||(0,_util.isArrayBuffer)(D))return new Uint8Array(D);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#t=0;constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(i){throw this._worker?.port&&delete this._worker._pendingDestroy,i}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(i,R,o=!1,f=null){this.length=i,this.initialData=R,this.progressiveDone=o,this.contentDispositionFilename=f,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(i){this._rangeListeners.push(i)}addProgressListener(i){this._progressListeners.push(i)}addProgressiveReadListener(i){this._progressiveReadListeners.push(i)}addProgressiveDoneListener(i){this._progressiveDoneListeners.push(i)}onDataRange(i,R){for(const o of this._rangeListeners)o(i,R)}onDataProgress(i,R){this._readyCapability.promise.then(()=>{for(const o of this._progressListeners)o(i,R)})}onDataProgressiveRead(i){this._readyCapability.promise.then(()=>{for(const R of this._progressiveReadListeners)R(i)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const i of this._progressiveDoneListeners)i()})}transportReady(){this._readyCapability.resolve()}requestDataRange(i,R){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(i,R){this._pdfInfo=i,this._transport=R,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(o=>{if(!o)return o;const f=[];for(const I in o)f.push(...o[I]);return f}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(i){return this._transport.getPage(i)}getPageIndex(i){return this._transport.getPageIndex(i)}getDestinations(){return this._transport.getDestinations()}getDestination(i){return this._transport.getDestination(i)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(i=!1){return this._transport.startCleanup(i||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{#t=null;#e=!1;constructor(i,R,o,f=!1){this._pageIndex=i,this._pageInfo=R,this._transport=o,this._stats=f?new _display_utils.StatTimer:null,this._pdfBug=f,this.commonObjs=o.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:i,rotation:R=this.rotate,offsetX:o=0,offsetY:f=0,dontFlip:I=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:i,rotation:R,offsetX:o,offsetY:f,dontFlip:I})}getAnnotations({intent:i="display"}={}){const R=this._transport.getRenderingIntent(i);return this._transport.getAnnotations(this._pageIndex,R.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:i,viewport:R,intent:o="display",annotationMode:f=_util.AnnotationMode.ENABLE,transform:I=null,background:A=null,optionalContentConfigPromise:T=null,annotationCanvasMap:P=null,pageColors:n=null,printAnnotationStorage:t=null}){this._stats?.time("Overall");const s=this._transport.getRenderingIntent(o,f,t);this.#e=!1,this.#n(),T||(T=this._transport.getOptionalContentConfig());let a=this._intentStates.get(s.cacheKey);a||(a=Object.create(null),this._intentStates.set(s.cacheKey,a)),a.streamReaderCancelTimeout&&(clearTimeout(a.streamReaderCancelTimeout),a.streamReaderCancelTimeout=null);const c=!!(s.renderingIntent&_util.RenderingIntentFlag.PRINT);a.displayReadyCapability||(a.displayReadyCapability=new _util.PromiseCapability,a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s));const e=r=>{a.renderTasks.delete(d),(this._maybeCleanupAfterRender||c)&&(this.#e=!0),this.#s(!c),r?(d.capability.reject(r),this._abortOperatorList({intentState:a,reason:r instanceof Error?r:new Error(r)})):d.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},d=new InternalRenderTask({callback:e,params:{canvasContext:i,viewport:R,transform:I,background:A},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:P,operatorList:a.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!c,pdfBug:this._pdfBug,pageColors:n});(a.renderTasks||=new Set).add(d);const m=d.task;return Promise.all([a.displayReadyCapability.promise,T]).then(([r,b])=>{if(this.destroyed){e();return}this._stats?.time("Rendering"),d.initializeGraphics({transparency:r,optionalContentConfig:b}),d.operatorListChanged()}).catch(e),m}getOperatorList({intent:i="display",annotationMode:R=_util.AnnotationMode.ENABLE,printAnnotationStorage:o=null}={}){function f(){A.operatorList.lastChunk&&(A.opListReadCapability.resolve(A.operatorList),A.renderTasks.delete(T))}const I=this._transport.getRenderingIntent(i,R,o,!0);let A=this._intentStates.get(I.cacheKey);A||(A=Object.create(null),this._intentStates.set(I.cacheKey,A));let T;return A.opListReadCapability||(T=Object.create(null),T.operatorListChanged=f,A.opListReadCapability=new _util.PromiseCapability,(A.renderTasks||=new Set).add(T),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(I)),A.opListReadCapability.promise}streamTextContent({includeMarkedContent:i=!1,disableNormalization:R=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:i===!0,disableNormalization:R===!0},{highWaterMark:100,size(f){return f.items.length}})}getTextContent(i={}){if(this._transport._htmlForXfa)return this.getXfa().then(o=>_xfa_text.XfaText.textContent(o));const R=this.streamTextContent(i);return new Promise(function(o,f){function I(){A.read().then(function({value:P,done:n}){if(n){o(T);return}Object.assign(T.styles,P.styles),T.items.push(...P.items),I()},f)}const A=R.getReader(),T={items:[],styles:Object.create(null)};I()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const i=[];for(const R of this._intentStates.values())if(this._abortOperatorList({intentState:R,reason:new Error("Page was destroyed."),force:!0}),!R.opListReadCapability)for(const o of R.renderTasks)i.push(o.completed),o.cancel();return this.objs.clear(),this.#e=!1,this.#n(),Promise.all(i)}cleanup(i=!1){this.#e=!0;const R=this.#s(!1);return i&&R&&(this._stats&&=new _display_utils.StatTimer),R}#s(i=!1){if(this.#n(),!this.#e||this.destroyed)return!1;if(i)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},DELAYED_CLEANUP_TIMEOUT),!1;for(const{renderTasks:R,operatorList:o}of this._intentStates.values())if(R.size>0||!o.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#n(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(i,R){const o=this._intentStates.get(R);o&&(this._stats?.timeEnd("Page Request"),o.displayReadyCapability?.resolve(i))}_renderPageChunk(i,R){for(let o=0,f=i.length;o<f;o++)R.operatorList.fnArray.push(i.fnArray[o]),R.operatorList.argsArray.push(i.argsArray[o]);R.operatorList.lastChunk=i.lastChunk,R.operatorList.separateAnnots=i.separateAnnots;for(const o of R.renderTasks)o.operatorListChanged();i.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:i,cacheKey:R,annotationStorageSerializable:o}){const{map:f,transfers:I}=o,T=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:i,cacheKey:R,annotationStorage:f},I).getReader(),P=this._intentStates.get(R);P.streamReader=T;const n=()=>{T.read().then(({value:t,done:s})=>{if(s){P.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(t,P),n())},t=>{if(P.streamReader=null,!this._transport.destroyed){if(P.operatorList){P.operatorList.lastChunk=!0;for(const s of P.renderTasks)s.operatorListChanged();this.#s(!0)}if(P.displayReadyCapability)P.displayReadyCapability.reject(t);else if(P.opListReadCapability)P.opListReadCapability.reject(t);else throw t}})};n()}_abortOperatorList({intentState:i,reason:R,force:o=!1}){if(i.streamReader){if(i.streamReaderCancelTimeout&&(clearTimeout(i.streamReaderCancelTimeout),i.streamReaderCancelTimeout=null),!o){if(i.renderTasks.size>0)return;if(R instanceof _display_utils.RenderingCancelledException){let f=RENDERING_CANCELLED_TIMEOUT;R.extraDelay>0&&R.extraDelay<1e3&&(f+=R.extraDelay),i.streamReaderCancelTimeout=setTimeout(()=>{i.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:i,reason:R,force:!0})},f);return}}if(i.streamReader.cancel(new _util.AbortException(R.message)).catch(()=>{}),i.streamReader=null,!this._transport.destroyed){for(const[f,I]of this._intentStates)if(I===i){this._intentStates.delete(f);break}this.cleanup()}}}get stats(){return this._stats}}exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{#t=new Set;#e=Promise.resolve();postMessage(i,R){const o={data:structuredClone(i,R?{transfer:R}:null)};this.#e.then(()=>{for(const f of this.#t)f.call(this,o)})}addEventListener(i,R){this.#t.add(R)}removeEventListener(i,R){this.#t.delete(R)}terminate(){this.#t.clear()}}exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const D=document?.currentScript?.src;D&&(PDFWorkerUtil.fallbackWorkerSrc=D.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(D,i){let R;try{if(R=new URL(D),!R.origin||R.origin==="null")return!1}catch{return!1}const o=new URL(i,R);return R.origin===o.origin},PDFWorkerUtil.createCDNWrapper=function(D){const i=`importScripts("${D}");`;return URL.createObjectURL(new Blob([i]))}}class PDFWorker{static#workerPorts;constructor({name:D=null,port:i=null,verbosity:R=(0,_util.getVerbosityLevel)()}={}){if(this.name=D,this.destroyed=!1,this.verbosity=R,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,i){if(PDFWorker.#workerPorts?.has(i))throw new Error("Cannot use more than one PDFWorker per port.");(PDFWorker.#workerPorts||=new WeakMap).set(i,this),this._initializeFromPort(i);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(D){this._port=D,this._messageHandler=new _message_handler.MessageHandler("main","worker",D),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:D}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,D)||(D=PDFWorkerUtil.createCDNWrapper(new URL(D,window.location).href));const i=new Worker(D),R=new _message_handler.MessageHandler("main","worker",i),o=()=>{i.removeEventListener("error",f),R.destroy(),i.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},f=()=>{this._webWorker||o()};i.addEventListener("error",f),R.on("test",A=>{if(i.removeEventListener("error",f),this.destroyed){o();return}A?(this._messageHandler=R,this._port=i,this._webWorker=i,this._readyCapability.resolve(),R.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),R.destroy(),i.terminate())}),R.on("ready",A=>{if(i.removeEventListener("error",f),this.destroyed){o();return}try{I()}catch{this._setupFakeWorker()}});const I=()=>{const A=new Uint8Array;R.send("test",A,[A.buffer])};I();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(D=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const i=new LoopbackPort;this._port=i;const R=`fake${PDFWorkerUtil.fakeWorkerId++}`,o=new _message_handler.MessageHandler(R+"_worker",R,i);D.setup(o,i);const f=new _message_handler.MessageHandler(R,R+"_worker",i);this._messageHandler=f,this._readyCapability.resolve(),f.send("configure",{verbosity:this.verbosity})}).catch(D=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${D.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(D){if(!D?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const i=this.#workerPorts?.get(D.port);if(i){if(i._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return i}return new PDFWorker(D)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports$1.PDFWorker=PDFWorker;class WorkerTransport{#t=new Map;#e=new Map;#s=new Map;#n=null;constructor(i,R,o,f,I){this.messageHandler=i,this.loadingTask=R,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:f.ownerDocument,styleElement:f.styleElement}),this._params=f,this.canvasFactory=I.canvasFactory,this.filterFactory=I.filterFactory,this.cMapReaderFactory=I.cMapReaderFactory,this.standardFontDataFactory=I.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=o,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}#o(i,R=null){const o=this.#t.get(i);if(o)return o;const f=this.messageHandler.sendWithPromise(i,R);return this.#t.set(i,f),f}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(i,R=_util.AnnotationMode.ENABLE,o=null,f=!1){let I=_util.RenderingIntentFlag.DISPLAY,A=_annotation_storage.SerializableEmpty;switch(i){case"any":I=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":I=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${i}`)}switch(R){case _util.AnnotationMode.DISABLE:I+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:I+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:I+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,A=(I&_util.RenderingIntentFlag.PRINT&&o instanceof _annotation_storage.PrintAnnotationStorage?o:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${R}`)}return f&&(I+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:I,cacheKey:`${I}_${A.hash}`,annotationStorageSerializable:A}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this.#n?.reject(new Error("Worker was destroyed during onPassword callback"));const i=[];for(const o of this.#e.values())i.push(o._destroy());this.#e.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const R=this.messageHandler.sendWithPromise("Terminate",null);return i.push(R),Promise.all(i).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:i,loadingTask:R}=this;i.on("GetReader",(o,f)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=I=>{this._lastProgress={loaded:I.loaded,total:I.total}},f.onPull=()=>{this._fullReader.read().then(function({value:I,done:A}){if(A){f.close();return}(0,_util.assert)(I instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),f.enqueue(new Uint8Array(I),1,[I])}).catch(I=>{f.error(I)})},f.onCancel=I=>{this._fullReader.cancel(I),f.ready.catch(A=>{if(!this.destroyed)throw A})}}),i.on("ReaderHeadersReady",o=>{const f=new _util.PromiseCapability,I=this._fullReader;return I.headersReady.then(()=>{(!I.isStreamingSupported||!I.isRangeSupported)&&(this._lastProgress&&R.onProgress?.(this._lastProgress),I.onProgress=A=>{R.onProgress?.({loaded:A.loaded,total:A.total})}),f.resolve({isStreamingSupported:I.isStreamingSupported,isRangeSupported:I.isRangeSupported,contentLength:I.contentLength})},f.reject),f.promise}),i.on("GetRangeReader",(o,f)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const I=this._networkStream.getRangeReader(o.begin,o.end);if(!I){f.close();return}f.onPull=()=>{I.read().then(function({value:A,done:T}){if(T){f.close();return}(0,_util.assert)(A instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),f.enqueue(new Uint8Array(A),1,[A])}).catch(A=>{f.error(A)})},f.onCancel=A=>{I.cancel(A),f.ready.catch(T=>{if(!this.destroyed)throw T})}}),i.on("GetDoc",({pdfInfo:o})=>{this._numPages=o.numPages,this._htmlForXfa=o.htmlForXfa,delete o.htmlForXfa,R._capability.resolve(new PDFDocumentProxy(o,this))}),i.on("DocException",function(o){let f;switch(o.name){case"PasswordException":f=new _util.PasswordException(o.message,o.code);break;case"InvalidPDFException":f=new _util.InvalidPDFException(o.message);break;case"MissingPDFException":f=new _util.MissingPDFException(o.message);break;case"UnexpectedResponseException":f=new _util.UnexpectedResponseException(o.message,o.status);break;case"UnknownErrorException":f=new _util.UnknownErrorException(o.message,o.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}R._capability.reject(f)}),i.on("PasswordRequest",o=>{if(this.#n=new _util.PromiseCapability,R.onPassword){const f=I=>{I instanceof Error?this.#n.reject(I):this.#n.resolve({password:I})};try{R.onPassword(f,o.code)}catch(I){this.#n.reject(I)}}else this.#n.reject(new _util.PasswordException(o.message,o.code));return this.#n.promise}),i.on("DataLoaded",o=>{R.onProgress?.({loaded:o.length,total:o.length}),this.downloadInfoCapability.resolve(o)}),i.on("StartRenderPage",o=>{if(this.destroyed)return;this.#e.get(o.pageIndex)._startRenderPage(o.transparency,o.cacheKey)}),i.on("commonobj",([o,f,I])=>{if(!this.destroyed&&!this.commonObjs.has(o))switch(f){case"Font":const A=this._params;if("error"in I){const n=I.error;(0,_util.warn)(`Error during font loading: ${n}`),this.commonObjs.resolve(o,n);break}const T=A.pdfBug&&globalThis.FontInspector?.enabled?(n,t)=>globalThis.FontInspector.fontAdded(n,t):null,P=new _font_loader.FontFaceObject(I,{isEvalSupported:A.isEvalSupported,disableFontFace:A.disableFontFace,ignoreErrors:A.ignoreErrors,inspectFont:T});this.fontLoader.bind(P).catch(n=>i.sendWithPromise("FontFallback",{id:o})).finally(()=>{!A.fontExtraProperties&&P.data&&(P.data=null),this.commonObjs.resolve(o,P)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(o,I);break;default:throw new Error(`Got unknown common object type ${f}`)}}),i.on("obj",([o,f,I,A])=>{if(this.destroyed)return;const T=this.#e.get(f);if(!T.objs.has(o))switch(I){case"Image":if(T.objs.resolve(o,A),A){let P;if(A.bitmap){const{width:n,height:t}=A;P=n*t*4}else P=A.data?.length||0;P>_util.MAX_IMAGE_SIZE_TO_CACHE&&(T._maybeCleanupAfterRender=!0)}break;case"Pattern":T.objs.resolve(o,A);break;default:throw new Error(`Got unknown object type ${I}`)}}),i.on("DocProgress",o=>{this.destroyed||R.onProgress?.({loaded:o.loaded,total:o.total})}),i.on("FetchBuiltInCMap",o=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(o):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),i.on("FetchStandardFontData",o=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(o):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:i,transfers:R}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:i,filename:this._fullReader?.filename??null},R).finally(()=>{this.annotationStorage.resetModified()})}getPage(i){if(!Number.isInteger(i)||i<=0||i>this._numPages)return Promise.reject(new Error("Invalid page request."));const R=i-1,o=this.#s.get(R);if(o)return o;const f=this.messageHandler.sendWithPromise("GetPage",{pageIndex:R}).then(I=>{if(this.destroyed)throw new Error("Transport destroyed");const A=new PDFPageProxy(R,I,this,this._params.pdfBug);return this.#e.set(R,A),A});return this.#s.set(R,f),f}getPageIndex(i){return typeof i!="object"||i===null||!Number.isInteger(i.num)||i.num<0||!Number.isInteger(i.gen)||i.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:i.num,gen:i.gen})}getAnnotations(i,R){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:i,intent:R})}getFieldObjects(){return this.#o("GetFieldObjects")}hasJSActions(){return this.#o("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(i){return typeof i!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:i})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#o("GetDocJSActions")}getPageJSActions(i){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:i})}getStructTree(i){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:i})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(i=>new _optional_content_config.OptionalContentConfig(i))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const i="GetMetadata",R=this.#t.get(i);if(R)return R;const o=this.messageHandler.sendWithPromise(i,null).then(f=>({info:f[0],metadata:f[1]?new _metadata.Metadata(f[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(i,o),o}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(i=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const R of this.#e.values())if(!R.cleanup())throw new Error(`startCleanup: Page ${R.pageNumber} is currently rendering.`);this.commonObjs.clear(),i||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:i,enableXfa:R}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:i,enableXfa:R})}}class PDFObjects{#t=Object.create(null);#e(i){return this.#t[i]||={capability:new _util.PromiseCapability,data:null}}get(i,R=null){if(R){const f=this.#e(i);return f.capability.promise.then(()=>R(f.data)),null}const o=this.#t[i];if(!o?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${i}.`);return o.data}has(i){return this.#t[i]?.capability.settled||!1}resolve(i,R=null){const o=this.#e(i);o.data=R,o.capability.resolve()}clear(){for(const i in this.#t){const{data:R}=this.#t[i];R?.bitmap?.close()}this.#t=Object.create(null)}}class RenderTask{#t=null;constructor(i){this.#t=i,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(i=0){this.#t.cancel(null,i)}get separateAnnots(){const{separateAnnots:i}=this.#t.operatorList;if(!i)return!1;const{annotationCanvasMap:R}=this.#t;return i.form||i.canvas&&R?.size>0}}exports$1.RenderTask=RenderTask;class InternalRenderTask{static#t=new WeakSet;constructor({callback:i,params:R,objs:o,commonObjs:f,annotationCanvasMap:I,operatorList:A,pageIndex:T,canvasFactory:P,filterFactory:n,useRequestAnimationFrame:t=!1,pdfBug:s=!1,pageColors:a=null}){this.callback=i,this.params=R,this.objs=o,this.commonObjs=f,this.annotationCanvasMap=I,this.operatorListIdx=null,this.operatorList=A,this._pageIndex=T,this.canvasFactory=P,this.filterFactory=n,this._pdfBug=s,this.pageColors=a,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=t===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=R.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:i=!1,optionalContentConfig:R}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:o,viewport:f,transform:I,background:A}=this.params;this.gfx=new _canvas.CanvasGraphics(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:R},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:I,viewport:f,transparency:i,background:A}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(i=null,R=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback(i||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,R))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback())))}}const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SerializableEmpty=i.PrintAnnotationStorage=i.AnnotationStorage=void 0;var o=R(1),f=R(4),I=R(8);const A=Object.freeze({map:null,hash:"",transfers:void 0});i.SerializableEmpty=A;class T{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,s){const a=this.#e.get(t);return a===void 0?s:Object.assign(s,a)}getRawValue(t){return this.#e.get(t)}remove(t){if(this.#e.delete(t),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const s of this.#e.values())if(s instanceof f.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(t,s){const a=this.#e.get(t);let c=!1;if(a!==void 0)for(const[e,d]of Object.entries(s))a[e]!==d&&(c=!0,a[e]=d);else c=!0,this.#e.set(t,s);c&&this.#s(),s instanceof f.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(s.constructor._type)}has(t){return this.#e.has(t)}getAll(){return this.#e.size>0?(0,o.objectFromMap)(this.#e):null}setAll(t){for(const[s,a]of Object.entries(t))this.setValue(s,a)}get size(){return this.#e.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new P(this)}get serializable(){if(this.#e.size===0)return A;const t=new Map,s=new I.MurmurHash3_64,a=[],c=Object.create(null);let e=!1;for(const[d,m]of this.#e){const r=m instanceof f.AnnotationEditor?m.serialize(!1,c):m;r&&(t.set(d,r),s.update(`${d}:${JSON.stringify(r)}`),e||=!!r.bitmap)}if(e)for(const d of t.values())d.bitmap&&a.push(d.bitmap);return t.size>0?{map:t,hash:s.hexdigest(),transfers:a}:A}}i.AnnotationStorage=T;class P extends T{#t;constructor(t){super();const{map:s,hash:a,transfers:c}=t.serializable,e=structuredClone(s,c?{transfer:c}:null);this.#t={map:e,hash:a,transfers:c}}get print(){(0,o.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}i.PrintAnnotationStorage=P}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AnnotationEditor=void 0;var o=R(5),f=R(1),I=R(6);class A{#t="";#e=!1;#s=null;#n=null;#o=null;#a=!1;#r=null;#l=this.focusin.bind(this);#c=this.focusout.bind(this);#i=!1;#p=!1;#h=!1;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#u=!1;#m=A._zIndex++;static _borderLineWidth=-1;static _colorManager=new o.ColorManager;static _zIndex=1;static SMALL_EDITOR_SIZE=0;constructor(n){this.constructor===A&&(0,f.unreachable)("Cannot initialize AnnotationEditor."),this.parent=n.parent,this.id=n.id,this.width=this.height=null,this.pageIndex=n.parent.pageIndex,this.name=n.name,this.div=null,this._uiManager=n.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=n.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:a,pageX:c,pageY:e}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,a],this.pageTranslation=[c,e];const[d,m]=this.parentDimensions;this.x=n.x/d,this.y=n.y/m,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,f.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(n){const t=new T({id:n.parent.getNextId(),parent:n.parent,uiManager:n._uiManager});t.annotationElementId=n.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(n,t=null){if(A._l10nPromise||=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(a=>[a,n.get(a)])),t?.strings)for(const a of t.strings)A._l10nPromise.set(a,n.get(a));if(A._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);A._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(n,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(n){return!1}static paste(n,t){(0,f.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#u}set _isDraggable(n){this.#u=n,this.div?.classList.toggle("draggable",n)}center(){const[n,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(n*2),this.y+=this.width*n/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(n*2),this.y-=this.width*n/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(n){this._uiManager.addCommands(n)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#m}setParent(n){n!==null&&(this.pageIndex=n.pageIndex,this.pageDimensions=n.pageDimensions),this.parent=n}focusin(n){this._focusEventsAllowed&&(this.#i?this.#i=!1:this.parent.setSelected(this))}focusout(n){!this._focusEventsAllowed||!this.isAttachedToDOM||n.relatedTarget?.closest(`#${this.id}`)||(n.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(n,t,s,a){const[c,e]=this.parentDimensions;[s,a]=this.screenToPageTranslation(s,a),this.x=(n+s)/c,this.y=(t+a)/e,this.fixAndSetPosition()}#g([n,t],s,a){[s,a]=this.screenToPageTranslation(s,a),this.x+=s/n,this.y+=a/t,this.fixAndSetPosition()}translate(n,t){this.#g(this.parentDimensions,n,t)}translateInPage(n,t){this.#g(this.pageDimensions,n,t),this.div.scrollIntoView({block:"nearest"})}drag(n,t){const[s,a]=this.parentDimensions;if(this.x+=n/s,this.y+=t/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:r,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,r,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:c,y:e}=this;const[d,m]=this.#x();c+=d,e+=m,this.div.style.left=`${(100*c).toFixed(2)}%`,this.div.style.top=`${(100*e).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#x(){const[n,t]=this.parentDimensions,{_borderLineWidth:s}=A,a=s/n,c=s/t;switch(this.rotation){case 90:return[-a,c];case 180:return[a,c];case 270:return[a,-c];default:return[-a,-c]}}fixAndSetPosition(){const[n,t]=this.pageDimensions;let{x:s,y:a,width:c,height:e}=this;switch(c*=n,e*=t,s*=n,a*=t,this.rotation){case 0:s=Math.max(0,Math.min(n-c,s)),a=Math.max(0,Math.min(t-e,a));break;case 90:s=Math.max(0,Math.min(n-e,s)),a=Math.min(t,Math.max(c,a));break;case 180:s=Math.min(n,Math.max(c,s)),a=Math.min(t,Math.max(e,a));break;case 270:s=Math.min(n,Math.max(e,s)),a=Math.max(0,Math.min(t-c,a));break}this.x=s/=n,this.y=a/=t;const[d,m]=this.#x();s+=d,a+=m;const{style:r}=this.div;r.left=`${(100*s).toFixed(2)}%`,r.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#f(n,t,s){switch(s){case 90:return[t,-n];case 180:return[-n,-t];case 270:return[-t,n];default:return[n,t]}}screenToPageTranslation(n,t){return A.#f(n,t,this.parentRotation)}pageTranslationToScreen(n,t){return A.#f(n,t,360-this.parentRotation)}#d(n){switch(n){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:n,pageDimensions:[t,s]}=this,a=t*n,c=s*n;return f.FeatureTest.isCSSRoundSupported?[Math.round(a),Math.round(c)]:[a,c]}setDims(n,t){const[s,a]=this.parentDimensions;this.div.style.width=`${(100*n/s).toFixed(2)}%`,this.#a||(this.div.style.height=`${(100*t/a).toFixed(2)}%`),this.#s?.classList.toggle("small",n<A.SMALL_EDITOR_SIZE||t<A.SMALL_EDITOR_SIZE)}fixDims(){const{style:n}=this.div,{height:t,width:s}=n,a=s.endsWith("%"),c=!this.#a&&t.endsWith("%");if(a&&c)return;const[e,d]=this.parentDimensions;a||(n.width=`${(100*parseFloat(s)/e).toFixed(2)}%`),!this.#a&&!c&&(n.height=`${(100*parseFloat(t)/d).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#b(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const n=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||n.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const t of n){const s=document.createElement("div");this.#r.append(s),s.classList.add("resizer",t),s.addEventListener("pointerdown",this.#A.bind(this,t)),s.addEventListener("contextmenu",I.noContextMenu)}this.div.prepend(this.#r)}#A(n,t){t.preventDefault();const{isMac:s}=f.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&s)return;const a=this.#_.bind(this,n),c=this._isDraggable;this._isDraggable=!1;const e={passive:!0,capture:!0};window.addEventListener("pointermove",a,e);const d=this.x,m=this.y,r=this.width,b=this.height,w=this.parent.div.style.cursor,j=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const p=()=>{this._isDraggable=c,window.removeEventListener("pointerup",p),window.removeEventListener("blur",p),window.removeEventListener("pointermove",a,e),this.parent.div.style.cursor=w,this.div.style.cursor=j;const g=this.x,M=this.y,O=this.width,_=this.height;g===d&&M===m&&O===r&&_===b||this.addCommands({cmd:()=>{this.width=O,this.height=_,this.x=g,this.y=M;const[H,z]=this.parentDimensions;this.setDims(H*O,z*_),this.fixAndSetPosition()},undo:()=>{this.width=r,this.height=b,this.x=d,this.y=m;const[H,z]=this.parentDimensions;this.setDims(H*r,z*b),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",p),window.addEventListener("blur",p)}#_(n,t){const[s,a]=this.parentDimensions,c=this.x,e=this.y,d=this.width,m=this.height,r=A.MIN_SIZE/s,b=A.MIN_SIZE/a,w=C=>Math.round(C*1e4)/1e4,j=this.#d(this.rotation),p=(C,l)=>[j[0]*C+j[2]*l,j[1]*C+j[3]*l],g=this.#d(360-this.rotation),M=(C,l)=>[g[0]*C+g[2]*l,g[1]*C+g[3]*l];let O,_,H=!1,z=!1;switch(n){case"topLeft":H=!0,O=(C,l)=>[0,0],_=(C,l)=>[C,l];break;case"topMiddle":O=(C,l)=>[C/2,0],_=(C,l)=>[C/2,l];break;case"topRight":H=!0,O=(C,l)=>[C,0],_=(C,l)=>[0,l];break;case"middleRight":z=!0,O=(C,l)=>[C,l/2],_=(C,l)=>[0,l/2];break;case"bottomRight":H=!0,O=(C,l)=>[C,l],_=(C,l)=>[0,0];break;case"bottomMiddle":O=(C,l)=>[C/2,l],_=(C,l)=>[C/2,0];break;case"bottomLeft":H=!0,O=(C,l)=>[0,l],_=(C,l)=>[C,0];break;case"middleLeft":z=!0,O=(C,l)=>[0,l/2],_=(C,l)=>[C,l/2];break}const st=O(d,m),et=_(d,m);let K=p(...et);const nt=w(c+K[0]),J=w(e+K[1]);let L=1,y=1,[h,u]=this.screenToPageTranslation(t.movementX,t.movementY);if([h,u]=M(h/s,u/a),H){const C=Math.hypot(d,m);L=y=Math.max(Math.min(Math.hypot(et[0]-st[0]-h,et[1]-st[1]-u)/C,1/d,1/m),r/d,b/m)}else z?L=Math.max(r,Math.min(1,Math.abs(et[0]-st[0]-h)))/d:y=Math.max(b,Math.min(1,Math.abs(et[1]-st[1]-u)))/m;const E=w(d*L),k=w(m*y);K=p(..._(E,k));const N=nt-K[0],B=J-K[1];this.width=E,this.height=k,this.x=N,this.y=B,this.setDims(s*E,a*k),this.fixAndSetPosition()}async addAltTextButton(){if(this.#s)return;const n=this.#s=document.createElement("button");n.className="altText";const t=await A._l10nPromise.get("editor_alt_text_button_label");n.textContent=t,n.setAttribute("aria-label",t),n.tabIndex="0",n.addEventListener("contextmenu",I.noContextMenu),n.addEventListener("pointerdown",s=>s.stopPropagation()),n.addEventListener("click",s=>{s.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),n.addEventListener("keydown",s=>{s.target===n&&s.key==="Enter"&&(s.preventDefault(),this._uiManager.editAltText(this))}),this.#w(),this.div.append(n),A.SMALL_EDITOR_SIZE||(A.SMALL_EDITOR_SIZE=Math.min(128,Math.round(n.getBoundingClientRect().width*1.4)))}async#w(){const n=this.#s;if(!n)return;if(!this.#t&&!this.#e){n.classList.remove("done"),this.#n?.remove();return}A._l10nPromise.get("editor_alt_text_edit_button_label").then(s=>{n.setAttribute("aria-label",s)});let t=this.#n;if(!t){this.#n=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");const s=t.id=`alt-text-tooltip-${this.id}`;n.setAttribute("aria-describedby",s);const a=100;n.addEventListener("mouseenter",()=>{this.#o=setTimeout(()=>{this.#o=null,this.#n.classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},a)}),n.addEventListener("mouseleave",()=>{clearTimeout(this.#o),this.#o=null,this.#n?.classList.remove("show")})}n.classList.add("done"),t.innerText=this.#e?await A._l10nPromise.get("editor_alt_text_decorative_tooltip"):this.#t,t.parentNode||n.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:this.#t,decorative:this.#e}}set altTextData({altText:n,decorative:t}){this.#t===n&&this.#e===t||(this.#t=n,this.#e=t,this.#w())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#l),this.div.addEventListener("focusout",this.#c);const[n,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/n).toFixed(2)}%`,this.div.style.maxHeight=`${(100*n/t).toFixed(2)}%`);const[s,a]=this.getInitialTranslation();return this.translate(s,a),(0,o.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(n){const{isMac:t}=f.FeatureTest.platform;if(n.button!==0||n.ctrlKey&&t){n.preventDefault();return}this.#i=!0,this.#C(n)}#C(n){if(!this._isDraggable)return;const t=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let s,a;t&&(s={passive:!0,capture:!0},a=e=>{const[d,m]=this.screenToPageTranslation(e.movementX,e.movementY);this._uiManager.dragSelectedEditors(d,m)},window.addEventListener("pointermove",a,s));const c=()=>{if(window.removeEventListener("pointerup",c),window.removeEventListener("blur",c),t&&window.removeEventListener("pointermove",a,s),this.#i=!1,!this._uiManager.endDragSession()){const{isMac:e}=f.FeatureTest.platform;n.ctrlKey&&!e||n.shiftKey||n.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",c),window.addEventListener("blur",c)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(n,t,s){n.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition()}getRect(n,t){const s=this.parentScale,[a,c]=this.pageDimensions,[e,d]=this.pageTranslation,m=n/s,r=t/s,b=this.x*a,w=this.y*c,j=this.width*a,p=this.height*c;switch(this.rotation){case 0:return[b+m+e,c-w-r-p+d,b+m+j+e,c-w-r+d];case 90:return[b+r+e,c-w+m+d,b+r+p+e,c-w+m+j+d];case 180:return[b-m-j+e,c-w+r+d,b-m+e,c-w+r+p+d];case 270:return[b-r-p+e,c-w-m-j+d,b-r+e,c-w-m+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(n,t){const[s,a,c,e]=n,d=c-s,m=e-a;switch(this.rotation){case 0:return[s,t-e,d,m];case 90:return[s,t-a,m,d];case 180:return[c,t-a,d,m];case 270:return[c,t-e,m,d];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#h=!0}disableEditMode(){this.#h=!1}isInEditMode(){return this.#h}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#l),this.div?.addEventListener("focusout",this.#c)}serialize(n=!1,t=null){(0,f.unreachable)("An editor must be serializable")}static deserialize(n,t,s){const a=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});a.rotation=n.rotation;const[c,e]=a.pageDimensions,[d,m,r,b]=a.getRectInCurrentCoords(n.rect,e);return a.x=d/c,a.y=m/e,a.width=r/c,a.height=b/e,a}remove(){this.div.removeEventListener("focusin",this.#l),this.div.removeEventListener("focusout",this.#c),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#s?.remove(),this.#s=null,this.#n=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#b(),this.#r.classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(n,t){}disableEditing(){this.#s&&(this.#s.hidden=!0)}enableEditing(){this.#s&&(this.#s.hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(n){this.#p=n,this.parent&&(n?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(n,t){this.#a=!0;const s=n/t,{style:a}=this.div;a.aspectRatio=s,a.height="auto"}static get MIN_SIZE(){return 16}}i.AnnotationEditor=A;class T extends A{constructor(n){super(n),this.annotationElementId=n.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.KeyboardManager=i.CommandManager=i.ColorManager=i.AnnotationEditorUIManager=void 0,i.bindEvents=I,i.opacityToHex=A;var o=R(1),f=R(6);function I(c,e,d){for(const m of d)e.addEventListener(m,c[m].bind(c))}function A(c){return Math.round(Math.min(255,Math.max(1,255*c))).toString(16).padStart(2,"0")}class T{#t=0;getId(){return`${o.AnnotationEditorPrefix}${this.#t++}`}}class P{#t=(0,o.getUuid)();#e=0;#s=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',m=new OffscreenCanvas(1,3).getContext("2d"),r=new Image;r.src=e;const b=r.decode().then(()=>(m.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(m.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,o.shadow)(this,"_isSVGFittingCanvas",b)}async#n(e,d){this.#s||=new Map;let m=this.#s.get(e);if(m===null)return null;if(m?.bitmap)return m.refCounter+=1,m;try{m||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let r;if(typeof d=="string"){m.url=d;const b=await fetch(d);if(!b.ok)throw new Error(b.statusText);r=await b.blob()}else r=m.file=d;if(r.type==="image/svg+xml"){const b=P._isSVGFittingCanvas,w=new FileReader,j=new Image,p=new Promise((g,M)=>{j.onload=()=>{m.bitmap=j,m.isSvg=!0,g()},w.onload=async()=>{const O=m.svgUrl=w.result;j.src=await b?`${O}#svgView(preserveAspectRatio(none))`:O},j.onerror=w.onerror=M});w.readAsDataURL(r),await p}else m.bitmap=await createImageBitmap(r);m.refCounter=1}catch(r){console.error(r),m=null}return this.#s.set(e,m),m&&this.#s.set(m.id,m),m}async getFromFile(e){const{lastModified:d,name:m,size:r,type:b}=e;return this.#n(`${d}_${m}_${r}_${b}`,e)}async getFromUrl(e){return this.#n(e,e)}async getFromId(e){this.#s||=new Map;const d=this.#s.get(e);return d?d.bitmap?(d.refCounter+=1,d):d.file?this.getFromFile(d.file):this.getFromUrl(d.url):null}getSvgUrl(e){const d=this.#s.get(e);return d?.isSvg?d.svgUrl:null}deleteId(e){this.#s||=new Map;const d=this.#s.get(e);d&&(d.refCounter-=1,d.refCounter===0&&(d.bitmap=null))}isValidId(e){return e.startsWith(`image_${this.#t}_`)}}class n{#t=[];#e=!1;#s;#n=-1;constructor(e=128){this.#s=e}add({cmd:e,undo:d,mustExec:m,type:r=NaN,overwriteIfSameType:b=!1,keepUndo:w=!1}){if(m&&e(),this.#e)return;const j={cmd:e,undo:d,type:r};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(j);return}if(b&&this.#t[this.#n].type===r){w&&(j.undo=this.#t[this.#n].undo),this.#t[this.#n]=j;return}const p=this.#n+1;p===this.#s?this.#t.splice(0,1):(this.#n=p,p<this.#t.length&&this.#t.splice(p)),this.#t.push(j)}undo(){this.#n!==-1&&(this.#e=!0,this.#t[this.#n].undo(),this.#e=!1,this.#n-=1)}redo(){this.#n<this.#t.length-1&&(this.#n+=1,this.#e=!0,this.#t[this.#n].cmd(),this.#e=!1)}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}destroy(){this.#t=null}}i.CommandManager=n;class t{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:d}=o.FeatureTest.platform;for(const[m,r,b={}]of e)for(const w of m){const j=w.startsWith("mac+");d&&j?(this.callbacks.set(w.slice(4),{callback:r,options:b}),this.allKeys.add(w.split("+").at(-1))):!d&&!j&&(this.callbacks.set(w,{callback:r,options:b}),this.allKeys.add(w.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const d=this.buffer.join("+");return this.buffer.length=0,d}exec(e,d){if(!this.allKeys.has(d.key))return;const m=this.callbacks.get(this.#t(d));if(!m)return;const{callback:r,options:{bubbles:b=!1,args:w=[],checker:j=null}}=m;j&&!j(e,d)||(r.bind(e,...w)(),b||(d.stopPropagation(),d.preventDefault()))}}i.KeyboardManager=t;class s{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,f.getColorValues)(e),(0,o.shadow)(this,"_colors",e)}convert(e){const d=(0,f.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return d;for(const[m,r]of this._colors)if(r.every((b,w)=>b===d[w]))return s._colorsMapping.get(m);return d}getHexCode(e){const d=this._colors.get(e);return d?o.Util.makeHexColor(...d):e}}i.ColorManager=s;class a{#t=null;#e=new Map;#s=new Map;#n=null;#o=null;#a=new n;#r=0;#l=new Set;#c=null;#i=null;#p=new Set;#h=null;#u=new T;#m=!1;#g=!1;#x=null;#f=o.AnnotationEditorType.NONE;#d=new Set;#b=null;#A=this.blur.bind(this);#_=this.focus.bind(this);#w=this.copy.bind(this);#C=this.cut.bind(this);#F=this.paste.bind(this);#I=this.keydown.bind(this);#L=this.onEditingAction.bind(this);#y=this.onPageChanging.bind(this);#M=this.onScaleChanging.bind(this);#N=this.onRotationChanging.bind(this);#k={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#E=[0,0];#S=null;#j=null;#D=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=a.prototype,d=b=>{const{activeElement:w}=document;return w&&b.#j.contains(w)&&b.hasSomethingToControl()},m=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return(0,o.shadow)(this,"_keyboardManager",new t([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-m,0],checker:d}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:d}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[m,0],checker:d}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:d}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-m],checker:d}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:d}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,m],checker:d}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:d}]]))}constructor(e,d,m,r,b,w){this.#j=e,this.#D=d,this.#n=m,this._eventBus=r,this._eventBus._on("editingaction",this.#L),this._eventBus._on("pagechanging",this.#y),this._eventBus._on("scalechanging",this.#M),this._eventBus._on("rotationchanging",this.#N),this.#o=b.annotationStorage,this.#h=b.filterFactory,this.#b=w,this.viewParameters={realScale:f.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#T(),this.#B(),this._eventBus._off("editingaction",this.#L),this._eventBus._off("pagechanging",this.#y),this._eventBus._off("scalechanging",this.#M),this._eventBus._off("rotationchanging",this.#N);for(const e of this.#s.values())e.destroy();this.#s.clear(),this.#e.clear(),this.#p.clear(),this.#t=null,this.#d.clear(),this.#a.destroy(),this.#n.destroy()}get hcmFilter(){return(0,o.shadow)(this,"hcmFilter",this.#b?this.#h.addHCMFilter(this.#b.foreground,this.#b.background):"none")}get direction(){return(0,o.shadow)(this,"direction",getComputedStyle(this.#j).direction)}editAltText(e){this.#n?.editAltText(this,e)}onPageChanging({pageNumber:e}){this.#r=e-1}focusMainContainer(){this.#j.focus()}findParent(e,d){for(const m of this.#s.values()){const{x:r,y:b,width:w,height:j}=m.div.getBoundingClientRect();if(e>=r&&e<=r+w&&d>=b&&d<=b+j)return m}return null}disableUserSelect(e=!1){this.#D.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*f.PixelsPerInch.PDF_TO_CSS_UNITS;for(const d of this.#p)d.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&this.#o&&!this.#o.has(e.id)&&this.#o.setValue(e.id,e)}#O(){window.addEventListener("focus",this.#_),window.addEventListener("blur",this.#A)}#B(){window.removeEventListener("focus",this.#_),window.removeEventListener("blur",this.#A)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const d of this.#d)if(d.div.contains(e)){this.#x=[d,e],d._focusEventsAllowed=!1;break}}focus(){if(!this.#x)return;const[e,d]=this.#x;this.#x=null,d.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),d.focus()}#U(){window.addEventListener("keydown",this.#I,{capture:!0})}#T(){window.removeEventListener("keydown",this.#I,{capture:!0})}#P(){document.addEventListener("copy",this.#w),document.addEventListener("cut",this.#C),document.addEventListener("paste",this.#F)}#R(){document.removeEventListener("copy",this.#w),document.removeEventListener("cut",this.#C),document.removeEventListener("paste",this.#F)}addEditListeners(){this.#U(),this.#P()}removeEditListeners(){this.#T(),this.#R()}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const d=[];for(const m of this.#d){const r=m.serialize(!0);r&&d.push(r)}d.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(d))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:d}=e;for(const b of d.items)for(const w of this.#i)if(w.isHandlingMimeForPasting(b.type)){w.paste(b,this.currentLayer);return}let m=d.getData("application/pdfjs");if(!m)return;try{m=JSON.parse(m)}catch(b){(0,o.warn)(`paste: "${b.message}".`);return}if(!Array.isArray(m))return;this.unselectAll();const r=this.currentLayer;try{const b=[];for(const p of m){const g=r.deserialize(p);if(!g)return;b.push(g)}const w=()=>{for(const p of b)this.#z(p);this.#q(b)},j=()=>{for(const p of b)p.remove()};this.addCommands({cmd:w,undo:j,mustExec:!0})}catch(b){(0,o.warn)(`paste: "${b.message}".`)}}keydown(e){this.getActive()?.shouldGetKeyboardEvents()||a._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}#v(e){Object.entries(e).some(([m,r])=>this.#k[m]!==r)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#k,e)})}#H(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#O(),this.#U(),this.#P(),this.#v({isEditing:this.#f!==o.AnnotationEditorType.NONE,isEmpty:this.#W(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#B(),this.#T(),this.#R(),this.#v({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#i){this.#i=e;for(const d of this.#i)this.#H(d.defaultPropertiesToUpdate)}}getId(){return this.#u.getId()}get currentLayer(){return this.#s.get(this.#r)}getLayer(e){return this.#s.get(e)}get currentPageIndex(){return this.#r}addLayer(e){this.#s.set(e.pageIndex,e),this.#m?e.enable():e.disable()}removeLayer(e){this.#s.delete(e.pageIndex)}updateMode(e,d=null){if(this.#f!==e){if(this.#f=e,e===o.AnnotationEditorType.NONE){this.setEditingState(!1),this.#G();return}this.setEditingState(!0),this.#V(),this.unselectAll();for(const m of this.#s.values())m.updateMode(e);if(d){for(const m of this.#e.values())if(m.annotationElementId===d){this.setSelected(m),m.enterInEditMode();break}}}}updateToolbar(e){e!==this.#f&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,d){if(this.#i){if(e===o.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const m of this.#d)m.updateParams(e,d);for(const m of this.#i)m.updateDefaultParams(e,d)}}enableWaiting(e=!1){if(this.#g!==e){this.#g=e;for(const d of this.#s.values())e?d.disableClick():d.enableClick(),d.div.classList.toggle("waiting",e)}}#V(){if(!this.#m){this.#m=!0;for(const e of this.#s.values())e.enable()}}#G(){if(this.unselectAll(),this.#m){this.#m=!1;for(const e of this.#s.values())e.disable()}}getEditors(e){const d=[];for(const m of this.#e.values())m.pageIndex===e&&d.push(m);return d}getEditor(e){return this.#e.get(e)}addEditor(e){this.#e.set(e.id,e)}removeEditor(e){this.#e.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#l.has(e.annotationElementId))&&this.#o?.remove(e.id)}addDeletedAnnotationElement(e){this.#l.add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return this.#l.has(e)}removeDeletedAnnotationElement(e){this.#l.delete(e.annotationElementId),e.deleted=!1}#z(e){const d=this.#s.get(e.pageIndex);d?d.addOrRebuild(e):this.addEditor(e)}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#H(e.propertiesToUpdate))}toggleSelected(e){if(this.#d.has(e)){this.#d.delete(e),e.unselect(),this.#v({hasSelectedEditor:this.hasSelection});return}this.#d.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}setSelected(e){for(const d of this.#d)d!==e&&d.unselect();this.#d.clear(),this.#d.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}isSelected(e){return this.#d.has(e)}unselect(e){e.unselect(),this.#d.delete(e),this.#v({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#d.size!==0}undo(){this.#a.undo(),this.#v({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#W()})}redo(){this.#a.redo(),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#W()})}addCommands(e){this.#a.add(e),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#W()})}#W(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const e of this.#e.values())return e.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...this.#d],d=()=>{for(const r of e)r.remove()},m=()=>{for(const r of e)this.#z(r)};this.addCommands({cmd:d,undo:m,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#q(e){this.#d.clear();for(const d of e)d.isEmpty()||(this.#d.add(d),d.select());this.#v({hasSelectedEditor:!0})}selectAll(){for(const e of this.#d)e.commit();this.#q(this.#e.values())}unselectAll(){if(this.#t){this.#t.commitOrRemove();return}if(this.hasSelection){for(const e of this.#d)e.unselect();this.#d.clear(),this.#v({hasSelectedEditor:!1})}}translateSelectedEditors(e,d,m=!1){if(m||this.commitOrRemove(),!this.hasSelection)return;this.#E[0]+=e,this.#E[1]+=d;const[r,b]=this.#E,w=[...this.#d],j=1e3;this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.#S=null,this.#E[0]=this.#E[1]=0,this.addCommands({cmd:()=>{for(const p of w)this.#e.has(p.id)&&p.translateInPage(r,b)},undo:()=>{for(const p of w)this.#e.has(p.id)&&p.translateInPage(-r,-b)},mustExec:!1})},j);for(const p of w)p.translateInPage(e,d)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#c=new Map;for(const e of this.#d)this.#c.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#c)return!1;this.disableUserSelect(!1);const e=this.#c;this.#c=null;let d=!1;for(const[{x:r,y:b,pageIndex:w},j]of e)j.newX=r,j.newY=b,j.newPageIndex=w,d||=r!==j.savedX||b!==j.savedY||w!==j.savedPageIndex;if(!d)return!1;const m=(r,b,w,j)=>{if(this.#e.has(r.id)){const p=this.#s.get(j);p?r._setParentAndPosition(p,b,w):(r.pageIndex=j,r.x=b,r.y=w)}};return this.addCommands({cmd:()=>{for(const[r,{newX:b,newY:w,newPageIndex:j}]of e)m(r,b,w,j)},undo:()=>{for(const[r,{savedX:b,savedY:w,savedPageIndex:j}]of e)m(r,b,w,j)},mustExec:!0}),!0}dragSelectedEditors(e,d){if(this.#c)for(const m of this.#c.keys())m.drag(e,d)}rebuild(e){if(e.parent===null){const d=this.getLayer(e.pageIndex);d?(d.changeParent(e),d.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#f}get imageManager(){return(0,o.shadow)(this,"imageManager",new P)}}i.AnnotationEditorUIManager=a}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.StatTimer=i.RenderingCancelledException=i.PixelsPerInch=i.PageViewport=i.PDFDateString=i.DOMStandardFontDataFactory=i.DOMSVGFactory=i.DOMFilterFactory=i.DOMCanvasFactory=i.DOMCMapReaderFactory=void 0,i.deprecated=M,i.getColorValues=st,i.getCurrentTransform=et,i.getCurrentTransformInverse=K,i.getFilenameFromUrl=r,i.getPdfFilenameFromUrl=b,i.getRGB=z,i.getXfaPageViewport=H,i.isDataScheme=d,i.isPdfFile=m,i.isValidFetchUrl=j,i.loadScript=g,i.noContextMenu=p,i.setLayerDimensions=nt;var o=R(7),f=R(1);const I="http://www.w3.org/2000/svg";class A{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}i.PixelsPerInch=A;class T extends o.BaseFilterFactory{#t;#e;#s;#n;#o;#a;#r;#l;#c;#i;#p=0;constructor({docId:L,ownerDocument:y=globalThis.document}={}){super(),this.#s=L,this.#n=y}get#h(){return this.#t||=new Map}get#u(){if(!this.#e){const L=this.#n.createElement("div"),{style:y}=L;y.visibility="hidden",y.contain="strict",y.width=y.height=0,y.position="absolute",y.top=y.left=0,y.zIndex=-1;const h=this.#n.createElementNS(I,"svg");h.setAttribute("width",0),h.setAttribute("height",0),this.#e=this.#n.createElementNS(I,"defs"),L.append(h),h.append(this.#e),this.#n.body.append(L)}return this.#e}addFilter(L){if(!L)return"none";let y=this.#h.get(L);if(y)return y;let h,u,E,k;if(L.length===1){const l=L[0],x=new Array(256);for(let v=0;v<256;v++)x[v]=l[v]/255;k=h=u=E=x.join(",")}else{const[l,x,v]=L,S=new Array(256),F=new Array(256),U=new Array(256);for(let W=0;W<256;W++)S[W]=l[W]/255,F[W]=x[W]/255,U[W]=v[W]/255;h=S.join(","),u=F.join(","),E=U.join(","),k=`${h}${u}${E}`}if(y=this.#h.get(k),y)return this.#h.set(L,y),y;const N=`g_${this.#s}_transfer_map_${this.#p++}`,B=`url(#${N})`;this.#h.set(L,B),this.#h.set(k,B);const C=this.#g(N);return this.#f(h,u,E,C),B}addHCMFilter(L,y){const h=`${L}-${y}`;if(this.#a===h)return this.#r;if(this.#a=h,this.#r="none",this.#o?.remove(),!L||!y)return this.#r;const u=this.#d(L);L=f.Util.makeHexColor(...u);const E=this.#d(y);if(y=f.Util.makeHexColor(...E),this.#u.style.color="",L==="#000000"&&y==="#ffffff"||L===y)return this.#r;const k=new Array(256);for(let x=0;x<=255;x++){const v=x/255;k[x]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const N=k.join(","),B=`g_${this.#s}_hcm_filter`,C=this.#l=this.#g(B);this.#f(N,N,N,C),this.#m(C);const l=(x,v)=>{const S=u[x]/255,F=E[x]/255,U=new Array(v+1);for(let W=0;W<=v;W++)U[W]=S+W/v*(F-S);return U.join(",")};return this.#f(l(0,5),l(1,5),l(2,5),C),this.#r=`url(#${B})`,this.#r}addHighlightHCMFilter(L,y,h,u){const E=`${L}-${y}-${h}-${u}`;if(this.#c===E)return this.#i;if(this.#c=E,this.#i="none",this.#l?.remove(),!L||!y)return this.#i;const[k,N]=[L,y].map(this.#d.bind(this));let B=Math.round(.2126*k[0]+.7152*k[1]+.0722*k[2]),C=Math.round(.2126*N[0]+.7152*N[1]+.0722*N[2]),[l,x]=[h,u].map(this.#d.bind(this));C<B&&([B,C,l,x]=[C,B,x,l]),this.#u.style.color="";const v=(U,W,G)=>{const at=new Array(256),$=(C-B)/G,Q=U/255,tt=(W-U)/(255*G);let Z=0;for(let it=0;it<=G;it++){const ot=Math.round(B+it*$),ct=Q+it*tt;for(let ht=Z;ht<=ot;ht++)at[ht]=ct;Z=ot+1}for(let it=Z;it<256;it++)at[it]=at[Z-1];return at.join(",")},S=`g_${this.#s}_hcm_highlight_filter`,F=this.#l=this.#g(S);return this.#m(F),this.#f(v(l[0],x[0],5),v(l[1],x[1],5),v(l[2],x[2],5),F),this.#i=`url(#${S})`,this.#i}destroy(L=!1){L&&(this.#r||this.#i)||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#p=0)}#m(L){const y=this.#n.createElementNS(I,"feColorMatrix");y.setAttribute("type","matrix"),y.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),L.append(y)}#g(L){const y=this.#n.createElementNS(I,"filter");return y.setAttribute("color-interpolation-filters","sRGB"),y.setAttribute("id",L),this.#u.append(y),y}#x(L,y,h){const u=this.#n.createElementNS(I,y);u.setAttribute("type","discrete"),u.setAttribute("tableValues",h),L.append(u)}#f(L,y,h,u){const E=this.#n.createElementNS(I,"feComponentTransfer");u.append(E),this.#x(E,"feFuncR",L),this.#x(E,"feFuncG",y),this.#x(E,"feFuncB",h)}#d(L){return this.#u.style.color=L,z(getComputedStyle(this.#u).getPropertyValue("color"))}}i.DOMFilterFactory=T;class P extends o.BaseCanvasFactory{constructor({ownerDocument:L=globalThis.document}={}){super(),this._document=L}_createCanvas(L,y){const h=this._document.createElement("canvas");return h.width=L,h.height=y,h}}i.DOMCanvasFactory=P;async function n(J,L=!1){if(j(J,document.baseURI)){const y=await fetch(J);if(!y.ok)throw new Error(y.statusText);return L?new Uint8Array(await y.arrayBuffer()):(0,f.stringToBytes)(await y.text())}return new Promise((y,h)=>{const u=new XMLHttpRequest;u.open("GET",J,!0),L&&(u.responseType="arraybuffer"),u.onreadystatechange=()=>{if(u.readyState===XMLHttpRequest.DONE){if(u.status===200||u.status===0){let E;if(L&&u.response?E=new Uint8Array(u.response):!L&&u.responseText&&(E=(0,f.stringToBytes)(u.responseText)),E){y(E);return}}h(new Error(u.statusText))}},u.send(null)})}class t extends o.BaseCMapReaderFactory{_fetchData(L,y){return n(L,this.isCompressed).then(h=>({cMapData:h,compressionType:y}))}}i.DOMCMapReaderFactory=t;class s extends o.BaseStandardFontDataFactory{_fetchData(L){return n(L,!0)}}i.DOMStandardFontDataFactory=s;class a extends o.BaseSVGFactory{_createSVG(L){return document.createElementNS(I,L)}}i.DOMSVGFactory=a;class c{constructor({viewBox:L,scale:y,rotation:h,offsetX:u=0,offsetY:E=0,dontFlip:k=!1}){this.viewBox=L,this.scale=y,this.rotation=h,this.offsetX=u,this.offsetY=E;const N=(L[2]+L[0])/2,B=(L[3]+L[1])/2;let C,l,x,v;switch(h%=360,h<0&&(h+=360),h){case 180:C=-1,l=0,x=0,v=1;break;case 90:C=0,l=1,x=1,v=0;break;case 270:C=0,l=-1,x=-1,v=0;break;case 0:C=1,l=0,x=0,v=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}k&&(x=-x,v=-v);let S,F,U,W;C===0?(S=Math.abs(B-L[1])*y+u,F=Math.abs(N-L[0])*y+E,U=(L[3]-L[1])*y,W=(L[2]-L[0])*y):(S=Math.abs(N-L[0])*y+u,F=Math.abs(B-L[1])*y+E,U=(L[2]-L[0])*y,W=(L[3]-L[1])*y),this.transform=[C*y,l*y,x*y,v*y,S-C*y*N-x*y*B,F-l*y*N-v*y*B],this.width=U,this.height=W}get rawDims(){const{viewBox:L}=this;return(0,f.shadow)(this,"rawDims",{pageWidth:L[2]-L[0],pageHeight:L[3]-L[1],pageX:L[0],pageY:L[1]})}clone({scale:L=this.scale,rotation:y=this.rotation,offsetX:h=this.offsetX,offsetY:u=this.offsetY,dontFlip:E=!1}={}){return new c({viewBox:this.viewBox.slice(),scale:L,rotation:y,offsetX:h,offsetY:u,dontFlip:E})}convertToViewportPoint(L,y){return f.Util.applyTransform([L,y],this.transform)}convertToViewportRectangle(L){const y=f.Util.applyTransform([L[0],L[1]],this.transform),h=f.Util.applyTransform([L[2],L[3]],this.transform);return[y[0],y[1],h[0],h[1]]}convertToPdfPoint(L,y){return f.Util.applyInverseTransform([L,y],this.transform)}}i.PageViewport=c;class e extends f.BaseException{constructor(L,y=0){super(L,"RenderingCancelledException"),this.extraDelay=y}}i.RenderingCancelledException=e;function d(J){const L=J.length;let y=0;for(;y<L&&J[y].trim()==="";)y++;return J.substring(y,y+5).toLowerCase()==="data:"}function m(J){return typeof J=="string"&&/\.pdf$/i.test(J)}function r(J,L=!1){return L||([J]=J.split(/[#?]/,1)),J.substring(J.lastIndexOf("/")+1)}function b(J,L="document.pdf"){if(typeof J!="string")return L;if(d(J))return(0,f.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),L;const y=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,h=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,u=y.exec(J);let E=h.exec(u[1])||h.exec(u[2])||h.exec(u[3]);if(E&&(E=E[0],E.includes("%")))try{E=h.exec(decodeURIComponent(E))[0]}catch{}return E||L}class w{started=Object.create(null);times=[];time(L){L in this.started&&(0,f.warn)(`Timer is already running for ${L}`),this.started[L]=Date.now()}timeEnd(L){L in this.started||(0,f.warn)(`Timer has not been started for ${L}`),this.times.push({name:L,start:this.started[L],end:Date.now()}),delete this.started[L]}toString(){const L=[];let y=0;for(const{name:h}of this.times)y=Math.max(h.length,y);for(const{name:h,start:u,end:E}of this.times)L.push(`${h.padEnd(y)} ${E-u}ms
`);return L.join("")}}i.StatTimer=w;function j(J,L){try{const{protocol:y}=L?new URL(J,L):new URL(J);return y==="http:"||y==="https:"}catch{return!1}}function p(J){J.preventDefault()}function g(J,L=!1){return new Promise((y,h)=>{const u=document.createElement("script");u.src=J,u.onload=function(E){L&&u.remove(),y(E)},u.onerror=function(){h(new Error(`Cannot load script at: ${u.src}`))},(document.head||document.documentElement).append(u)})}function M(J){console.log("Deprecated API usage: "+J)}let O;class _{static toDateObject(L){if(!L||typeof L!="string")return null;O||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const y=O.exec(L);if(!y)return null;const h=parseInt(y[1],10);let u=parseInt(y[2],10);u=u>=1&&u<=12?u-1:0;let E=parseInt(y[3],10);E=E>=1&&E<=31?E:1;let k=parseInt(y[4],10);k=k>=0&&k<=23?k:0;let N=parseInt(y[5],10);N=N>=0&&N<=59?N:0;let B=parseInt(y[6],10);B=B>=0&&B<=59?B:0;const C=y[7]||"Z";let l=parseInt(y[8],10);l=l>=0&&l<=23?l:0;let x=parseInt(y[9],10)||0;return x=x>=0&&x<=59?x:0,C==="-"?(k+=l,N+=x):C==="+"&&(k-=l,N-=x),new Date(Date.UTC(h,u,E,k,N,B))}}i.PDFDateString=_;function H(J,{scale:L=1,rotation:y=0}){const{width:h,height:u}=J.attributes.style,E=[0,0,parseInt(h),parseInt(u)];return new c({viewBox:E,scale:L,rotation:y})}function z(J){if(J.startsWith("#")){const L=parseInt(J.slice(1),16);return[(L&16711680)>>16,(L&65280)>>8,L&255]}return J.startsWith("rgb(")?J.slice(4,-1).split(",").map(L=>parseInt(L)):J.startsWith("rgba(")?J.slice(5,-1).split(",").map(L=>parseInt(L)).slice(0,3):((0,f.warn)(`Not a valid color format: "${J}"`),[0,0,0])}function st(J){const L=document.createElement("span");L.style.visibility="hidden",document.body.append(L);for(const y of J.keys()){L.style.color=y;const h=window.getComputedStyle(L).color;J.set(y,z(h))}L.remove()}function et(J){const{a:L,b:y,c:h,d:u,e:E,f:k}=J.getTransform();return[L,y,h,u,E,k]}function K(J){const{a:L,b:y,c:h,d:u,e:E,f:k}=J.getTransform().invertSelf();return[L,y,h,u,E,k]}function nt(J,L,y=!1,h=!0){if(L instanceof c){const{pageWidth:u,pageHeight:E}=L.rawDims,{style:k}=J,N=f.FeatureTest.isCSSRoundSupported,B=`var(--scale-factor) * ${u}px`,C=`var(--scale-factor) * ${E}px`,l=N?`round(${B}, 1px)`:`calc(${B})`,x=N?`round(${C}, 1px)`:`calc(${C})`;!y||L.rotation%180===0?(k.width=l,k.height=x):(k.width=x,k.height=l)}h&&J.setAttribute("data-main-rotation",L.rotation)}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BaseStandardFontDataFactory=i.BaseSVGFactory=i.BaseFilterFactory=i.BaseCanvasFactory=i.BaseCMapReaderFactory=void 0;var o=R(1);class f{constructor(){this.constructor===f&&(0,o.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,s){return"none"}addHighlightHCMFilter(t,s,a,c){return"none"}destroy(t=!1){}}i.BaseFilterFactory=f;class I{constructor(){this.constructor===I&&(0,o.unreachable)("Cannot initialize BaseCanvasFactory.")}create(t,s){if(t<=0||s<=0)throw new Error("Invalid canvas size");const a=this._createCanvas(t,s);return{canvas:a,context:a.getContext("2d")}}reset(t,s,a){if(!t.canvas)throw new Error("Canvas is not specified");if(s<=0||a<=0)throw new Error("Invalid canvas size");t.canvas.width=s,t.canvas.height=a}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,s){(0,o.unreachable)("Abstract method `_createCanvas` called.")}}i.BaseCanvasFactory=I;class A{constructor({baseUrl:t=null,isCompressed:s=!0}){this.constructor===A&&(0,o.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=s}async fetch({name:t}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const s=this.baseUrl+t+(this.isCompressed?".bcmap":""),a=this.isCompressed?o.CMapCompressionType.BINARY:o.CMapCompressionType.NONE;return this._fetchData(s,a).catch(c=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${s}`)})}_fetchData(t,s){(0,o.unreachable)("Abstract method `_fetchData` called.")}}i.BaseCMapReaderFactory=A;class T{constructor({baseUrl:t=null}){this.constructor===T&&(0,o.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const s=`${this.baseUrl}${t}`;return this._fetchData(s).catch(a=>{throw new Error(`Unable to load font data at: ${s}`)})}_fetchData(t){(0,o.unreachable)("Abstract method `_fetchData` called.")}}i.BaseStandardFontDataFactory=T;class P{constructor(){this.constructor===P&&(0,o.unreachable)("Cannot initialize BaseSVGFactory.")}create(t,s,a=!1){if(t<=0||s<=0)throw new Error("Invalid SVG dimensions");const c=this._createSVG("svg:svg");return c.setAttribute("version","1.1"),a||(c.setAttribute("width",`${t}px`),c.setAttribute("height",`${s}px`)),c.setAttribute("preserveAspectRatio","none"),c.setAttribute("viewBox",`0 0 ${t} ${s}`),c}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){(0,o.unreachable)("Abstract method `_createSVG` called.")}}i.BaseSVGFactory=P}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.MurmurHash3_64=void 0;var o=R(1);const f=3285377520,I=4294901760,A=65535;class T{constructor(n){this.h1=n?n&4294967295:f,this.h2=n?n&4294967295:f}update(n){let t,s;if(typeof n=="string"){t=new Uint8Array(n.length*2),s=0;for(let M=0,O=n.length;M<O;M++){const _=n.charCodeAt(M);_<=255?t[s++]=_:(t[s++]=_>>>8,t[s++]=_&255)}}else if((0,o.isArrayBuffer)(n))t=n.slice(),s=t.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const a=s>>2,c=s-a*4,e=new Uint32Array(t.buffer,0,a);let d=0,m=0,r=this.h1,b=this.h2;const w=3432918353,j=461845907,p=w&A,g=j&A;for(let M=0;M<a;M++)M&1?(d=e[M],d=d*w&I|d*p&A,d=d<<15|d>>>17,d=d*j&I|d*g&A,r^=d,r=r<<13|r>>>19,r=r*5+3864292196):(m=e[M],m=m*w&I|m*p&A,m=m<<15|m>>>17,m=m*j&I|m*g&A,b^=m,b=b<<13|b>>>19,b=b*5+3864292196);switch(d=0,c){case 3:d^=t[a*4+2]<<16;case 2:d^=t[a*4+1]<<8;case 1:d^=t[a*4],d=d*w&I|d*p&A,d=d<<15|d>>>17,d=d*j&I|d*g&A,a&1?r^=d:b^=d}this.h1=r,this.h2=b}hexdigest(){let n=this.h1,t=this.h2;return n^=t>>>1,n=n*3981806797&I|n*36045&A,t=t*4283543511&I|((t<<16|n>>>16)*2950163797&I)>>>16,n^=t>>>1,n=n*444984403&I|n*60499&A,t=t*3301882366&I|((t<<16|n>>>16)*3120437893&I)>>>16,n^=t>>>1,(n>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}i.MurmurHash3_64=T}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FontLoader=i.FontFaceObject=void 0;var o=R(1);class f{#t=new Set;constructor({ownerDocument:T=globalThis.document,styleElement:P=null}){this._document=T,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(T){this.nativeFontFaces.add(T),this._document.fonts.add(T)}removeNativeFontFace(T){this.nativeFontFaces.delete(T),this._document.fonts.delete(T)}insertRule(T){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const P=this.styleElement.sheet;P.insertRule(T,P.cssRules.length)}clear(){for(const T of this.nativeFontFaces)this._document.fonts.delete(T);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(T){if(!(!T||this.#t.has(T.loadedName))){if((0,o.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:P,src:n,style:t}=T,s=new FontFace(P,n,t);this.addNativeFontFace(s);try{await s.load(),this.#t.add(P)}catch{(0,o.warn)(`Cannot load system font: ${T.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(s)}return}(0,o.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(T){if(T.attached||T.missingFile&&!T.systemFontInfo)return;if(T.attached=!0,T.systemFontInfo){await this.loadSystemFont(T.systemFontInfo);return}if(this.isFontLoadingAPISupported){const n=T.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(t){throw(0,o.warn)(`Failed to load font '${n.family}': '${t}'.`),T.disableFontFace=!0,t}}return}const P=T.createFontFaceRule();if(P){if(this.insertRule(P),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const t=this._queueLoadingCallback(n);this._prepareFontLoadEvent(T,t)})}}get isFontLoadingAPISupported(){const T=!!this._document?.fonts;return(0,o.shadow)(this,"isFontLoadingAPISupported",T)}get isSyncFontLoadingSupported(){let T=!1;return(o.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(T=!0),(0,o.shadow)(this,"isSyncFontLoadingSupported",T)}_queueLoadingCallback(T){function P(){for((0,o.assert)(!t.done,"completeRequest() cannot be called twice."),t.done=!0;n.length>0&&n[0].done;){const s=n.shift();setTimeout(s.callback,0)}}const{loadingRequests:n}=this,t={done:!1,complete:P,callback:T};return n.push(t),t}get _loadTestFont(){const T=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,o.shadow)(this,"_loadTestFont",T)}_prepareFontLoadEvent(T,P){function n(H,z){return H.charCodeAt(z)<<24|H.charCodeAt(z+1)<<16|H.charCodeAt(z+2)<<8|H.charCodeAt(z+3)&255}function t(H,z,st,et){const K=H.substring(0,z),nt=H.substring(z+st);return K+et+nt}let s,a;const c=this._document.createElement("canvas");c.width=1,c.height=1;const e=c.getContext("2d");let d=0;function m(H,z){if(++d>30){(0,o.warn)("Load test font never loaded."),z();return}if(e.font="30px "+H,e.fillText(".",0,20),e.getImageData(0,0,1,1).data[3]>0){z();return}setTimeout(m.bind(null,H,z))}const r=`lt${Date.now()}${this.loadTestFontId++}`;let b=this._loadTestFont;b=t(b,976,r.length,r);const j=16,p=1482184792;let g=n(b,j);for(s=0,a=r.length-3;s<a;s+=4)g=g-p+n(r,s)|0;s<r.length&&(g=g-p+n(r+"XXX",s)|0),b=t(b,j,4,(0,o.string32)(g));const M=`url(data:font/opentype;base64,${btoa(b)});`,O=`@font-face {font-family:"${r}";src:${M}}`;this.insertRule(O);const _=this._document.createElement("div");_.style.visibility="hidden",_.style.width=_.style.height="10px",_.style.position="absolute",_.style.top=_.style.left="0px";for(const H of[T.loadedName,r]){const z=this._document.createElement("span");z.textContent="Hi",z.style.fontFamily=H,_.append(z)}this._document.body.append(_),m(r,()=>{_.remove(),P.complete()})}}i.FontLoader=f;class I{constructor(T,{isEvalSupported:P=!0,disableFontFace:n=!1,ignoreErrors:t=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const a in T)this[a]=T[a];this.isEvalSupported=P!==!1,this.disableFontFace=n===!0,this.ignoreErrors=t===!0,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let T;if(!this.cssFontInfo)T=new FontFace(this.loadedName,this.data,{});else{const P={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(P.style=`oblique ${this.cssFontInfo.italicAngle}deg`),T=new FontFace(this.cssFontInfo.fontFamily,this.data,P)}return this._inspectFont?.(this),T}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const T=(0,o.bytesToString)(this.data),P=`url(data:${this.mimetype};base64,${btoa(T)});`;let n;if(!this.cssFontInfo)n=`@font-face {font-family:"${this.loadedName}";src:${P}}`;else{let t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${t}src:${P}}`}return this._inspectFont?.(this,P),n}getPathGenerator(T,P){if(this.compiledGlyphs[P]!==void 0)return this.compiledGlyphs[P];let n;try{n=T.get(this.loadedName+"_path_"+P)}catch(t){if(!this.ignoreErrors)throw t;return(0,o.warn)(`getPathGenerator - ignoring character: "${t}".`),this.compiledGlyphs[P]=function(s,a){}}if(this.isEvalSupported&&o.FeatureTest.isEvalSupported){const t=[];for(const s of n){const a=s.args!==void 0?s.args.join(","):"";t.push("c.",s.cmd,"(",a,`);
`)}return this.compiledGlyphs[P]=new Function("c","size",t.join(""))}return this.compiledGlyphs[P]=function(t,s){for(const a of n)a.cmd==="scale"&&(a.args=[s,-s]),t[a.cmd].apply(t,a.args)}}}i.FontFaceObject=I}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NodeStandardFontDataFactory=i.NodeFilterFactory=i.NodeCanvasFactory=i.NodeCMapReaderFactory=void 0;var o=R(7);R(1);const f=function(n){return new Promise((t,s)=>{require$$5.readFile(n,(c,e)=>{if(c||!e){s(new Error(c));return}t(new Uint8Array(e))})})};class I extends o.BaseFilterFactory{}i.NodeFilterFactory=I;class A extends o.BaseCanvasFactory{_createCanvas(t,s){return require$$5.createCanvas(t,s)}}i.NodeCanvasFactory=A;class T extends o.BaseCMapReaderFactory{_fetchData(t,s){return f(t).then(a=>({cMapData:a,compressionType:s}))}}i.NodeCMapReaderFactory=T;class P extends o.BaseStandardFontDataFactory{_fetchData(t){return f(t)}}i.NodeStandardFontDataFactory=P}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasGraphics=void 0;var o=R(1),f=R(6),I=R(12),A=R(13);const T=16,P=100,n=4096,t=15,s=10,a=1e3,c=16;function e(y,h){if(y._removeMirroring)throw new Error("Context is already forwarding operations.");y.__originalSave=y.save,y.__originalRestore=y.restore,y.__originalRotate=y.rotate,y.__originalScale=y.scale,y.__originalTranslate=y.translate,y.__originalTransform=y.transform,y.__originalSetTransform=y.setTransform,y.__originalResetTransform=y.resetTransform,y.__originalClip=y.clip,y.__originalMoveTo=y.moveTo,y.__originalLineTo=y.lineTo,y.__originalBezierCurveTo=y.bezierCurveTo,y.__originalRect=y.rect,y.__originalClosePath=y.closePath,y.__originalBeginPath=y.beginPath,y._removeMirroring=()=>{y.save=y.__originalSave,y.restore=y.__originalRestore,y.rotate=y.__originalRotate,y.scale=y.__originalScale,y.translate=y.__originalTranslate,y.transform=y.__originalTransform,y.setTransform=y.__originalSetTransform,y.resetTransform=y.__originalResetTransform,y.clip=y.__originalClip,y.moveTo=y.__originalMoveTo,y.lineTo=y.__originalLineTo,y.bezierCurveTo=y.__originalBezierCurveTo,y.rect=y.__originalRect,y.closePath=y.__originalClosePath,y.beginPath=y.__originalBeginPath,delete y._removeMirroring},y.save=function(){h.save(),this.__originalSave()},y.restore=function(){h.restore(),this.__originalRestore()},y.translate=function(E,k){h.translate(E,k),this.__originalTranslate(E,k)},y.scale=function(E,k){h.scale(E,k),this.__originalScale(E,k)},y.transform=function(E,k,N,B,C,l){h.transform(E,k,N,B,C,l),this.__originalTransform(E,k,N,B,C,l)},y.setTransform=function(E,k,N,B,C,l){h.setTransform(E,k,N,B,C,l),this.__originalSetTransform(E,k,N,B,C,l)},y.resetTransform=function(){h.resetTransform(),this.__originalResetTransform()},y.rotate=function(E){h.rotate(E),this.__originalRotate(E)},y.clip=function(E){h.clip(E),this.__originalClip(E)},y.moveTo=function(u,E){h.moveTo(u,E),this.__originalMoveTo(u,E)},y.lineTo=function(u,E){h.lineTo(u,E),this.__originalLineTo(u,E)},y.bezierCurveTo=function(u,E,k,N,B,C){h.bezierCurveTo(u,E,k,N,B,C),this.__originalBezierCurveTo(u,E,k,N,B,C)},y.rect=function(u,E,k,N){h.rect(u,E,k,N),this.__originalRect(u,E,k,N)},y.closePath=function(){h.closePath(),this.__originalClosePath()},y.beginPath=function(){h.beginPath(),this.__originalBeginPath()}}class d{constructor(h){this.canvasFactory=h,this.cache=Object.create(null)}getCanvas(h,u,E){let k;return this.cache[h]!==void 0?(k=this.cache[h],this.canvasFactory.reset(k,u,E)):(k=this.canvasFactory.create(u,E),this.cache[h]=k),k}delete(h){delete this.cache[h]}clear(){for(const h in this.cache){const u=this.cache[h];this.canvasFactory.destroy(u),delete this.cache[h]}}}function m(y,h,u,E,k,N,B,C,l,x){const[v,S,F,U,W,G]=(0,f.getCurrentTransform)(y);if(S===0&&F===0){const Q=B*v+W,tt=Math.round(Q),Z=C*U+G,it=Math.round(Z),ot=(B+l)*v+W,ct=Math.abs(Math.round(ot)-tt)||1,ht=(C+x)*U+G,ut=Math.abs(Math.round(ht)-it)||1;return y.setTransform(Math.sign(v),0,0,Math.sign(U),tt,it),y.drawImage(h,u,E,k,N,0,0,ct,ut),y.setTransform(v,S,F,U,W,G),[ct,ut]}if(v===0&&U===0){const Q=C*F+W,tt=Math.round(Q),Z=B*S+G,it=Math.round(Z),ot=(C+x)*F+W,ct=Math.abs(Math.round(ot)-tt)||1,ht=(B+l)*S+G,ut=Math.abs(Math.round(ht)-it)||1;return y.setTransform(0,Math.sign(S),Math.sign(F),0,tt,it),y.drawImage(h,u,E,k,N,0,0,ut,ct),y.setTransform(v,S,F,U,W,G),[ut,ct]}y.drawImage(h,u,E,k,N,B,C,l,x);const at=Math.hypot(v,S),$=Math.hypot(F,U);return[at*l,$*x]}function r(y){const{width:h,height:u}=y;if(h>a||u>a)return null;const E=1e3,k=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),N=h+1;let B=new Uint8Array(N*(u+1)),C,l,x;const v=h+7&-8;let S=new Uint8Array(v*u),F=0;for(const $ of y.data){let Q=128;for(;Q>0;)S[F++]=$&Q?0:255,Q>>=1}let U=0;for(F=0,S[F]!==0&&(B[0]=1,++U),l=1;l<h;l++)S[F]!==S[F+1]&&(B[l]=S[F]?2:1,++U),F++;for(S[F]!==0&&(B[l]=2,++U),C=1;C<u;C++){F=C*v,x=C*N,S[F-v]!==S[F]&&(B[x]=S[F]?1:8,++U);let $=(S[F]?4:0)+(S[F-v]?8:0);for(l=1;l<h;l++)$=($>>2)+(S[F+1]?4:0)+(S[F-v+1]?8:0),k[$]&&(B[x+l]=k[$],++U),F++;if(S[F-v]!==S[F]&&(B[x+l]=S[F]?2:4,++U),U>E)return null}for(F=v*(u-1),x=C*N,S[F]!==0&&(B[x]=8,++U),l=1;l<h;l++)S[F]!==S[F+1]&&(B[x+l]=S[F]?4:8,++U),F++;if(S[F]!==0&&(B[x+l]=4,++U),U>E)return null;const W=new Int32Array([0,N,-1,0,-N,0,0,0,1]),G=new Path2D;for(C=0;U&&C<=u;C++){let $=C*N;const Q=$+h;for(;$<Q&&!B[$];)$++;if($===Q)continue;G.moveTo($%N,C);const tt=$;let Z=B[$];do{const it=W[Z];do $+=it;while(!B[$]);const ot=B[$];ot!==5&&ot!==10?(Z=ot,B[$]=0):(Z=ot&51*Z>>4,B[$]&=Z>>2|Z<<2),G.lineTo($%N,$/N|0),B[$]||--U}while(tt!==$);--C}return S=null,B=null,function($){$.save(),$.scale(1/h,-1/u),$.translate(0,-u),$.fill(G),$.beginPath(),$.restore()}}class b{constructor(h,u){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=o.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=o.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=o.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,h,u])}clone(){const h=Object.create(this);return h.clipBox=this.clipBox.slice(),h}setCurrentPoint(h,u){this.x=h,this.y=u}updatePathMinMax(h,u,E){[u,E]=o.Util.applyTransform([u,E],h),this.minX=Math.min(this.minX,u),this.minY=Math.min(this.minY,E),this.maxX=Math.max(this.maxX,u),this.maxY=Math.max(this.maxY,E)}updateRectMinMax(h,u){const E=o.Util.applyTransform(u,h),k=o.Util.applyTransform(u.slice(2),h);this.minX=Math.min(this.minX,E[0],k[0]),this.minY=Math.min(this.minY,E[1],k[1]),this.maxX=Math.max(this.maxX,E[0],k[0]),this.maxY=Math.max(this.maxY,E[1],k[1])}updateScalingPathMinMax(h,u){o.Util.scaleMinMax(h,u),this.minX=Math.min(this.minX,u[0]),this.maxX=Math.max(this.maxX,u[1]),this.minY=Math.min(this.minY,u[2]),this.maxY=Math.max(this.maxY,u[3])}updateCurvePathMinMax(h,u,E,k,N,B,C,l,x,v){const S=o.Util.bezierBoundingBox(u,E,k,N,B,C,l,x);if(v){v[0]=Math.min(v[0],S[0],S[2]),v[1]=Math.max(v[1],S[0],S[2]),v[2]=Math.min(v[2],S[1],S[3]),v[3]=Math.max(v[3],S[1],S[3]);return}this.updateRectMinMax(h,S)}getPathBoundingBox(h=I.PathType.FILL,u=null){const E=[this.minX,this.minY,this.maxX,this.maxY];if(h===I.PathType.STROKE){u||(0,o.unreachable)("Stroke bounding box must include transform.");const k=o.Util.singularValueDecompose2dScale(u),N=k[0]*this.lineWidth/2,B=k[1]*this.lineWidth/2;E[0]-=N,E[1]-=B,E[2]+=N,E[3]+=B}return E}updateClipFromPath(){const h=o.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(h||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(h){this.clipBox=h,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(h=I.PathType.FILL,u=null){return o.Util.intersect(this.clipBox,this.getPathBoundingBox(h,u))}}function w(y,h){if(typeof ImageData<"u"&&h instanceof ImageData){y.putImageData(h,0,0);return}const u=h.height,E=h.width,k=u%c,N=(u-k)/c,B=k===0?N:N+1,C=y.createImageData(E,c);let l=0,x;const v=h.data,S=C.data;let F,U,W,G;if(h.kind===o.ImageKind.GRAYSCALE_1BPP){const at=v.byteLength,$=new Uint32Array(S.buffer,0,S.byteLength>>2),Q=$.length,tt=E+7>>3,Z=4294967295,it=o.FeatureTest.isLittleEndian?4278190080:255;for(F=0;F<B;F++){for(W=F<N?c:k,x=0,U=0;U<W;U++){const ot=at-l;let ct=0;const ht=ot>tt?E:ot*8-7,ut=ht&-8;let mt=0,xt=0;for(;ct<ut;ct+=8)xt=v[l++],$[x++]=xt&128?Z:it,$[x++]=xt&64?Z:it,$[x++]=xt&32?Z:it,$[x++]=xt&16?Z:it,$[x++]=xt&8?Z:it,$[x++]=xt&4?Z:it,$[x++]=xt&2?Z:it,$[x++]=xt&1?Z:it;for(;ct<ht;ct++)mt===0&&(xt=v[l++],mt=128),$[x++]=xt&mt?Z:it,mt>>=1}for(;x<Q;)$[x++]=0;y.putImageData(C,0,F*c)}}else if(h.kind===o.ImageKind.RGBA_32BPP){for(U=0,G=E*c*4,F=0;F<N;F++)S.set(v.subarray(l,l+G)),l+=G,y.putImageData(C,0,U),U+=c;F<B&&(G=E*k*4,S.set(v.subarray(l,l+G)),y.putImageData(C,0,U))}else if(h.kind===o.ImageKind.RGB_24BPP)for(W=c,G=E*W,F=0;F<B;F++){for(F>=N&&(W=k,G=E*W),x=0,U=G;U--;)S[x++]=v[l++],S[x++]=v[l++],S[x++]=v[l++],S[x++]=255;y.putImageData(C,0,F*c)}else throw new Error(`bad image kind: ${h.kind}`)}function j(y,h){if(h.bitmap){y.drawImage(h.bitmap,0,0);return}const u=h.height,E=h.width,k=u%c,N=(u-k)/c,B=k===0?N:N+1,C=y.createImageData(E,c);let l=0;const x=h.data,v=C.data;for(let S=0;S<B;S++){const F=S<N?c:k;({srcPos:l}=(0,A.convertBlackAndWhiteToRGBA)({src:x,srcPos:l,dest:v,width:E,height:F,nonBlackColor:0})),y.putImageData(C,0,S*c)}}function p(y,h){const u=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const E of u)y[E]!==void 0&&(h[E]=y[E]);y.setLineDash!==void 0&&(h.setLineDash(y.getLineDash()),h.lineDashOffset=y.lineDashOffset)}function g(y){if(y.strokeStyle=y.fillStyle="#000000",y.fillRule="nonzero",y.globalAlpha=1,y.lineWidth=1,y.lineCap="butt",y.lineJoin="miter",y.miterLimit=10,y.globalCompositeOperation="source-over",y.font="10px sans-serif",y.setLineDash!==void 0&&(y.setLineDash([]),y.lineDashOffset=0),!o.isNodeJS){const{filter:h}=y;h!=="none"&&h!==""&&(y.filter="none")}}function M(y,h,u,E){const k=y.length;for(let N=3;N<k;N+=4){const B=y[N];if(B===0)y[N-3]=h,y[N-2]=u,y[N-1]=E;else if(B<255){const C=255-B;y[N-3]=y[N-3]*B+h*C>>8,y[N-2]=y[N-2]*B+u*C>>8,y[N-1]=y[N-1]*B+E*C>>8}}}function O(y,h,u){const E=y.length,k=1/255;for(let N=3;N<E;N+=4){const B=u?u[y[N]]:y[N];h[N]=h[N]*B*k|0}}function _(y,h,u){const E=y.length;for(let k=3;k<E;k+=4){const N=y[k-3]*77+y[k-2]*152+y[k-1]*28;h[k]=u?h[k]*u[N>>8]>>8:h[k]*N>>16}}function H(y,h,u,E,k,N,B,C,l,x,v){const S=!!N,F=S?N[0]:0,U=S?N[1]:0,W=S?N[2]:0,G=k==="Luminosity"?_:O,$=Math.min(E,Math.ceil(1048576/u));for(let Q=0;Q<E;Q+=$){const tt=Math.min($,E-Q),Z=y.getImageData(C-x,Q+(l-v),u,tt),it=h.getImageData(C,Q+l,u,tt);S&&M(Z.data,F,U,W),G(Z.data,it.data,B),h.putImageData(it,C,Q+l)}}function z(y,h,u,E){const k=E[0],N=E[1],B=E[2]-k,C=E[3]-N;B===0||C===0||(H(h.context,u,B,C,h.subtype,h.backdrop,h.transferMap,k,N,h.offsetX,h.offsetY),y.save(),y.globalAlpha=1,y.globalCompositeOperation="source-over",y.setTransform(1,0,0,1,0,0),y.drawImage(u.canvas,0,0),y.restore())}function st(y,h){const u=o.Util.singularValueDecompose2dScale(y);u[0]=Math.fround(u[0]),u[1]=Math.fround(u[1]);const E=Math.fround((globalThis.devicePixelRatio||1)*f.PixelsPerInch.PDF_TO_CSS_UNITS);return h!==void 0?h:u[0]<=E||u[1]<=E}const et=["butt","round","square"],K=["miter","round","bevel"],nt={},J={};class L{constructor(h,u,E,k,N,{optionalContentConfig:B,markedContentStack:C=null},l,x){this.ctx=h,this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=u,this.objs=E,this.canvasFactory=k,this.filterFactory=N,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=C||[],this.optionalContentConfig=B,this.cachedCanvases=new d(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=x,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(h,u=null){return typeof h=="string"?h.startsWith("g_")?this.commonObjs.get(h):this.objs.get(h):u}beginDrawing({transform:h,viewport:u,transparency:E=!1,background:k=null}){const N=this.ctx.canvas.width,B=this.ctx.canvas.height,C=this.ctx.fillStyle;if(this.ctx.fillStyle=k||"#ffffff",this.ctx.fillRect(0,0,N,B),this.ctx.fillStyle=C,E){const l=this.cachedCanvases.getCanvas("transparent",N,B);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...(0,f.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),g(this.ctx),h&&(this.ctx.transform(...h),this.outputScaleX=h[0],this.outputScaleY=h[0]),this.ctx.transform(...u.transform),this.viewportScale=u.scale,this.baseTransform=(0,f.getCurrentTransform)(this.ctx)}executeOperatorList(h,u,E,k){const N=h.argsArray,B=h.fnArray;let C=u||0;const l=N.length;if(l===C)return C;const x=l-C>s&&typeof E=="function",v=x?Date.now()+t:0;let S=0;const F=this.commonObjs,U=this.objs;let W;for(;;){if(k!==void 0&&C===k.nextBreakPoint)return k.breakIt(C,E),C;if(W=B[C],W!==o.OPS.dependency)this[W].apply(this,N[C]);else for(const G of N[C]){const at=G.startsWith("g_")?F:U;if(!at.has(G))return at.get(G,E),C}if(C++,C===l)return C;if(x&&++S>s){if(Date.now()>v)return E(),C;S=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const h of this._cachedBitmapsMap.values()){for(const u of h.values())typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement&&(u.width=u.height=0);h.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const h=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(h!=="none"){const u=this.ctx.filter;this.ctx.filter=h,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=u}}}_scaleImage(h,u){const E=h.width,k=h.height;let N=Math.max(Math.hypot(u[0],u[1]),1),B=Math.max(Math.hypot(u[2],u[3]),1),C=E,l=k,x="prescale1",v,S;for(;N>2&&C>1||B>2&&l>1;){let F=C,U=l;N>2&&C>1&&(F=C>=16384?Math.floor(C/2)-1||1:Math.ceil(C/2),N/=C/F),B>2&&l>1&&(U=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,B/=l/U),v=this.cachedCanvases.getCanvas(x,F,U),S=v.context,S.clearRect(0,0,F,U),S.drawImage(h,0,0,C,l,0,0,F,U),h=v.canvas,C=F,l=U,x=x==="prescale1"?"prescale2":"prescale1"}return{img:h,paintWidth:C,paintHeight:l}}_createMaskCanvas(h){const u=this.ctx,{width:E,height:k}=h,N=this.current.fillColor,B=this.current.patternFill,C=(0,f.getCurrentTransform)(u);let l,x,v,S;if((h.bitmap||h.data)&&h.count>1){const ct=h.bitmap||h.data.buffer;x=JSON.stringify(B?C:[C.slice(0,4),N]),l=this._cachedBitmapsMap.get(ct),l||(l=new Map,this._cachedBitmapsMap.set(ct,l));const ht=l.get(x);if(ht&&!B){const ut=Math.round(Math.min(C[0],C[2])+C[4]),mt=Math.round(Math.min(C[1],C[3])+C[5]);return{canvas:ht,offsetX:ut,offsetY:mt}}v=ht}v||(S=this.cachedCanvases.getCanvas("maskCanvas",E,k),j(S.context,h));let F=o.Util.transform(C,[1/E,0,0,-1/k,0,0]);F=o.Util.transform(F,[1,0,0,1,0,-k]);const U=o.Util.applyTransform([0,0],F),W=o.Util.applyTransform([E,k],F),G=o.Util.normalizeRect([U[0],U[1],W[0],W[1]]),at=Math.round(G[2]-G[0])||1,$=Math.round(G[3]-G[1])||1,Q=this.cachedCanvases.getCanvas("fillCanvas",at,$),tt=Q.context,Z=Math.min(U[0],W[0]),it=Math.min(U[1],W[1]);tt.translate(-Z,-it),tt.transform(...F),v||(v=this._scaleImage(S.canvas,(0,f.getCurrentTransformInverse)(tt)),v=v.img,l&&B&&l.set(x,v)),tt.imageSmoothingEnabled=st((0,f.getCurrentTransform)(tt),h.interpolate),m(tt,v,0,0,v.width,v.height,0,0,E,k),tt.globalCompositeOperation="source-in";const ot=o.Util.transform((0,f.getCurrentTransformInverse)(tt),[1,0,0,1,-Z,-it]);return tt.fillStyle=B?N.getPattern(u,this,ot,I.PathType.FILL):N,tt.fillRect(0,0,E,k),l&&!B&&(this.cachedCanvases.delete("fillCanvas"),l.set(x,Q.canvas)),{canvas:Q.canvas,offsetX:Math.round(Z),offsetY:Math.round(it)}}setLineWidth(h){h!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=h,this.ctx.lineWidth=h}setLineCap(h){this.ctx.lineCap=et[h]}setLineJoin(h){this.ctx.lineJoin=K[h]}setMiterLimit(h){this.ctx.miterLimit=h}setDash(h,u){const E=this.ctx;E.setLineDash!==void 0&&(E.setLineDash(h),E.lineDashOffset=u)}setRenderingIntent(h){}setFlatness(h){}setGState(h){for(const[u,E]of h)switch(u){case"LW":this.setLineWidth(E);break;case"LC":this.setLineCap(E);break;case"LJ":this.setLineJoin(E);break;case"ML":this.setMiterLimit(E);break;case"D":this.setDash(E[0],E[1]);break;case"RI":this.setRenderingIntent(E);break;case"FL":this.setFlatness(E);break;case"Font":this.setFont(E[0],E[1]);break;case"CA":this.current.strokeAlpha=E;break;case"ca":this.current.fillAlpha=E,this.ctx.globalAlpha=E;break;case"BM":this.ctx.globalCompositeOperation=E;break;case"SMask":this.current.activeSMask=E?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(E);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const h=this.inSMaskMode;this.current.activeSMask&&!h?this.beginSMaskMode():!this.current.activeSMask&&h&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const h=this.ctx.canvas.width,u=this.ctx.canvas.height,E="smaskGroupAt"+this.groupLevel,k=this.cachedCanvases.getCanvas(E,h,u);this.suspendedCtx=this.ctx,this.ctx=k.context;const N=this.ctx;N.setTransform(...(0,f.getCurrentTransform)(this.suspendedCtx)),p(this.suspendedCtx,N),e(N,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),p(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(h){if(!this.current.activeSMask)return;h?(h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]),h[2]=Math.ceil(h[2]),h[3]=Math.ceil(h[3])):h=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const u=this.current.activeSMask,E=this.suspendedCtx;z(E,u,this.ctx,h),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(p(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const h=this.current;this.stateStack.push(h),this.current=h.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),p(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(h,u,E,k,N,B){this.ctx.transform(h,u,E,k,N,B),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(h,u,E){const k=this.ctx,N=this.current;let B=N.x,C=N.y,l,x;const v=(0,f.getCurrentTransform)(k),S=v[0]===0&&v[3]===0||v[1]===0&&v[2]===0,F=S?E.slice(0):null;for(let U=0,W=0,G=h.length;U<G;U++)switch(h[U]|0){case o.OPS.rectangle:B=u[W++],C=u[W++];const at=u[W++],$=u[W++],Q=B+at,tt=C+$;k.moveTo(B,C),at===0||$===0?k.lineTo(Q,tt):(k.lineTo(Q,C),k.lineTo(Q,tt),k.lineTo(B,tt)),S||N.updateRectMinMax(v,[B,C,Q,tt]),k.closePath();break;case o.OPS.moveTo:B=u[W++],C=u[W++],k.moveTo(B,C),S||N.updatePathMinMax(v,B,C);break;case o.OPS.lineTo:B=u[W++],C=u[W++],k.lineTo(B,C),S||N.updatePathMinMax(v,B,C);break;case o.OPS.curveTo:l=B,x=C,B=u[W+4],C=u[W+5],k.bezierCurveTo(u[W],u[W+1],u[W+2],u[W+3],B,C),N.updateCurvePathMinMax(v,l,x,u[W],u[W+1],u[W+2],u[W+3],B,C,F),W+=6;break;case o.OPS.curveTo2:l=B,x=C,k.bezierCurveTo(B,C,u[W],u[W+1],u[W+2],u[W+3]),N.updateCurvePathMinMax(v,l,x,B,C,u[W],u[W+1],u[W+2],u[W+3],F),B=u[W+2],C=u[W+3],W+=4;break;case o.OPS.curveTo3:l=B,x=C,B=u[W+2],C=u[W+3],k.bezierCurveTo(u[W],u[W+1],B,C,B,C),N.updateCurvePathMinMax(v,l,x,u[W],u[W+1],B,C,B,C,F),W+=4;break;case o.OPS.closePath:k.closePath();break}S&&N.updateScalingPathMinMax(v,F),N.setCurrentPoint(B,C)}closePath(){this.ctx.closePath()}stroke(h=!0){const u=this.ctx,E=this.current.strokeColor;u.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof E=="object"&&E?.getPattern?(u.save(),u.strokeStyle=E.getPattern(u,this,(0,f.getCurrentTransformInverse)(u),I.PathType.STROKE),this.rescaleAndStroke(!1),u.restore()):this.rescaleAndStroke(!0)),h&&this.consumePath(this.current.getClippedPathBoundingBox()),u.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(h=!0){const u=this.ctx,E=this.current.fillColor,k=this.current.patternFill;let N=!1;k&&(u.save(),u.fillStyle=E.getPattern(u,this,(0,f.getCurrentTransformInverse)(u),I.PathType.FILL),N=!0);const B=this.current.getClippedPathBoundingBox();this.contentVisible&&B!==null&&(this.pendingEOFill?(u.fill("evenodd"),this.pendingEOFill=!1):u.fill()),N&&u.restore(),h&&this.consumePath(B)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=nt}eoClip(){this.pendingClip=J}beginText(){this.current.textMatrix=o.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const h=this.pendingTextPaths,u=this.ctx;if(h===void 0){u.beginPath();return}u.save(),u.beginPath();for(const E of h)u.setTransform(...E.transform),u.translate(E.x,E.y),E.addToPath(u,E.fontSize);u.restore(),u.clip(),u.beginPath(),delete this.pendingTextPaths}setCharSpacing(h){this.current.charSpacing=h}setWordSpacing(h){this.current.wordSpacing=h}setHScale(h){this.current.textHScale=h/100}setLeading(h){this.current.leading=-h}setFont(h,u){const E=this.commonObjs.get(h),k=this.current;if(!E)throw new Error(`Can't find font for ${h}`);if(k.fontMatrix=E.fontMatrix||o.FONT_IDENTITY_MATRIX,(k.fontMatrix[0]===0||k.fontMatrix[3]===0)&&(0,o.warn)("Invalid font matrix for font "+h),u<0?(u=-u,k.fontDirection=-1):k.fontDirection=1,this.current.font=E,this.current.fontSize=u,E.isType3Font)return;const N=E.loadedName||"sans-serif",B=E.systemFontInfo?.css||`"${N}", ${E.fallbackName}`;let C="normal";E.black?C="900":E.bold&&(C="bold");const l=E.italic?"italic":"normal";let x=u;u<T?x=T:u>P&&(x=P),this.current.fontSizeScale=u/x,this.ctx.font=`${l} ${C} ${x}px ${B}`}setTextRenderingMode(h){this.current.textRenderingMode=h}setTextRise(h){this.current.textRise=h}moveText(h,u){this.current.x=this.current.lineX+=h,this.current.y=this.current.lineY+=u}setLeadingMoveText(h,u){this.setLeading(-u),this.moveText(h,u)}setTextMatrix(h,u,E,k,N,B){this.current.textMatrix=[h,u,E,k,N,B],this.current.textMatrixScale=Math.hypot(h,u),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(h,u,E,k){const N=this.ctx,B=this.current,C=B.font,l=B.textRenderingMode,x=B.fontSize/B.fontSizeScale,v=l&o.TextRenderingMode.FILL_STROKE_MASK,S=!!(l&o.TextRenderingMode.ADD_TO_PATH_FLAG),F=B.patternFill&&!C.missingFile;let U;(C.disableFontFace||S||F)&&(U=C.getPathGenerator(this.commonObjs,h)),C.disableFontFace||F?(N.save(),N.translate(u,E),N.beginPath(),U(N,x),k&&N.setTransform(...k),(v===o.TextRenderingMode.FILL||v===o.TextRenderingMode.FILL_STROKE)&&N.fill(),(v===o.TextRenderingMode.STROKE||v===o.TextRenderingMode.FILL_STROKE)&&N.stroke(),N.restore()):((v===o.TextRenderingMode.FILL||v===o.TextRenderingMode.FILL_STROKE)&&N.fillText(h,u,E),(v===o.TextRenderingMode.STROKE||v===o.TextRenderingMode.FILL_STROKE)&&N.strokeText(h,u,E)),S&&(this.pendingTextPaths||=[]).push({transform:(0,f.getCurrentTransform)(N),x:u,y:E,fontSize:x,addToPath:U})}get isFontSubpixelAAEnabled(){const{context:h}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);h.scale(1.5,1),h.fillText("I",0,10);const u=h.getImageData(0,0,10,10).data;let E=!1;for(let k=3;k<u.length;k+=4)if(u[k]>0&&u[k]<255){E=!0;break}return(0,o.shadow)(this,"isFontSubpixelAAEnabled",E)}showText(h){const u=this.current,E=u.font;if(E.isType3Font)return this.showType3Text(h);const k=u.fontSize;if(k===0)return;const N=this.ctx,B=u.fontSizeScale,C=u.charSpacing,l=u.wordSpacing,x=u.fontDirection,v=u.textHScale*x,S=h.length,F=E.vertical,U=F?1:-1,W=E.defaultVMetrics,G=k*u.fontMatrix[0],at=u.textRenderingMode===o.TextRenderingMode.FILL&&!E.disableFontFace&&!u.patternFill;N.save(),N.transform(...u.textMatrix),N.translate(u.x,u.y+u.textRise),x>0?N.scale(v,-1):N.scale(v,1);let $;if(u.patternFill){N.save();const ot=u.fillColor.getPattern(N,this,(0,f.getCurrentTransformInverse)(N),I.PathType.FILL);$=(0,f.getCurrentTransform)(N),N.restore(),N.fillStyle=ot}let Q=u.lineWidth;const tt=u.textMatrixScale;if(tt===0||Q===0){const ot=u.textRenderingMode&o.TextRenderingMode.FILL_STROKE_MASK;(ot===o.TextRenderingMode.STROKE||ot===o.TextRenderingMode.FILL_STROKE)&&(Q=this.getSinglePixelWidth())}else Q/=tt;if(B!==1&&(N.scale(B,B),Q/=B),N.lineWidth=Q,E.isInvalidPDFjsFont){const ot=[];let ct=0;for(const ht of h)ot.push(ht.unicode),ct+=ht.width;N.fillText(ot.join(""),0,0),u.x+=ct*G*v,N.restore(),this.compose();return}let Z=0,it;for(it=0;it<S;++it){const ot=h[it];if(typeof ot=="number"){Z+=U*ot*k/1e3;continue}let ct=!1;const ht=(ot.isSpace?l:0)+C,ut=ot.fontChar,mt=ot.accent;let xt,yt,vt=ot.width;if(F){const dt=ot.vmetric||W,pt=-(ot.vmetric?dt[1]:vt*.5)*G,_t=dt[2]*G;vt=dt?-dt[0]:vt,xt=pt/B,yt=(Z+_t)/B}else xt=Z/B,yt=0;if(E.remeasure&&vt>0){const dt=N.measureText(ut).width*1e3/k*B;if(vt<dt&&this.isFontSubpixelAAEnabled){const pt=vt/dt;ct=!0,N.save(),N.scale(pt,1),xt/=pt}else vt!==dt&&(xt+=(vt-dt)/2e3*k/B)}if(this.contentVisible&&(ot.isInFont||E.missingFile)){if(at&&!mt)N.fillText(ut,xt,yt);else if(this.paintChar(ut,xt,yt,$),mt){const dt=xt+k*mt.offset.x/B,pt=yt-k*mt.offset.y/B;this.paintChar(mt.fontChar,dt,pt,$)}}const Y=F?vt*G-ht*x:vt*G+ht*x;Z+=Y,ct&&N.restore()}F?u.y-=Z:u.x+=Z*v,N.restore(),this.compose()}showType3Text(h){const u=this.ctx,E=this.current,k=E.font,N=E.fontSize,B=E.fontDirection,C=k.vertical?1:-1,l=E.charSpacing,x=E.wordSpacing,v=E.textHScale*B,S=E.fontMatrix||o.FONT_IDENTITY_MATRIX,F=h.length,U=E.textRenderingMode===o.TextRenderingMode.INVISIBLE;let W,G,at,$;if(!(U||N===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,u.save(),u.transform(...E.textMatrix),u.translate(E.x,E.y),u.scale(v,B),W=0;W<F;++W){if(G=h[W],typeof G=="number"){$=C*G*N/1e3,this.ctx.translate($,0),E.x+=$*v;continue}const Q=(G.isSpace?x:0)+l,tt=k.charProcOperatorList[G.operatorListId];if(!tt){(0,o.warn)(`Type3 character "${G.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=G,this.save(),u.scale(N,N),u.transform(...S),this.executeOperatorList(tt),this.restore()),at=o.Util.applyTransform([G.width,0],S)[0]*N+Q,u.translate(at,0),E.x+=at*v}u.restore(),this.processingType3=null}}setCharWidth(h,u){}setCharWidthAndBounds(h,u,E,k,N,B){this.ctx.rect(E,k,N-E,B-k),this.ctx.clip(),this.endPath()}getColorN_Pattern(h){let u;if(h[0]==="TilingPattern"){const E=h[1],k=this.baseTransform||(0,f.getCurrentTransform)(this.ctx),N={createCanvasGraphics:B=>new L(B,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};u=new I.TilingPattern(h,E,this.ctx,N,k)}else u=this._getPattern(h[1],h[2]);return u}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(h,u,E){const k=o.Util.makeHexColor(h,u,E);this.ctx.strokeStyle=k,this.current.strokeColor=k}setFillRGBColor(h,u,E){const k=o.Util.makeHexColor(h,u,E);this.ctx.fillStyle=k,this.current.fillColor=k,this.current.patternFill=!1}_getPattern(h,u=null){let E;return this.cachedPatterns.has(h)?E=this.cachedPatterns.get(h):(E=(0,I.getShadingPattern)(this.getObject(h)),this.cachedPatterns.set(h,E)),u&&(E.matrix=u),E}shadingFill(h){if(!this.contentVisible)return;const u=this.ctx;this.save();const E=this._getPattern(h);u.fillStyle=E.getPattern(u,this,(0,f.getCurrentTransformInverse)(u),I.PathType.SHADING);const k=(0,f.getCurrentTransformInverse)(u);if(k){const{width:N,height:B}=u.canvas,[C,l,x,v]=o.Util.getAxialAlignedBoundingBox([0,0,N,B],k);this.ctx.fillRect(C,l,x-C,v-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,o.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,o.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(h,u){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(h)&&h.length===6&&this.transform(...h),this.baseTransform=(0,f.getCurrentTransform)(this.ctx),u)){const E=u[2]-u[0],k=u[3]-u[1];this.ctx.rect(u[0],u[1],E,k),this.current.updateRectMinMax((0,f.getCurrentTransform)(this.ctx),u),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(h){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const u=this.ctx;h.isolated||(0,o.info)("TODO: Support non-isolated groups."),h.knockout&&(0,o.warn)("Knockout groups not supported.");const E=(0,f.getCurrentTransform)(u);if(h.matrix&&u.transform(...h.matrix),!h.bbox)throw new Error("Bounding box is required.");let k=o.Util.getAxialAlignedBoundingBox(h.bbox,(0,f.getCurrentTransform)(u));const N=[0,0,u.canvas.width,u.canvas.height];k=o.Util.intersect(k,N)||[0,0,0,0];const B=Math.floor(k[0]),C=Math.floor(k[1]);let l=Math.max(Math.ceil(k[2])-B,1),x=Math.max(Math.ceil(k[3])-C,1),v=1,S=1;l>n&&(v=l/n,l=n),x>n&&(S=x/n,x=n),this.current.startNewPathAndClipBox([0,0,l,x]);let F="groupAt"+this.groupLevel;h.smask&&(F+="_smask_"+this.smaskCounter++%2);const U=this.cachedCanvases.getCanvas(F,l,x),W=U.context;W.scale(1/v,1/S),W.translate(-B,-C),W.transform(...E),h.smask?this.smaskStack.push({canvas:U.canvas,context:W,offsetX:B,offsetY:C,scaleX:v,scaleY:S,subtype:h.smask.subtype,backdrop:h.smask.backdrop,transferMap:h.smask.transferMap||null,startTransformInverse:null}):(u.setTransform(1,0,0,1,0,0),u.translate(B,C),u.scale(v,S),u.save()),p(u,W),this.ctx=W,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(u),this.groupLevel++}endGroup(h){if(!this.contentVisible)return;this.groupLevel--;const u=this.ctx,E=this.groupStack.pop();if(this.ctx=E,this.ctx.imageSmoothingEnabled=!1,h.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const k=(0,f.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...k);const N=o.Util.getAxialAlignedBoundingBox([0,0,u.canvas.width,u.canvas.height],k);this.ctx.drawImage(u.canvas,0,0),this.ctx.restore(),this.compose(N)}}beginAnnotation(h,u,E,k,N){if(this.#t(),g(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(u)&&u.length===4){const B=u[2]-u[0],C=u[3]-u[1];if(N&&this.annotationCanvasMap){E=E.slice(),E[4]-=u[0],E[5]-=u[1],u=u.slice(),u[0]=u[1]=0,u[2]=B,u[3]=C;const[l,x]=o.Util.singularValueDecompose2dScale((0,f.getCurrentTransform)(this.ctx)),{viewportScale:v}=this,S=Math.ceil(B*this.outputScaleX*v),F=Math.ceil(C*this.outputScaleY*v);this.annotationCanvas=this.canvasFactory.create(S,F);const{canvas:U,context:W}=this.annotationCanvas;this.annotationCanvasMap.set(h,U),this.annotationCanvas.savedCtx=this.ctx,this.ctx=W,this.ctx.save(),this.ctx.setTransform(l,0,0,-x,0,C*x),g(this.ctx)}else g(this.ctx),this.ctx.rect(u[0],u[1],B,C),this.ctx.clip(),this.endPath()}this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...E),this.transform(...k)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(h){if(!this.contentVisible)return;const u=h.count;h=this.getObject(h.data,h),h.count=u;const E=this.ctx,k=this.processingType3;if(k&&(k.compiled===void 0&&(k.compiled=r(h)),k.compiled)){k.compiled(E);return}const N=this._createMaskCanvas(h),B=N.canvas;E.save(),E.setTransform(1,0,0,1,0,0),E.drawImage(B,N.offsetX,N.offsetY),E.restore(),this.compose()}paintImageMaskXObjectRepeat(h,u,E=0,k=0,N,B){if(!this.contentVisible)return;h=this.getObject(h.data,h);const C=this.ctx;C.save();const l=(0,f.getCurrentTransform)(C);C.transform(u,E,k,N,0,0);const x=this._createMaskCanvas(h);C.setTransform(1,0,0,1,x.offsetX-l[4],x.offsetY-l[5]);for(let v=0,S=B.length;v<S;v+=2){const F=o.Util.transform(l,[u,E,k,N,B[v],B[v+1]]),[U,W]=o.Util.applyTransform([0,0],F);C.drawImage(x.canvas,U,W)}C.restore(),this.compose()}paintImageMaskXObjectGroup(h){if(!this.contentVisible)return;const u=this.ctx,E=this.current.fillColor,k=this.current.patternFill;for(const N of h){const{data:B,width:C,height:l,transform:x}=N,v=this.cachedCanvases.getCanvas("maskCanvas",C,l),S=v.context;S.save();const F=this.getObject(B,N);j(S,F),S.globalCompositeOperation="source-in",S.fillStyle=k?E.getPattern(S,this,(0,f.getCurrentTransformInverse)(u),I.PathType.FILL):E,S.fillRect(0,0,C,l),S.restore(),u.save(),u.transform(...x),u.scale(1,-1),m(u,v.canvas,0,0,C,l,0,-1,1,1),u.restore()}this.compose()}paintImageXObject(h){if(!this.contentVisible)return;const u=this.getObject(h);if(!u){(0,o.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(u)}paintImageXObjectRepeat(h,u,E,k){if(!this.contentVisible)return;const N=this.getObject(h);if(!N){(0,o.warn)("Dependent image isn't ready yet");return}const B=N.width,C=N.height,l=[];for(let x=0,v=k.length;x<v;x+=2)l.push({transform:[u,0,0,E,k[x],k[x+1]],x:0,y:0,w:B,h:C});this.paintInlineImageXObjectGroup(N,l)}applyTransferMapsToCanvas(h){return this.current.transferMaps!=="none"&&(h.filter=this.current.transferMaps,h.drawImage(h.canvas,0,0),h.filter="none"),h.canvas}applyTransferMapsToBitmap(h){if(this.current.transferMaps==="none")return h.bitmap;const{bitmap:u,width:E,height:k}=h,N=this.cachedCanvases.getCanvas("inlineImage",E,k),B=N.context;return B.filter=this.current.transferMaps,B.drawImage(u,0,0),B.filter="none",N.canvas}paintInlineImageXObject(h){if(!this.contentVisible)return;const u=h.width,E=h.height,k=this.ctx;if(this.save(),!o.isNodeJS){const{filter:C}=k;C!=="none"&&C!==""&&(k.filter="none")}k.scale(1/u,-1/E);let N;if(h.bitmap)N=this.applyTransferMapsToBitmap(h);else if(typeof HTMLElement=="function"&&h instanceof HTMLElement||!h.data)N=h;else{const l=this.cachedCanvases.getCanvas("inlineImage",u,E).context;w(l,h),N=this.applyTransferMapsToCanvas(l)}const B=this._scaleImage(N,(0,f.getCurrentTransformInverse)(k));k.imageSmoothingEnabled=st((0,f.getCurrentTransform)(k),h.interpolate),m(k,B.img,0,0,B.paintWidth,B.paintHeight,0,-E,u,E),this.compose(),this.restore()}paintInlineImageXObjectGroup(h,u){if(!this.contentVisible)return;const E=this.ctx;let k;if(h.bitmap)k=h.bitmap;else{const N=h.width,B=h.height,l=this.cachedCanvases.getCanvas("inlineImage",N,B).context;w(l,h),k=this.applyTransferMapsToCanvas(l)}for(const N of u)E.save(),E.transform(...N.transform),E.scale(1,-1),m(E,k,N.x,N.y,N.w,N.h,0,-1,1,1),E.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(h){}markPointProps(h,u){}beginMarkedContent(h){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(h,u){h==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(u)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(h){const u=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(h);const E=this.ctx;this.pendingClip&&(u||(this.pendingClip===J?E.clip("evenodd"):E.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),E.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const h=(0,f.getCurrentTransform)(this.ctx);if(h[1]===0&&h[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(h[0]),Math.abs(h[3]));else{const u=Math.abs(h[0]*h[3]-h[2]*h[1]),E=Math.hypot(h[0],h[2]),k=Math.hypot(h[1],h[3]);this._cachedGetSinglePixelWidth=Math.max(E,k)/u}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:h}=this.current,{a:u,b:E,c:k,d:N}=this.ctx.getTransform();let B,C;if(E===0&&k===0){const l=Math.abs(u),x=Math.abs(N);if(l===x)if(h===0)B=C=1/l;else{const v=l*h;B=C=v<1?1/v:1}else if(h===0)B=1/l,C=1/x;else{const v=l*h,S=x*h;B=v<1?1/v:1,C=S<1?1/S:1}}else{const l=Math.abs(u*N-E*k),x=Math.hypot(u,E),v=Math.hypot(k,N);if(h===0)B=v/l,C=x/l;else{const S=h*l;B=v>S?v/S:1,C=x>S?x/S:1}}this._cachedScaleForStroking[0]=B,this._cachedScaleForStroking[1]=C}return this._cachedScaleForStroking}rescaleAndStroke(h){const{ctx:u}=this,{lineWidth:E}=this.current,[k,N]=this.getScaleForStroking();if(u.lineWidth=E||1,k===1&&N===1){u.stroke();return}const B=u.getLineDash();if(h&&u.save(),u.scale(k,N),B.length>0){const C=Math.max(k,N);u.setLineDash(B.map(l=>l/C)),u.lineDashOffset/=C}u.stroke(),h&&u.restore()}isContentVisible(){for(let h=this.markedContentStack.length-1;h>=0;h--)if(!this.markedContentStack[h].visible)return!1;return!0}}i.CanvasGraphics=L;for(const y in o.OPS)L.prototype[y]!==void 0&&(L.prototype[o.OPS[y]]=L.prototype[y])}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TilingPattern=i.PathType=void 0,i.getShadingPattern=c;var o=R(1),f=R(6);const I={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};i.PathType=I;function A(m,r){if(!r)return;const b=r[2]-r[0],w=r[3]-r[1],j=new Path2D;j.rect(r[0],r[1],b,w),m.clip(j)}class T{constructor(){this.constructor===T&&(0,o.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,o.unreachable)("Abstract method `getPattern` called.")}}class P extends T{constructor(r){super(),this._type=r[1],this._bbox=r[2],this._colorStops=r[3],this._p0=r[4],this._p1=r[5],this._r0=r[6],this._r1=r[7],this.matrix=null}_createGradient(r){let b;this._type==="axial"?b=r.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(b=r.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const w of this._colorStops)b.addColorStop(w[0],w[1]);return b}getPattern(r,b,w,j){let p;if(j===I.STROKE||j===I.FILL){const g=b.current.getClippedPathBoundingBox(j,(0,f.getCurrentTransform)(r))||[0,0,0,0],M=Math.ceil(g[2]-g[0])||1,O=Math.ceil(g[3]-g[1])||1,_=b.cachedCanvases.getCanvas("pattern",M,O,!0),H=_.context;H.clearRect(0,0,H.canvas.width,H.canvas.height),H.beginPath(),H.rect(0,0,H.canvas.width,H.canvas.height),H.translate(-g[0],-g[1]),w=o.Util.transform(w,[1,0,0,1,g[0],g[1]]),H.transform(...b.baseTransform),this.matrix&&H.transform(...this.matrix),A(H,this._bbox),H.fillStyle=this._createGradient(H),H.fill(),p=r.createPattern(_.canvas,"no-repeat");const z=new DOMMatrix(w);p.setTransform(z)}else A(r,this._bbox),p=this._createGradient(r);return p}}function n(m,r,b,w,j,p,g,M){const O=r.coords,_=r.colors,H=m.data,z=m.width*4;let st;O[b+1]>O[w+1]&&(st=b,b=w,w=st,st=p,p=g,g=st),O[w+1]>O[j+1]&&(st=w,w=j,j=st,st=g,g=M,M=st),O[b+1]>O[w+1]&&(st=b,b=w,w=st,st=p,p=g,g=st);const et=(O[b]+r.offsetX)*r.scaleX,K=(O[b+1]+r.offsetY)*r.scaleY,nt=(O[w]+r.offsetX)*r.scaleX,J=(O[w+1]+r.offsetY)*r.scaleY,L=(O[j]+r.offsetX)*r.scaleX,y=(O[j+1]+r.offsetY)*r.scaleY;if(K>=y)return;const h=_[p],u=_[p+1],E=_[p+2],k=_[g],N=_[g+1],B=_[g+2],C=_[M],l=_[M+1],x=_[M+2],v=Math.round(K),S=Math.round(y);let F,U,W,G,at,$,Q,tt;for(let Z=v;Z<=S;Z++){if(Z<J){const ut=Z<K?0:(K-Z)/(K-J);F=et-(et-nt)*ut,U=h-(h-k)*ut,W=u-(u-N)*ut,G=E-(E-B)*ut}else{let ut;Z>y?ut=1:J===y?ut=0:ut=(J-Z)/(J-y),F=nt-(nt-L)*ut,U=k-(k-C)*ut,W=N-(N-l)*ut,G=B-(B-x)*ut}let it;Z<K?it=0:Z>y?it=1:it=(K-Z)/(K-y),at=et-(et-L)*it,$=h-(h-C)*it,Q=u-(u-l)*it,tt=E-(E-x)*it;const ot=Math.round(Math.min(F,at)),ct=Math.round(Math.max(F,at));let ht=z*Z+ot*4;for(let ut=ot;ut<=ct;ut++)it=(F-ut)/(F-at),it<0?it=0:it>1&&(it=1),H[ht++]=U-(U-$)*it|0,H[ht++]=W-(W-Q)*it|0,H[ht++]=G-(G-tt)*it|0,H[ht++]=255}}function t(m,r,b){const w=r.coords,j=r.colors;let p,g;switch(r.type){case"lattice":const M=r.verticesPerRow,O=Math.floor(w.length/M)-1,_=M-1;for(p=0;p<O;p++){let H=p*M;for(let z=0;z<_;z++,H++)n(m,b,w[H],w[H+1],w[H+M],j[H],j[H+1],j[H+M]),n(m,b,w[H+M+1],w[H+1],w[H+M],j[H+M+1],j[H+1],j[H+M])}break;case"triangles":for(p=0,g=w.length;p<g;p+=3)n(m,b,w[p],w[p+1],w[p+2],j[p],j[p+1],j[p+2]);break;default:throw new Error("illegal figure")}}class s extends T{constructor(r){super(),this._coords=r[2],this._colors=r[3],this._figures=r[4],this._bounds=r[5],this._bbox=r[7],this._background=r[8],this.matrix=null}_createMeshCanvas(r,b,w){const M=Math.floor(this._bounds[0]),O=Math.floor(this._bounds[1]),_=Math.ceil(this._bounds[2])-M,H=Math.ceil(this._bounds[3])-O,z=Math.min(Math.ceil(Math.abs(_*r[0]*1.1)),3e3),st=Math.min(Math.ceil(Math.abs(H*r[1]*1.1)),3e3),et=_/z,K=H/st,nt={coords:this._coords,colors:this._colors,offsetX:-M,offsetY:-O,scaleX:1/et,scaleY:1/K},J=z+4,L=st+4,y=w.getCanvas("mesh",J,L,!1),h=y.context,u=h.createImageData(z,st);if(b){const k=u.data;for(let N=0,B=k.length;N<B;N+=4)k[N]=b[0],k[N+1]=b[1],k[N+2]=b[2],k[N+3]=255}for(const k of this._figures)t(u,k,nt);return h.putImageData(u,2,2),{canvas:y.canvas,offsetX:M-2*et,offsetY:O-2*K,scaleX:et,scaleY:K}}getPattern(r,b,w,j){A(r,this._bbox);let p;if(j===I.SHADING)p=o.Util.singularValueDecompose2dScale((0,f.getCurrentTransform)(r));else if(p=o.Util.singularValueDecompose2dScale(b.baseTransform),this.matrix){const M=o.Util.singularValueDecompose2dScale(this.matrix);p=[p[0]*M[0],p[1]*M[1]]}const g=this._createMeshCanvas(p,j===I.SHADING?null:this._background,b.cachedCanvases);return j!==I.SHADING&&(r.setTransform(...b.baseTransform),this.matrix&&r.transform(...this.matrix)),r.translate(g.offsetX,g.offsetY),r.scale(g.scaleX,g.scaleY),r.createPattern(g.canvas,"no-repeat")}}class a extends T{getPattern(){return"hotpink"}}function c(m){switch(m[0]){case"RadialAxial":return new P(m);case"Mesh":return new s(m);case"Dummy":return new a}throw new Error(`Unknown IR type: ${m[0]}`)}const e={COLORED:1,UNCOLORED:2};class d{static MAX_PATTERN_SIZE=3e3;constructor(r,b,w,j,p){this.operatorList=r[2],this.matrix=r[3]||[1,0,0,1,0,0],this.bbox=r[4],this.xstep=r[5],this.ystep=r[6],this.paintType=r[7],this.tilingType=r[8],this.color=b,this.ctx=w,this.canvasGraphicsFactory=j,this.baseTransform=p}createPatternCanvas(r){const b=this.operatorList,w=this.bbox,j=this.xstep,p=this.ystep,g=this.paintType,M=this.tilingType,O=this.color,_=this.canvasGraphicsFactory;(0,o.info)("TilingType: "+M);const H=w[0],z=w[1],st=w[2],et=w[3],K=o.Util.singularValueDecompose2dScale(this.matrix),nt=o.Util.singularValueDecompose2dScale(this.baseTransform),J=[K[0]*nt[0],K[1]*nt[1]],L=this.getSizeAndScale(j,this.ctx.canvas.width,J[0]),y=this.getSizeAndScale(p,this.ctx.canvas.height,J[1]),h=r.cachedCanvases.getCanvas("pattern",L.size,y.size,!0),u=h.context,E=_.createCanvasGraphics(u);E.groupLevel=r.groupLevel,this.setFillAndStrokeStyleToContext(E,g,O);let k=H,N=z,B=st,C=et;return H<0&&(k=0,B+=Math.abs(H)),z<0&&(N=0,C+=Math.abs(z)),u.translate(-(L.scale*k),-(y.scale*N)),E.transform(L.scale,0,0,y.scale,0,0),u.save(),this.clipBbox(E,k,N,B,C),E.baseTransform=(0,f.getCurrentTransform)(E.ctx),E.executeOperatorList(b),E.endDrawing(),{canvas:h.canvas,scaleX:L.scale,scaleY:y.scale,offsetX:k,offsetY:N}}getSizeAndScale(r,b,w){r=Math.abs(r);const j=Math.max(d.MAX_PATTERN_SIZE,b);let p=Math.ceil(r*w);return p>=j?p=j:w=p/r,{scale:w,size:p}}clipBbox(r,b,w,j,p){const g=j-b,M=p-w;r.ctx.rect(b,w,g,M),r.current.updateRectMinMax((0,f.getCurrentTransform)(r.ctx),[b,w,j,p]),r.clip(),r.endPath()}setFillAndStrokeStyleToContext(r,b,w){const j=r.ctx,p=r.current;switch(b){case e.COLORED:const g=this.ctx;j.fillStyle=g.fillStyle,j.strokeStyle=g.strokeStyle,p.fillColor=g.fillStyle,p.strokeColor=g.strokeStyle;break;case e.UNCOLORED:const M=o.Util.makeHexColor(w[0],w[1],w[2]);j.fillStyle=M,j.strokeStyle=M,p.fillColor=M,p.strokeColor=M;break;default:throw new o.FormatError(`Unsupported paint type: ${b}`)}}getPattern(r,b,w,j){let p=w;j!==I.SHADING&&(p=o.Util.transform(p,b.baseTransform),this.matrix&&(p=o.Util.transform(p,this.matrix)));const g=this.createPatternCanvas(b);let M=new DOMMatrix(p);M=M.translate(g.offsetX,g.offsetY),M=M.scale(1/g.scaleX,1/g.scaleY);const O=r.createPattern(g.canvas,"repeat");return O.setTransform(M),O}}i.TilingPattern=d}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.convertBlackAndWhiteToRGBA=I,i.convertToRGBA=f,i.grayToRGBA=T;var o=R(1);function f(P){switch(P.kind){case o.ImageKind.GRAYSCALE_1BPP:return I(P);case o.ImageKind.RGB_24BPP:return A(P)}return null}function I({src:P,srcPos:n=0,dest:t,width:s,height:a,nonBlackColor:c=4294967295,inverseDecode:e=!1}){const d=o.FeatureTest.isLittleEndian?4278190080:255,[m,r]=e?[c,d]:[d,c],b=s>>3,w=s&7,j=P.length;t=new Uint32Array(t.buffer);let p=0;for(let g=0;g<a;g++){for(const O=n+b;n<O;n++){const _=n<j?P[n]:255;t[p++]=_&128?r:m,t[p++]=_&64?r:m,t[p++]=_&32?r:m,t[p++]=_&16?r:m,t[p++]=_&8?r:m,t[p++]=_&4?r:m,t[p++]=_&2?r:m,t[p++]=_&1?r:m}if(w===0)continue;const M=n<j?P[n++]:255;for(let O=0;O<w;O++)t[p++]=M&1<<7-O?r:m}return{srcPos:n,destPos:p}}function A({src:P,srcPos:n=0,dest:t,destPos:s=0,width:a,height:c}){let e=0;const d=P.length>>2,m=new Uint32Array(P.buffer,n,d);if(o.FeatureTest.isLittleEndian){for(;e<d-2;e+=3,s+=4){const r=m[e],b=m[e+1],w=m[e+2];t[s]=r|4278190080,t[s+1]=r>>>24|b<<8|4278190080,t[s+2]=b>>>16|w<<16|4278190080,t[s+3]=w>>>8|4278190080}for(let r=e*4,b=P.length;r<b;r+=3)t[s++]=P[r]|P[r+1]<<8|P[r+2]<<16|4278190080}else{for(;e<d-2;e+=3,s+=4){const r=m[e],b=m[e+1],w=m[e+2];t[s]=r|255,t[s+1]=r<<24|b>>>8|255,t[s+2]=b<<16|w>>>16|255,t[s+3]=w<<8|255}for(let r=e*4,b=P.length;r<b;r+=3)t[s++]=P[r]<<24|P[r+1]<<16|P[r+2]<<8|255}return{srcPos:n,destPos:s}}function T(P,n){if(o.FeatureTest.isLittleEndian)for(let t=0,s=P.length;t<s;t++)n[t]=P[t]*65793|4278190080;else for(let t=0,s=P.length;t<s;t++)n[t]=P[t]*16843008|255}}),((D,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GlobalWorkerOptions=void 0;const R=Object.create(null);i.GlobalWorkerOptions=R,R.workerPort=null,R.workerSrc=""}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.MessageHandler=void 0;var o=R(1);const f={DATA:1,ERROR:2},I={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function A(P){switch(P instanceof Error||typeof P=="object"&&P!==null||(0,o.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),P.name){case"AbortException":return new o.AbortException(P.message);case"MissingPDFException":return new o.MissingPDFException(P.message);case"PasswordException":return new o.PasswordException(P.message,P.code);case"UnexpectedResponseException":return new o.UnexpectedResponseException(P.message,P.status);case"UnknownErrorException":return new o.UnknownErrorException(P.message,P.details);default:return new o.UnknownErrorException(P.message,P.toString())}}class T{constructor(n,t,s){this.sourceName=n,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=a=>{const c=a.data;if(c.targetName!==this.sourceName)return;if(c.stream){this.#e(c);return}if(c.callback){const d=c.callbackId,m=this.callbackCapabilities[d];if(!m)throw new Error(`Cannot resolve callback ${d}`);if(delete this.callbackCapabilities[d],c.callback===f.DATA)m.resolve(c.data);else if(c.callback===f.ERROR)m.reject(A(c.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[c.action];if(!e)throw new Error(`Unknown action from worker: ${c.action}`);if(c.callbackId){const d=this.sourceName,m=c.sourceName;new Promise(function(r){r(e(c.data))}).then(function(r){s.postMessage({sourceName:d,targetName:m,callback:f.DATA,callbackId:c.callbackId,data:r})},function(r){s.postMessage({sourceName:d,targetName:m,callback:f.ERROR,callbackId:c.callbackId,reason:A(r)})});return}if(c.streamId){this.#t(c);return}e(c.data)},s.addEventListener("message",this._onComObjOnMessage)}on(n,t){const s=this.actionHandler;if(s[n])throw new Error(`There is already an actionName called "${n}"`);s[n]=t}send(n,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,data:t},s)}sendWithPromise(n,t,s){const a=this.callbackId++,c=new o.PromiseCapability;this.callbackCapabilities[a]=c;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,callbackId:a,data:t},s)}catch(e){c.reject(e)}return c.promise}sendWithStream(n,t,s,a){const c=this.streamId++,e=this.sourceName,d=this.targetName,m=this.comObj;return new ReadableStream({start:r=>{const b=new o.PromiseCapability;return this.streamControllers[c]={controller:r,startCall:b,pullCall:null,cancelCall:null,isClosed:!1},m.postMessage({sourceName:e,targetName:d,action:n,streamId:c,data:t,desiredSize:r.desiredSize},a),b.promise},pull:r=>{const b=new o.PromiseCapability;return this.streamControllers[c].pullCall=b,m.postMessage({sourceName:e,targetName:d,stream:I.PULL,streamId:c,desiredSize:r.desiredSize}),b.promise},cancel:r=>{(0,o.assert)(r instanceof Error,"cancel must have a valid reason");const b=new o.PromiseCapability;return this.streamControllers[c].cancelCall=b,this.streamControllers[c].isClosed=!0,m.postMessage({sourceName:e,targetName:d,stream:I.CANCEL,streamId:c,reason:A(r)}),b.promise}},s)}#t(n){const t=n.streamId,s=this.sourceName,a=n.sourceName,c=this.comObj,e=this,d=this.actionHandler[n.action],m={enqueue(r,b=1,w){if(this.isCancelled)return;const j=this.desiredSize;this.desiredSize-=b,j>0&&this.desiredSize<=0&&(this.sinkCapability=new o.PromiseCapability,this.ready=this.sinkCapability.promise),c.postMessage({sourceName:s,targetName:a,stream:I.ENQUEUE,streamId:t,chunk:r},w)},close(){this.isCancelled||(this.isCancelled=!0,c.postMessage({sourceName:s,targetName:a,stream:I.CLOSE,streamId:t}),delete e.streamSinks[t])},error(r){(0,o.assert)(r instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,c.postMessage({sourceName:s,targetName:a,stream:I.ERROR,streamId:t,reason:A(r)}))},sinkCapability:new o.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:n.desiredSize,ready:null};m.sinkCapability.resolve(),m.ready=m.sinkCapability.promise,this.streamSinks[t]=m,new Promise(function(r){r(d(n.data,m))}).then(function(){c.postMessage({sourceName:s,targetName:a,stream:I.START_COMPLETE,streamId:t,success:!0})},function(r){c.postMessage({sourceName:s,targetName:a,stream:I.START_COMPLETE,streamId:t,reason:A(r)})})}#e(n){const t=n.streamId,s=this.sourceName,a=n.sourceName,c=this.comObj,e=this.streamControllers[t],d=this.streamSinks[t];switch(n.stream){case I.START_COMPLETE:n.success?e.startCall.resolve():e.startCall.reject(A(n.reason));break;case I.PULL_COMPLETE:n.success?e.pullCall.resolve():e.pullCall.reject(A(n.reason));break;case I.PULL:if(!d){c.postMessage({sourceName:s,targetName:a,stream:I.PULL_COMPLETE,streamId:t,success:!0});break}d.desiredSize<=0&&n.desiredSize>0&&d.sinkCapability.resolve(),d.desiredSize=n.desiredSize,new Promise(function(m){m(d.onPull?.())}).then(function(){c.postMessage({sourceName:s,targetName:a,stream:I.PULL_COMPLETE,streamId:t,success:!0})},function(m){c.postMessage({sourceName:s,targetName:a,stream:I.PULL_COMPLETE,streamId:t,reason:A(m)})});break;case I.ENQUEUE:if((0,o.assert)(e,"enqueue should have stream controller"),e.isClosed)break;e.controller.enqueue(n.chunk);break;case I.CLOSE:if((0,o.assert)(e,"close should have stream controller"),e.isClosed)break;e.isClosed=!0,e.controller.close(),this.#s(e,t);break;case I.ERROR:(0,o.assert)(e,"error should have stream controller"),e.controller.error(A(n.reason)),this.#s(e,t);break;case I.CANCEL_COMPLETE:n.success?e.cancelCall.resolve():e.cancelCall.reject(A(n.reason)),this.#s(e,t);break;case I.CANCEL:if(!d)break;new Promise(function(m){m(d.onCancel?.(A(n.reason)))}).then(function(){c.postMessage({sourceName:s,targetName:a,stream:I.CANCEL_COMPLETE,streamId:t,success:!0})},function(m){c.postMessage({sourceName:s,targetName:a,stream:I.CANCEL_COMPLETE,streamId:t,reason:A(m)})}),d.sinkCapability.reject(A(n.reason)),d.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#s(n,t){await Promise.allSettled([n.startCall?.promise,n.pullCall?.promise,n.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}i.MessageHandler=T}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Metadata=void 0;var o=R(1);class f{#t;#e;constructor({parsedData:A,rawData:T}){this.#t=A,this.#e=T}getRaw(){return this.#e}get(A){return this.#t.get(A)??null}getAll(){return(0,o.objectFromMap)(this.#t)}has(A){return this.#t.has(A)}}i.Metadata=f}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OptionalContentConfig=void 0;var o=R(1),f=R(8);const I=Symbol("INTERNAL");class A{#t=!0;constructor(n,t){this.name=n,this.intent=t}get visible(){return this.#t}_setVisible(n,t){n!==I&&(0,o.unreachable)("Internal method `_setVisible` called."),this.#t=t}}class T{#t=null;#e=new Map;#s=null;#n=null;constructor(n){if(this.name=null,this.creator=null,n!==null){this.name=n.name,this.creator=n.creator,this.#n=n.order;for(const t of n.groups)this.#e.set(t.id,new A(t.name,t.intent));if(n.baseState==="OFF")for(const t of this.#e.values())t._setVisible(I,!1);for(const t of n.on)this.#e.get(t)._setVisible(I,!0);for(const t of n.off)this.#e.get(t)._setVisible(I,!1);this.#s=this.getHash()}}#o(n){const t=n.length;if(t<2)return!0;const s=n[0];for(let a=1;a<t;a++){const c=n[a];let e;if(Array.isArray(c))e=this.#o(c);else if(this.#e.has(c))e=this.#e.get(c).visible;else return(0,o.warn)(`Optional content group not found: ${c}`),!0;switch(s){case"And":if(!e)return!1;break;case"Or":if(e)return!0;break;case"Not":return!e;default:return!0}}return s==="And"}isVisible(n){if(this.#e.size===0)return!0;if(!n)return(0,o.warn)("Optional content group not defined."),!0;if(n.type==="OCG")return this.#e.has(n.id)?this.#e.get(n.id).visible:((0,o.warn)(`Optional content group not found: ${n.id}`),!0);if(n.type==="OCMD"){if(n.expression)return this.#o(n.expression);if(!n.policy||n.policy==="AnyOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(n.policy==="AnyOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return(0,o.warn)(`Unknown optional content policy ${n.policy}.`),!0}return(0,o.warn)(`Unknown group type ${n.type}.`),!0}setVisibility(n,t=!0){if(!this.#e.has(n)){(0,o.warn)(`Optional content group not found: ${n}`);return}this.#e.get(n)._setVisible(I,!!t),this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,o.objectFromMap)(this.#e):null}getGroup(n){return this.#e.get(n)||null}getHash(){if(this.#t!==null)return this.#t;const n=new f.MurmurHash3_64;for(const[t,s]of this.#e)n.update(`${t}:${s.visible}`);return this.#t=n.hexdigest()}}i.OptionalContentConfig=T}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFDataTransportStream=void 0;var o=R(1),f=R(6);class I{constructor({length:n,initialData:t,progressiveDone:s=!1,contentDispositionFilename:a=null,disableRange:c=!1,disableStream:e=!1},d){if((0,o.assert)(d,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=s,this._contentDispositionFilename=a,t?.length>0){const m=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(m)}this._pdfDataRangeTransport=d,this._isStreamingSupported=!e,this._isRangeSupported=!c,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((m,r)=>{this._onReceiveData({begin:m,chunk:r})}),this._pdfDataRangeTransport.addProgressListener((m,r)=>{this._onProgress({loaded:m,total:r})}),this._pdfDataRangeTransport.addProgressiveReadListener(m=>{this._onReceiveData({chunk:m})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:n,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(n===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const a=this._rangeReaders.some(function(c){return c._begin!==n?!1:(c._enqueue(s),!0)});(0,o.assert)(a,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(n){n.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:n.loaded}):this._fullRequestReader?.onProgress?.({loaded:n.loaded,total:n.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(n){const t=this._rangeReaders.indexOf(n);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,o.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const n=this._queuedChunks;return this._queuedChunks=null,new A(this,n,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(n,t){if(t<=this._progressiveDataLength)return null;const s=new T(this,n,t);return this._pdfDataRangeTransport.requestDataRange(n,t),this._rangeReaders.push(s),s}cancelAllRequests(n){this._fullRequestReader?.cancel(n);for(const t of this._rangeReaders.slice(0))t.cancel(n);this._pdfDataRangeTransport.abort()}}i.PDFDataTransportStream=I;class A{constructor(n,t,s=!1,a=null){this._stream=n,this._done=s||!1,this._filename=(0,f.isPdfFile)(a)?a:null,this._queuedChunks=t||[],this._loaded=0;for(const c of this._queuedChunks)this._loaded+=c.byteLength;this._requests=[],this._headersReady=Promise.resolve(),n._fullRequestReader=this,this.onProgress=null}_enqueue(n){this._done||(this._requests.length>0?this._requests.shift().resolve({value:n,done:!1}):this._queuedChunks.push(n),this._loaded+=n.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const n=new o.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class T{constructor(n,t,s){this._stream=n,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(n){if(!this._done){if(this._requests.length===0)this._queuedChunk=n;else{this._requests.shift().resolve({value:n,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const n=new o.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFFetchStream=void 0;var o=R(1),f=R(20);function I(s,a,c){return{method:"GET",headers:s,signal:c.signal,mode:"cors",credentials:a?"include":"same-origin",redirect:"follow"}}function A(s){const a=new Headers;for(const c in s){const e=s[c];e!==void 0&&a.append(c,e)}return a}function T(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:((0,o.warn)(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class P{constructor(a){this.source=a,this.isHttp=/^https?:/i.test(a.url),this.httpHeaders=this.isHttp&&a.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,o.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new n(this),this._fullRequestReader}getRangeReader(a,c){if(c<=this._progressiveDataLength)return null;const e=new t(this,a,c);return this._rangeRequestReaders.push(e),e}cancelAllRequests(a){this._fullRequestReader?.cancel(a);for(const c of this._rangeRequestReaders.slice(0))c.cancel(a)}}i.PDFFetchStream=P;class n{constructor(a){this._stream=a,this._reader=null,this._loaded=0,this._filename=null;const c=a.source;this._withCredentials=c.withCredentials||!1,this._contentLength=c.length,this._headersCapability=new o.PromiseCapability,this._disableRange=c.disableRange||!1,this._rangeChunkSize=c.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!c.disableStream,this._isRangeSupported=!c.disableRange,this._headers=A(this._stream.httpHeaders);const e=c.url;fetch(e,I(this._headers,this._withCredentials,this._abortController)).then(d=>{if(!(0,f.validateResponseStatus)(d.status))throw(0,f.createResponseStatusError)(d.status,e);this._reader=d.body.getReader(),this._headersCapability.resolve();const m=w=>d.headers.get(w),{allowRangeRequests:r,suggestedLength:b}=(0,f.validateRangeRequestCapabilities)({getResponseHeader:m,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=r,this._contentLength=b||this._contentLength,this._filename=(0,f.extractFilenameFromHeader)(m),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new o.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:a,done:c}=await this._reader.read();return c?{value:a,done:c}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:T(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}class t{constructor(a,c,e){this._stream=a,this._reader=null,this._loaded=0;const d=a.source;this._withCredentials=d.withCredentials||!1,this._readCapability=new o.PromiseCapability,this._isStreamingSupported=!d.disableStream,this._abortController=new AbortController,this._headers=A(this._stream.httpHeaders),this._headers.append("Range",`bytes=${c}-${e-1}`);const m=d.url;fetch(m,I(this._headers,this._withCredentials,this._abortController)).then(r=>{if(!(0,f.validateResponseStatus)(r.status))throw(0,f.createResponseStatusError)(r.status,m);this._readCapability.resolve(),this._reader=r.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:a,done:c}=await this._reader.read();return c?{value:a,done:c}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded}),{value:T(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createResponseStatusError=P,i.extractFilenameFromHeader=T,i.validateRangeRequestCapabilities=A,i.validateResponseStatus=n;var o=R(1),f=R(21),I=R(6);function A({getResponseHeader:t,isHttp:s,rangeChunkSize:a,disableRange:c}){const e={allowRangeRequests:!1,suggestedLength:void 0},d=parseInt(t("Content-Length"),10);return!Number.isInteger(d)||(e.suggestedLength=d,d<=2*a)||c||!s||t("Accept-Ranges")!=="bytes"||(t("Content-Encoding")||"identity")!=="identity"||(e.allowRangeRequests=!0),e}function T(t){const s=t("Content-Disposition");if(s){let a=(0,f.getFilenameFromContentDispositionHeader)(s);if(a.includes("%"))try{a=decodeURIComponent(a)}catch{}if((0,I.isPdfFile)(a))return a}return null}function P(t,s){return t===404||t===0&&s.startsWith("file:")?new o.MissingPDFException('Missing PDF "'+s+'".'):new o.UnexpectedResponseException(`Unexpected server response (${t}) while retrieving PDF "${s}".`,t)}function n(t){return t===200||t===206}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.getFilenameFromContentDispositionHeader=f;var o=R(1);function f(I){let A=!0,T=P("filename\\*","i").exec(I);if(T){T=T[1];let d=a(T);return d=unescape(d),d=c(d),d=e(d),t(d)}if(T=s(I),T){const d=e(T);return t(d)}if(T=P("filename","i").exec(I),T){T=T[1];let d=a(T);return d=e(d),t(d)}function P(d,m){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',m)}function n(d,m){if(d){if(!/^[\x00-\xFF]+$/.test(m))return m;try{const r=new TextDecoder(d,{fatal:!0}),b=(0,o.stringToBytes)(m);m=r.decode(b),A=!1}catch{}}return m}function t(d){return A&&/[\x80-\xff]/.test(d)&&(d=n("utf-8",d),A&&(d=n("iso-8859-1",d))),d}function s(d){const m=[];let r;const b=P("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(r=b.exec(d))!==null;){let[,j,p,g]=r;if(j=parseInt(j,10),j in m){if(j===0)break;continue}m[j]=[p,g]}const w=[];for(let j=0;j<m.length&&j in m;++j){let[p,g]=m[j];g=a(g),p&&(g=unescape(g),j===0&&(g=c(g))),w.push(g)}return w.join("")}function a(d){if(d.startsWith('"')){const m=d.slice(1).split('\\"');for(let r=0;r<m.length;++r){const b=m[r].indexOf('"');b!==-1&&(m[r]=m[r].slice(0,b),m.length=r+1),m[r]=m[r].replaceAll(/\\(.)/g,"$1")}d=m.join('"')}return d}function c(d){const m=d.indexOf("'");if(m===-1)return d;const r=d.slice(0,m),w=d.slice(m+1).replace(/^[^']*'/,"");return n(r,w)}function e(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(m,r,b,w){if(b==="q"||b==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(j,p){return String.fromCharCode(parseInt(p,16))}),n(r,w);try{w=atob(w)}catch{}return n(r,w)})}return""}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFNetworkStream=void 0;var o=R(1),f=R(20);const I=200,A=206;function T(a){const c=a.response;return typeof c!="string"?c:(0,o.stringToBytes)(c).buffer}class P{constructor(c,e={}){this.url=c,this.isHttp=/^https?:/i.test(c),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(c,e,d){const m={begin:c,end:e};for(const r in d)m[r]=d[r];return this.request(m)}requestFull(c){return this.request(c)}request(c){const e=new XMLHttpRequest,d=this.currXhrId++,m=this.pendingRequests[d]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const r in this.httpHeaders){const b=this.httpHeaders[r];b!==void 0&&e.setRequestHeader(r,b)}return this.isHttp&&"begin"in c&&"end"in c?(e.setRequestHeader("Range",`bytes=${c.begin}-${c.end-1}`),m.expectedStatus=A):m.expectedStatus=I,e.responseType="arraybuffer",c.onError&&(e.onerror=function(r){c.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,d),e.onprogress=this.onProgress.bind(this,d),m.onHeadersReceived=c.onHeadersReceived,m.onDone=c.onDone,m.onError=c.onError,m.onProgress=c.onProgress,e.send(null),d}onProgress(c,e){const d=this.pendingRequests[c];d&&d.onProgress?.(e)}onStateChange(c,e){const d=this.pendingRequests[c];if(!d)return;const m=d.xhr;if(m.readyState>=2&&d.onHeadersReceived&&(d.onHeadersReceived(),delete d.onHeadersReceived),m.readyState!==4||!(c in this.pendingRequests))return;if(delete this.pendingRequests[c],m.status===0&&this.isHttp){d.onError?.(m.status);return}const r=m.status||I;if(!(r===I&&d.expectedStatus===A)&&r!==d.expectedStatus){d.onError?.(m.status);return}const w=T(m);if(r===A){const j=m.getResponseHeader("Content-Range"),p=/bytes (\d+)-(\d+)\/(\d+)/.exec(j);d.onDone({begin:parseInt(p[1],10),chunk:w})}else w?d.onDone({begin:0,chunk:w}):d.onError?.(m.status)}getRequestXhr(c){return this.pendingRequests[c].xhr}isPendingRequest(c){return c in this.pendingRequests}abortRequest(c){const e=this.pendingRequests[c].xhr;delete this.pendingRequests[c],e.abort()}}class n{constructor(c){this._source=c,this._manager=new P(c.url,{httpHeaders:c.httpHeaders,withCredentials:c.withCredentials}),this._rangeChunkSize=c.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(c){const e=this._rangeRequestReaders.indexOf(c);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return(0,o.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new t(this._manager,this._source),this._fullRequestReader}getRangeReader(c,e){const d=new s(this._manager,c,e);return d.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(d),d}cancelAllRequests(c){this._fullRequestReader?.cancel(c);for(const e of this._rangeRequestReaders.slice(0))e.cancel(c)}}i.PDFNetworkStream=n;class t{constructor(c,e){this._manager=c;const d={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=c.requestFull(d),this._headersReceivedCapability=new o.PromiseCapability,this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const c=this._fullRequestId,e=this._manager.getRequestXhr(c),d=b=>e.getResponseHeader(b),{allowRangeRequests:m,suggestedLength:r}=(0,f.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});m&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=(0,f.extractFilenameFromHeader)(d),this._isRangeSupported&&this._manager.abortRequest(c),this._headersReceivedCapability.resolve()}_onDone(c){if(c&&(this._requests.length>0?this._requests.shift().resolve({value:c.chunk,done:!1}):this._cachedChunks.push(c.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(c){this._storedError=(0,f.createResponseStatusError)(c,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(c){this.onProgress?.({loaded:c.loaded,total:c.lengthComputable?c.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const c=new o.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0,this._headersReceivedCapability.reject(c);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class s{constructor(c,e,d){this._manager=c;const m={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=c.url,this._requestId=c.requestRange(e,d,m),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(c){const e=c.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(c){this._storedError=(0,f.createResponseStatusError)(c,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(c){this.isStreamingSupported||this.onProgress?.({loaded:c.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const c=new o.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFNodeStream=void 0;var o=R(1),f=R(20);const I=/^file:\/\/\/[a-zA-Z]:\//;function A(d){const m=require$$5,r=m.parse(d);return r.protocol==="file:"||r.host?r:/^[a-z]:[/\\]/i.test(d)?m.parse(`file:///${d}`):(r.host||(r.protocol="file:"),r)}class T{constructor(m){this.source=m,this.url=A(m.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&m.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,o.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new c(this):new s(this),this._fullRequestReader}getRangeReader(m,r){if(r<=this._progressiveDataLength)return null;const b=this.isFsUrl?new e(this,m,r):new a(this,m,r);return this._rangeRequestReaders.push(b),b}cancelAllRequests(m){this._fullRequestReader?.cancel(m);for(const r of this._rangeRequestReaders.slice(0))r.cancel(m)}}i.PDFNodeStream=T;class P{constructor(m){this._url=m.url,this._done=!1,this._storedError=null,this.onProgress=null;const r=m.source;this._contentLength=r.length,this._loaded=0,this._filename=null,this._disableRange=r.disableRange||!1,this._rangeChunkSize=r.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!r.disableStream,this._isRangeSupported=!r.disableRange,this._readableStream=null,this._readCapability=new o.PromiseCapability,this._headersCapability=new o.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const m=this._readableStream.read();return m===null?(this._readCapability=new o.PromiseCapability,this.read()):(this._loaded+=m.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(m).buffer,done:!1})}cancel(m){if(!this._readableStream){this._error(m);return}this._readableStream.destroy(m)}_error(m){this._storedError=m,this._readCapability.resolve()}_setReadableStream(m){this._readableStream=m,m.on("readable",()=>{this._readCapability.resolve()}),m.on("end",()=>{m.destroy(),this._done=!0,this._readCapability.resolve()}),m.on("error",r=>{this._error(r)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new o.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class n{constructor(m){this._url=m.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new o.PromiseCapability;const r=m.source;this._isStreamingSupported=!r.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const m=this._readableStream.read();return m===null?(this._readCapability=new o.PromiseCapability,this.read()):(this._loaded+=m.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(m).buffer,done:!1})}cancel(m){if(!this._readableStream){this._error(m);return}this._readableStream.destroy(m)}_error(m){this._storedError=m,this._readCapability.resolve()}_setReadableStream(m){this._readableStream=m,m.on("readable",()=>{this._readCapability.resolve()}),m.on("end",()=>{m.destroy(),this._done=!0,this._readCapability.resolve()}),m.on("error",r=>{this._error(r)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function t(d,m){return{protocol:d.protocol,auth:d.auth,host:d.hostname,port:d.port,path:d.path,method:"GET",headers:m}}class s extends P{constructor(m){super(m);const r=b=>{if(b.statusCode===404){const g=new o.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=g,this._headersCapability.reject(g);return}this._headersCapability.resolve(),this._setReadableStream(b);const w=g=>this._readableStream.headers[g.toLowerCase()],{allowRangeRequests:j,suggestedLength:p}=(0,f.validateRangeRequestCapabilities)({getResponseHeader:w,isHttp:m.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=j,this._contentLength=p||this._contentLength,this._filename=(0,f.extractFilenameFromHeader)(w)};if(this._request=null,this._url.protocol==="http:"){const b=require$$5;this._request=b.request(t(this._url,m.httpHeaders),r)}else{const b=require$$5;this._request=b.request(t(this._url,m.httpHeaders),r)}this._request.on("error",b=>{this._storedError=b,this._headersCapability.reject(b)}),this._request.end()}}class a extends n{constructor(m,r,b){super(m),this._httpHeaders={};for(const j in m.httpHeaders){const p=m.httpHeaders[j];p!==void 0&&(this._httpHeaders[j]=p)}this._httpHeaders.Range=`bytes=${r}-${b-1}`;const w=j=>{if(j.statusCode===404){const p=new o.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=p;return}this._setReadableStream(j)};if(this._request=null,this._url.protocol==="http:"){const j=require$$5;this._request=j.request(t(this._url,this._httpHeaders),w)}else{const j=require$$5;this._request=j.request(t(this._url,this._httpHeaders),w)}this._request.on("error",j=>{this._storedError=j}),this._request.end()}}class c extends P{constructor(m){super(m);let r=decodeURIComponent(this._url.path);I.test(this._url.href)&&(r=r.replace(/^\//,""));const b=require$$5;b.lstat(r,(w,j)=>{if(w){w.code==="ENOENT"&&(w=new o.MissingPDFException(`Missing PDF "${r}".`)),this._storedError=w,this._headersCapability.reject(w);return}this._contentLength=j.size,this._setReadableStream(b.createReadStream(r)),this._headersCapability.resolve()})}}class e extends n{constructor(m,r,b){super(m);let w=decodeURIComponent(this._url.path);I.test(this._url.href)&&(w=w.replace(/^\//,""));const j=require$$5;this._setReadableStream(j.createReadStream(w,{start:r,end:b-1}))}}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SVGGraphics=void 0;var o=R(6),f=R(1);const I={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},A="http://www.w3.org/XML/1998/namespace",T="http://www.w3.org/1999/xlink",P=["butt","round","square"],n=["miter","round","bevel"],t=function(j,p="",g=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!g)return URL.createObjectURL(new Blob([j],{type:p}));const M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let O=`data:${p};base64,`;for(let _=0,H=j.length;_<H;_+=3){const z=j[_]&255,st=j[_+1]&255,et=j[_+2]&255,K=z>>2,nt=(z&3)<<4|st>>4,J=_+1<H?(st&15)<<2|et>>6:64,L=_+2<H?et&63:64;O+=M[K]+M[nt]+M[J]+M[L]}return O},s=(function(){const j=new Uint8Array([137,80,78,71,13,10,26,10]),p=12,g=new Int32Array(256);for(let et=0;et<256;et++){let K=et;for(let nt=0;nt<8;nt++)K=K&1?3988292384^K>>1&2147483647:K>>1&2147483647;g[et]=K}function M(et,K,nt){let J=-1;for(let L=K;L<nt;L++){const y=(J^et[L])&255,h=g[y];J=J>>>8^h}return J^-1}function O(et,K,nt,J){let L=J;const y=K.length;nt[L]=y>>24&255,nt[L+1]=y>>16&255,nt[L+2]=y>>8&255,nt[L+3]=y&255,L+=4,nt[L]=et.charCodeAt(0)&255,nt[L+1]=et.charCodeAt(1)&255,nt[L+2]=et.charCodeAt(2)&255,nt[L+3]=et.charCodeAt(3)&255,L+=4,nt.set(K,L),L+=K.length;const h=M(nt,J+4,L);nt[L]=h>>24&255,nt[L+1]=h>>16&255,nt[L+2]=h>>8&255,nt[L+3]=h&255}function _(et,K,nt){let J=1,L=0;for(let y=K;y<nt;++y)J=(J+(et[y]&255))%65521,L=(L+J)%65521;return L<<16|J}function H(et){if(!f.isNodeJS)return z(et);try{const K=parseInt(process.versions.node)>=8?et:Buffer.from(et),nt=require$$5.deflateSync(K,{level:9});return nt instanceof Uint8Array?nt:new Uint8Array(nt)}catch(K){(0,f.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+K)}return z(et)}function z(et){let K=et.length;const nt=65535,J=Math.ceil(K/nt),L=new Uint8Array(2+K+J*5+4);let y=0;L[y++]=120,L[y++]=156;let h=0;for(;K>nt;)L[y++]=0,L[y++]=255,L[y++]=255,L[y++]=0,L[y++]=0,L.set(et.subarray(h,h+nt),y),y+=nt,h+=nt,K-=nt;L[y++]=1,L[y++]=K&255,L[y++]=K>>8&255,L[y++]=~K&65535&255,L[y++]=(~K&65535)>>8&255,L.set(et.subarray(h),y),y+=et.length-h;const u=_(et,0,et.length);return L[y++]=u>>24&255,L[y++]=u>>16&255,L[y++]=u>>8&255,L[y++]=u&255,L}function st(et,K,nt,J){const L=et.width,y=et.height;let h,u,E;const k=et.data;switch(K){case f.ImageKind.GRAYSCALE_1BPP:u=0,h=1,E=L+7>>3;break;case f.ImageKind.RGB_24BPP:u=2,h=8,E=L*3;break;case f.ImageKind.RGBA_32BPP:u=6,h=8,E=L*4;break;default:throw new Error("invalid format")}const N=new Uint8Array((1+E)*y);let B=0,C=0;for(let U=0;U<y;++U)N[B++]=0,N.set(k.subarray(C,C+E),B),C+=E,B+=E;if(K===f.ImageKind.GRAYSCALE_1BPP&&J){B=0;for(let U=0;U<y;U++){B++;for(let W=0;W<E;W++)N[B++]^=255}}const l=new Uint8Array([L>>24&255,L>>16&255,L>>8&255,L&255,y>>24&255,y>>16&255,y>>8&255,y&255,h,u,0,0,0]),x=H(N),v=j.length+p*3+l.length+x.length,S=new Uint8Array(v);let F=0;return S.set(j,F),F+=j.length,O("IHDR",l,S,F),F+=p+l.length,O("IDATA",x,S,F),F+=p+x.length,O("IEND",new Uint8Array(0),S,F),t(S,"image/png",nt)}return function(K,nt,J){const L=K.kind===void 0?f.ImageKind.GRAYSCALE_1BPP:K.kind;return st(K,L,nt,J)}})();class a{constructor(){this.fontSizeScale=1,this.fontWeight=I.fontWeight,this.fontSize=0,this.textMatrix=f.IDENTITY_MATRIX,this.fontMatrix=f.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=f.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=I.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(p,g){this.x=p,this.y=g}}function c(j){let p=[];const g=[];for(const M of j){if(M.fn==="save"){p.push({fnId:92,fn:"group",items:[]}),g.push(p),p=p.at(-1).items;continue}M.fn==="restore"?p=g.pop():p.push(M)}return p}function e(j){if(Number.isInteger(j))return j.toString();const p=j.toFixed(10);let g=p.length-1;if(p[g]!=="0")return p;do g--;while(p[g]==="0");return p.substring(0,p[g]==="."?g:g+1)}function d(j){if(j[4]===0&&j[5]===0){if(j[1]===0&&j[2]===0)return j[0]===1&&j[3]===1?"":`scale(${e(j[0])} ${e(j[3])})`;if(j[0]===j[3]&&j[1]===-j[2]){const p=Math.acos(j[0])*180/Math.PI;return`rotate(${e(p)})`}}else if(j[0]===1&&j[1]===0&&j[2]===0&&j[3]===1)return`translate(${e(j[4])} ${e(j[5])})`;return`matrix(${e(j[0])} ${e(j[1])} ${e(j[2])} ${e(j[3])} ${e(j[4])} ${e(j[5])})`}let m=0,r=0,b=0;class w{constructor(p,g,M=!1){(0,o.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new o.DOMSVGFactory,this.current=new a,this.transformMatrix=f.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=p,this.objs=g,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!M,this._operatorIdMapping=[];for(const O in f.OPS)this._operatorIdMapping[f.OPS[O]]=O}getObject(p,g=null){return typeof p=="string"?p.startsWith("g_")?this.commonObjs.get(p):this.objs.get(p):g}save(){this.transformStack.push(this.transformMatrix);const p=this.current;this.extraStack.push(p),this.current=p.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(p){this.save(),this.executeOpTree(p),this.restore()}loadDependencies(p){const g=p.fnArray,M=p.argsArray;for(let O=0,_=g.length;O<_;O++)if(g[O]===f.OPS.dependency)for(const H of M[O]){const z=H.startsWith("g_")?this.commonObjs:this.objs,st=new Promise(et=>{z.get(H,et)});this.current.dependencies.push(st)}return Promise.all(this.current.dependencies)}transform(p,g,M,O,_,H){const z=[p,g,M,O,_,H];this.transformMatrix=f.Util.transform(this.transformMatrix,z),this.tgrp=null}getSVG(p,g){this.viewport=g;const M=this._initialize(g);return this.loadDependencies(p).then(()=>(this.transformMatrix=f.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(p)),M))}convertOpList(p){const g=this._operatorIdMapping,M=p.argsArray,O=p.fnArray,_=[];for(let H=0,z=O.length;H<z;H++){const st=O[H];_.push({fnId:st,fn:g[st],args:M[H]})}return c(_)}executeOpTree(p){for(const g of p){const M=g.fn,O=g.fnId,_=g.args;switch(O|0){case f.OPS.beginText:this.beginText();break;case f.OPS.dependency:break;case f.OPS.setLeading:this.setLeading(_);break;case f.OPS.setLeadingMoveText:this.setLeadingMoveText(_[0],_[1]);break;case f.OPS.setFont:this.setFont(_);break;case f.OPS.showText:this.showText(_[0]);break;case f.OPS.showSpacedText:this.showText(_[0]);break;case f.OPS.endText:this.endText();break;case f.OPS.moveText:this.moveText(_[0],_[1]);break;case f.OPS.setCharSpacing:this.setCharSpacing(_[0]);break;case f.OPS.setWordSpacing:this.setWordSpacing(_[0]);break;case f.OPS.setHScale:this.setHScale(_[0]);break;case f.OPS.setTextMatrix:this.setTextMatrix(_[0],_[1],_[2],_[3],_[4],_[5]);break;case f.OPS.setTextRise:this.setTextRise(_[0]);break;case f.OPS.setTextRenderingMode:this.setTextRenderingMode(_[0]);break;case f.OPS.setLineWidth:this.setLineWidth(_[0]);break;case f.OPS.setLineJoin:this.setLineJoin(_[0]);break;case f.OPS.setLineCap:this.setLineCap(_[0]);break;case f.OPS.setMiterLimit:this.setMiterLimit(_[0]);break;case f.OPS.setFillRGBColor:this.setFillRGBColor(_[0],_[1],_[2]);break;case f.OPS.setStrokeRGBColor:this.setStrokeRGBColor(_[0],_[1],_[2]);break;case f.OPS.setStrokeColorN:this.setStrokeColorN(_);break;case f.OPS.setFillColorN:this.setFillColorN(_);break;case f.OPS.shadingFill:this.shadingFill(_[0]);break;case f.OPS.setDash:this.setDash(_[0],_[1]);break;case f.OPS.setRenderingIntent:this.setRenderingIntent(_[0]);break;case f.OPS.setFlatness:this.setFlatness(_[0]);break;case f.OPS.setGState:this.setGState(_[0]);break;case f.OPS.fill:this.fill();break;case f.OPS.eoFill:this.eoFill();break;case f.OPS.stroke:this.stroke();break;case f.OPS.fillStroke:this.fillStroke();break;case f.OPS.eoFillStroke:this.eoFillStroke();break;case f.OPS.clip:this.clip("nonzero");break;case f.OPS.eoClip:this.clip("evenodd");break;case f.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case f.OPS.paintImageXObject:this.paintImageXObject(_[0]);break;case f.OPS.paintInlineImageXObject:this.paintInlineImageXObject(_[0]);break;case f.OPS.paintImageMaskXObject:this.paintImageMaskXObject(_[0]);break;case f.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(_[0],_[1]);break;case f.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case f.OPS.closePath:this.closePath();break;case f.OPS.closeStroke:this.closeStroke();break;case f.OPS.closeFillStroke:this.closeFillStroke();break;case f.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case f.OPS.nextLine:this.nextLine();break;case f.OPS.transform:this.transform(_[0],_[1],_[2],_[3],_[4],_[5]);break;case f.OPS.constructPath:this.constructPath(_[0],_[1]);break;case f.OPS.endPath:this.endPath();break;case 92:this.group(g.items);break;default:(0,f.warn)(`Unimplemented operator ${M}`);break}}}setWordSpacing(p){this.current.wordSpacing=p}setCharSpacing(p){this.current.charSpacing=p}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(p,g,M,O,_,H){const z=this.current;z.textMatrix=z.lineMatrix=[p,g,M,O,_,H],z.textMatrixScale=Math.hypot(p,g),z.x=z.lineX=0,z.y=z.lineY=0,z.xcoords=[],z.ycoords=[],z.tspan=this.svgFactory.createElement("svg:tspan"),z.tspan.setAttributeNS(null,"font-family",z.fontFamily),z.tspan.setAttributeNS(null,"font-size",`${e(z.fontSize)}px`),z.tspan.setAttributeNS(null,"y",e(-z.y)),z.txtElement=this.svgFactory.createElement("svg:text"),z.txtElement.append(z.tspan)}beginText(){const p=this.current;p.x=p.lineX=0,p.y=p.lineY=0,p.textMatrix=f.IDENTITY_MATRIX,p.lineMatrix=f.IDENTITY_MATRIX,p.textMatrixScale=1,p.tspan=this.svgFactory.createElement("svg:tspan"),p.txtElement=this.svgFactory.createElement("svg:text"),p.txtgrp=this.svgFactory.createElement("svg:g"),p.xcoords=[],p.ycoords=[]}moveText(p,g){const M=this.current;M.x=M.lineX+=p,M.y=M.lineY+=g,M.xcoords=[],M.ycoords=[],M.tspan=this.svgFactory.createElement("svg:tspan"),M.tspan.setAttributeNS(null,"font-family",M.fontFamily),M.tspan.setAttributeNS(null,"font-size",`${e(M.fontSize)}px`),M.tspan.setAttributeNS(null,"y",e(-M.y))}showText(p){const g=this.current,M=g.font,O=g.fontSize;if(O===0)return;const _=g.fontSizeScale,H=g.charSpacing,z=g.wordSpacing,st=g.fontDirection,et=g.textHScale*st,K=M.vertical,nt=K?1:-1,J=M.defaultVMetrics,L=O*g.fontMatrix[0];let y=0;for(const E of p){if(E===null){y+=st*z;continue}else if(typeof E=="number"){y+=nt*E*O/1e3;continue}const k=(E.isSpace?z:0)+H,N=E.fontChar;let B,C,l=E.width;if(K){let v;const S=E.vmetric||J;v=E.vmetric?S[1]:l*.5,v=-v*L;const F=S[2]*L;l=S?-S[0]:l,B=v/_,C=(y+F)/_}else B=y/_,C=0;(E.isInFont||M.missingFile)&&(g.xcoords.push(g.x+B),K&&g.ycoords.push(-g.y+C),g.tspan.textContent+=N);const x=K?l*L-k*st:l*L+k*st;y+=x}g.tspan.setAttributeNS(null,"x",g.xcoords.map(e).join(" ")),K?g.tspan.setAttributeNS(null,"y",g.ycoords.map(e).join(" ")):g.tspan.setAttributeNS(null,"y",e(-g.y)),K?g.y-=y:g.x+=y*et,g.tspan.setAttributeNS(null,"font-family",g.fontFamily),g.tspan.setAttributeNS(null,"font-size",`${e(g.fontSize)}px`),g.fontStyle!==I.fontStyle&&g.tspan.setAttributeNS(null,"font-style",g.fontStyle),g.fontWeight!==I.fontWeight&&g.tspan.setAttributeNS(null,"font-weight",g.fontWeight);const h=g.textRenderingMode&f.TextRenderingMode.FILL_STROKE_MASK;if(h===f.TextRenderingMode.FILL||h===f.TextRenderingMode.FILL_STROKE?(g.fillColor!==I.fillColor&&g.tspan.setAttributeNS(null,"fill",g.fillColor),g.fillAlpha<1&&g.tspan.setAttributeNS(null,"fill-opacity",g.fillAlpha)):g.textRenderingMode===f.TextRenderingMode.ADD_TO_PATH?g.tspan.setAttributeNS(null,"fill","transparent"):g.tspan.setAttributeNS(null,"fill","none"),h===f.TextRenderingMode.STROKE||h===f.TextRenderingMode.FILL_STROKE){const E=1/(g.textMatrixScale||1);this._setStrokeAttributes(g.tspan,E)}let u=g.textMatrix;g.textRise!==0&&(u=u.slice(),u[5]+=g.textRise),g.txtElement.setAttributeNS(null,"transform",`${d(u)} scale(${e(et)}, -1)`),g.txtElement.setAttributeNS(A,"xml:space","preserve"),g.txtElement.append(g.tspan),g.txtgrp.append(g.txtElement),this._ensureTransformGroup().append(g.txtElement)}setLeadingMoveText(p,g){this.setLeading(-g),this.moveText(p,g)}addFontStyle(p){if(!p.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const g=t(p.data,p.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${p.loadedName}"; src: url(${g}); }
`}setFont(p){const g=this.current,M=this.commonObjs.get(p[0]);let O=p[1];g.font=M,this.embedFonts&&!M.missingFile&&!this.embeddedFonts[M.loadedName]&&(this.addFontStyle(M),this.embeddedFonts[M.loadedName]=M),g.fontMatrix=M.fontMatrix||f.FONT_IDENTITY_MATRIX;let _="normal";M.black?_="900":M.bold&&(_="bold");const H=M.italic?"italic":"normal";O<0?(O=-O,g.fontDirection=-1):g.fontDirection=1,g.fontSize=O,g.fontFamily=M.loadedName,g.fontWeight=_,g.fontStyle=H,g.tspan=this.svgFactory.createElement("svg:tspan"),g.tspan.setAttributeNS(null,"y",e(-g.y)),g.xcoords=[],g.ycoords=[]}endText(){const p=this.current;p.textRenderingMode&f.TextRenderingMode.ADD_TO_PATH_FLAG&&p.txtElement?.hasChildNodes()&&(p.element=p.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(p){p>0&&(this.current.lineWidth=p)}setLineCap(p){this.current.lineCap=P[p]}setLineJoin(p){this.current.lineJoin=n[p]}setMiterLimit(p){this.current.miterLimit=p}setStrokeAlpha(p){this.current.strokeAlpha=p}setStrokeRGBColor(p,g,M){this.current.strokeColor=f.Util.makeHexColor(p,g,M)}setFillAlpha(p){this.current.fillAlpha=p}setFillRGBColor(p,g,M){this.current.fillColor=f.Util.makeHexColor(p,g,M),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(p){this.current.strokeColor=this._makeColorN_Pattern(p)}setFillColorN(p){this.current.fillColor=this._makeColorN_Pattern(p)}shadingFill(p){const{width:g,height:M}=this.viewport,O=f.Util.inverseTransform(this.transformMatrix),[_,H,z,st]=f.Util.getAxialAlignedBoundingBox([0,0,g,M],O),et=this.svgFactory.createElement("svg:rect");et.setAttributeNS(null,"x",_),et.setAttributeNS(null,"y",H),et.setAttributeNS(null,"width",z-_),et.setAttributeNS(null,"height",st-H),et.setAttributeNS(null,"fill",this._makeShadingPattern(p)),this.current.fillAlpha<1&&et.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(et)}_makeColorN_Pattern(p){return p[0]==="TilingPattern"?this._makeTilingPattern(p):this._makeShadingPattern(p)}_makeTilingPattern(p){const g=p[1],M=p[2],O=p[3]||f.IDENTITY_MATRIX,[_,H,z,st]=p[4],et=p[5],K=p[6],nt=p[7],J=`shading${b++}`,[L,y,h,u]=f.Util.normalizeRect([...f.Util.applyTransform([_,H],O),...f.Util.applyTransform([z,st],O)]),[E,k]=f.Util.singularValueDecompose2dScale(O),N=et*E,B=K*k,C=this.svgFactory.createElement("svg:pattern");C.setAttributeNS(null,"id",J),C.setAttributeNS(null,"patternUnits","userSpaceOnUse"),C.setAttributeNS(null,"width",N),C.setAttributeNS(null,"height",B),C.setAttributeNS(null,"x",`${L}`),C.setAttributeNS(null,"y",`${y}`);const l=this.svg,x=this.transformMatrix,v=this.current.fillColor,S=this.current.strokeColor,F=this.svgFactory.create(h-L,u-y);if(this.svg=F,this.transformMatrix=O,nt===2){const U=f.Util.makeHexColor(...g);this.current.fillColor=U,this.current.strokeColor=U}return this.executeOpTree(this.convertOpList(M)),this.svg=l,this.transformMatrix=x,this.current.fillColor=v,this.current.strokeColor=S,C.append(F.childNodes[0]),this.defs.append(C),`url(#${J})`}_makeShadingPattern(p){switch(typeof p=="string"&&(p=this.objs.get(p)),p[0]){case"RadialAxial":const g=`shading${b++}`,M=p[3];let O;switch(p[1]){case"axial":const _=p[4],H=p[5];O=this.svgFactory.createElement("svg:linearGradient"),O.setAttributeNS(null,"id",g),O.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),O.setAttributeNS(null,"x1",_[0]),O.setAttributeNS(null,"y1",_[1]),O.setAttributeNS(null,"x2",H[0]),O.setAttributeNS(null,"y2",H[1]);break;case"radial":const z=p[4],st=p[5],et=p[6],K=p[7];O=this.svgFactory.createElement("svg:radialGradient"),O.setAttributeNS(null,"id",g),O.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),O.setAttributeNS(null,"cx",st[0]),O.setAttributeNS(null,"cy",st[1]),O.setAttributeNS(null,"r",K),O.setAttributeNS(null,"fx",z[0]),O.setAttributeNS(null,"fy",z[1]),O.setAttributeNS(null,"fr",et);break;default:throw new Error(`Unknown RadialAxial type: ${p[1]}`)}for(const _ of M){const H=this.svgFactory.createElement("svg:stop");H.setAttributeNS(null,"offset",_[0]),H.setAttributeNS(null,"stop-color",_[1]),O.append(H)}return this.defs.append(O),`url(#${g})`;case"Mesh":return(0,f.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${p[0]}`)}}setDash(p,g){this.current.dashArray=p,this.current.dashPhase=g}constructPath(p,g){const M=this.current;let O=M.x,_=M.y,H=[],z=0;for(const st of p)switch(st|0){case f.OPS.rectangle:O=g[z++],_=g[z++];const et=g[z++],K=g[z++],nt=O+et,J=_+K;H.push("M",e(O),e(_),"L",e(nt),e(_),"L",e(nt),e(J),"L",e(O),e(J),"Z");break;case f.OPS.moveTo:O=g[z++],_=g[z++],H.push("M",e(O),e(_));break;case f.OPS.lineTo:O=g[z++],_=g[z++],H.push("L",e(O),e(_));break;case f.OPS.curveTo:O=g[z+4],_=g[z+5],H.push("C",e(g[z]),e(g[z+1]),e(g[z+2]),e(g[z+3]),e(O),e(_)),z+=6;break;case f.OPS.curveTo2:H.push("C",e(O),e(_),e(g[z]),e(g[z+1]),e(g[z+2]),e(g[z+3])),O=g[z+2],_=g[z+3],z+=4;break;case f.OPS.curveTo3:O=g[z+2],_=g[z+3],H.push("C",e(g[z]),e(g[z+1]),e(O),e(_),e(O),e(_)),z+=4;break;case f.OPS.closePath:H.push("Z");break}H=H.join(" "),M.path&&p.length>0&&p[0]!==f.OPS.rectangle&&p[0]!==f.OPS.moveTo?H=M.path.getAttributeNS(null,"d")+H:(M.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(M.path)),M.path.setAttributeNS(null,"d",H),M.path.setAttributeNS(null,"fill","none"),M.element=M.path,M.setCurrentPoint(O,_)}endPath(){const p=this.current;if(p.path=null,!this.pendingClip)return;if(!p.element){this.pendingClip=null;return}const g=`clippath${m++}`,M=this.svgFactory.createElement("svg:clipPath");M.setAttributeNS(null,"id",g),M.setAttributeNS(null,"transform",d(this.transformMatrix));const O=p.element.cloneNode(!0);if(this.pendingClip==="evenodd"?O.setAttributeNS(null,"clip-rule","evenodd"):O.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,M.append(O),this.defs.append(M),p.activeClipUrl){p.clipGroup=null;for(const _ of this.extraStack)_.clipGroup=null;M.setAttributeNS(null,"clip-path",p.activeClipUrl)}p.activeClipUrl=`url(#${g})`,this.tgrp=null}clip(p){this.pendingClip=p}closePath(){const p=this.current;if(p.path){const g=`${p.path.getAttributeNS(null,"d")}Z`;p.path.setAttributeNS(null,"d",g)}}setLeading(p){this.current.leading=-p}setTextRise(p){this.current.textRise=p}setTextRenderingMode(p){this.current.textRenderingMode=p}setHScale(p){this.current.textHScale=p/100}setRenderingIntent(p){}setFlatness(p){}setGState(p){for(const[g,M]of p)switch(g){case"LW":this.setLineWidth(M);break;case"LC":this.setLineCap(M);break;case"LJ":this.setLineJoin(M);break;case"ML":this.setMiterLimit(M);break;case"D":this.setDash(M[0],M[1]);break;case"RI":this.setRenderingIntent(M);break;case"FL":this.setFlatness(M);break;case"Font":this.setFont(M);break;case"CA":this.setStrokeAlpha(M);break;case"ca":this.setFillAlpha(M);break;default:(0,f.warn)(`Unimplemented graphic state operator ${g}`);break}}fill(){const p=this.current;p.element&&(p.element.setAttributeNS(null,"fill",p.fillColor),p.element.setAttributeNS(null,"fill-opacity",p.fillAlpha),this.endPath())}stroke(){const p=this.current;p.element&&(this._setStrokeAttributes(p.element),p.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(p,g=1){const M=this.current;let O=M.dashArray;g!==1&&O.length>0&&(O=O.map(function(_){return g*_})),p.setAttributeNS(null,"stroke",M.strokeColor),p.setAttributeNS(null,"stroke-opacity",M.strokeAlpha),p.setAttributeNS(null,"stroke-miterlimit",e(M.miterLimit)),p.setAttributeNS(null,"stroke-linecap",M.lineCap),p.setAttributeNS(null,"stroke-linejoin",M.lineJoin),p.setAttributeNS(null,"stroke-width",e(g*M.lineWidth)+"px"),p.setAttributeNS(null,"stroke-dasharray",O.map(e).join(" ")),p.setAttributeNS(null,"stroke-dashoffset",e(g*M.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x","0"),p.setAttributeNS(null,"y","0"),p.setAttributeNS(null,"width","1px"),p.setAttributeNS(null,"height","1px"),p.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(p)}paintImageXObject(p){const g=this.getObject(p);if(!g){(0,f.warn)(`Dependent image with object ID ${p} is not ready yet`);return}this.paintInlineImageXObject(g)}paintInlineImageXObject(p,g){const M=p.width,O=p.height,_=s(p,this.forceDataSchema,!!g),H=this.svgFactory.createElement("svg:rect");H.setAttributeNS(null,"x","0"),H.setAttributeNS(null,"y","0"),H.setAttributeNS(null,"width",e(M)),H.setAttributeNS(null,"height",e(O)),this.current.element=H,this.clip("nonzero");const z=this.svgFactory.createElement("svg:image");z.setAttributeNS(T,"xlink:href",_),z.setAttributeNS(null,"x","0"),z.setAttributeNS(null,"y",e(-O)),z.setAttributeNS(null,"width",e(M)+"px"),z.setAttributeNS(null,"height",e(O)+"px"),z.setAttributeNS(null,"transform",`scale(${e(1/M)} ${e(-1/O)})`),g?g.append(z):this._ensureTransformGroup().append(z)}paintImageMaskXObject(p){const g=this.getObject(p.data,p);if(g.bitmap){(0,f.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const M=this.current,O=g.width,_=g.height,H=M.fillColor;M.maskId=`mask${r++}`;const z=this.svgFactory.createElement("svg:mask");z.setAttributeNS(null,"id",M.maskId);const st=this.svgFactory.createElement("svg:rect");st.setAttributeNS(null,"x","0"),st.setAttributeNS(null,"y","0"),st.setAttributeNS(null,"width",e(O)),st.setAttributeNS(null,"height",e(_)),st.setAttributeNS(null,"fill",H),st.setAttributeNS(null,"mask",`url(#${M.maskId})`),this.defs.append(z),this._ensureTransformGroup().append(st),this.paintInlineImageXObject(g,z)}paintFormXObjectBegin(p,g){if(Array.isArray(p)&&p.length===6&&this.transform(p[0],p[1],p[2],p[3],p[4],p[5]),g){const M=g[2]-g[0],O=g[3]-g[1],_=this.svgFactory.createElement("svg:rect");_.setAttributeNS(null,"x",g[0]),_.setAttributeNS(null,"y",g[1]),_.setAttributeNS(null,"width",e(M)),_.setAttributeNS(null,"height",e(O)),this.current.element=_,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(p){const g=this.svgFactory.create(p.width,p.height),M=this.svgFactory.createElement("svg:defs");g.append(M),this.defs=M;const O=this.svgFactory.createElement("svg:g");return O.setAttributeNS(null,"transform",d(p.transform)),g.append(O),this.svg=O,g}_ensureClipGroup(){if(!this.current.clipGroup){const p=this.svgFactory.createElement("svg:g");p.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(p),this.current.clipGroup=p}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",d(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}i.SVGGraphics=w}),((D,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.XfaText=void 0;class R{static textContent(f){const I=[],A={items:I,styles:Object.create(null)};function T(P){if(!P)return;let n=null;const t=P.name;if(t==="#text")n=P.value;else if(R.shouldBuildText(t))P?.attributes?.textContent?n=P.attributes.textContent:P.value&&(n=P.value);else return;if(n!==null&&I.push({str:n}),!!P.children)for(const s of P.children)T(s)}return T(f),A}static shouldBuildText(f){return!(f==="textarea"||f==="input"||f==="option"||f==="select")}}i.XfaText=R}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TextLayerRenderTask=void 0,i.renderTextLayer=d,i.updateTextLayer=m;var o=R(1),f=R(6);const I=1e5,A=30,T=.8,P=new Map;function n(r,b){let w;if(b&&o.FeatureTest.isOffscreenCanvasSupported)w=new OffscreenCanvas(r,r).getContext("2d",{alpha:!1});else{const j=document.createElement("canvas");j.width=j.height=r,w=j.getContext("2d",{alpha:!1})}return w}function t(r,b){const w=P.get(r);if(w)return w;const j=n(A,b);j.font=`${A}px ${r}`;const p=j.measureText("");let g=p.fontBoundingBoxAscent,M=Math.abs(p.fontBoundingBoxDescent);if(g){const _=g/(g+M);return P.set(r,_),j.canvas.width=j.canvas.height=0,_}j.strokeStyle="red",j.clearRect(0,0,A,A),j.strokeText("g",0,0);let O=j.getImageData(0,0,A,A).data;M=0;for(let _=O.length-1-3;_>=0;_-=4)if(O[_]>0){M=Math.ceil(_/4/A);break}j.clearRect(0,0,A,A),j.strokeText("A",0,A),O=j.getImageData(0,0,A,A).data,g=0;for(let _=0,H=O.length;_<H;_+=4)if(O[_]>0){g=A-Math.floor(_/4/A);break}if(j.canvas.width=j.canvas.height=0,g){const _=g/(g+M);return P.set(r,_),_}return P.set(r,T),T}function s(r,b,w){const j=document.createElement("span"),p={angle:0,canvasWidth:0,hasText:b.str!=="",hasEOL:b.hasEOL,fontSize:0};r._textDivs.push(j);const g=o.Util.transform(r._transform,b.transform);let M=Math.atan2(g[1],g[0]);const O=w[b.fontName];O.vertical&&(M+=Math.PI/2);const _=Math.hypot(g[2],g[3]),H=_*t(O.fontFamily,r._isOffscreenCanvasSupported);let z,st;M===0?(z=g[4],st=g[5]-H):(z=g[4]+H*Math.sin(M),st=g[5]-H*Math.cos(M));const et="calc(var(--scale-factor)*",K=j.style;r._container===r._rootContainer?(K.left=`${(100*z/r._pageWidth).toFixed(2)}%`,K.top=`${(100*st/r._pageHeight).toFixed(2)}%`):(K.left=`${et}${z.toFixed(2)}px)`,K.top=`${et}${st.toFixed(2)}px)`),K.fontSize=`${et}${_.toFixed(2)}px)`,K.fontFamily=O.fontFamily,p.fontSize=_,j.setAttribute("role","presentation"),j.textContent=b.str,j.dir=b.dir,r._fontInspectorEnabled&&(j.dataset.fontName=b.fontName),M!==0&&(p.angle=M*(180/Math.PI));let nt=!1;if(b.str.length>1)nt=!0;else if(b.str!==" "&&b.transform[0]!==b.transform[3]){const J=Math.abs(b.transform[0]),L=Math.abs(b.transform[3]);J!==L&&Math.max(J,L)/Math.min(J,L)>1.5&&(nt=!0)}nt&&(p.canvasWidth=O.vertical?b.height:b.width),r._textDivProperties.set(j,p),r._isReadableStream&&r._layoutText(j)}function a(r){const{div:b,scale:w,properties:j,ctx:p,prevFontSize:g,prevFontFamily:M}=r,{style:O}=b;let _="";if(j.canvasWidth!==0&&j.hasText){const{fontFamily:H}=O,{canvasWidth:z,fontSize:st}=j;(g!==st||M!==H)&&(p.font=`${st*w}px ${H}`,r.prevFontSize=st,r.prevFontFamily=H);const{width:et}=p.measureText(b.textContent);et>0&&(_=`scaleX(${z*w/et})`)}j.angle!==0&&(_=`rotate(${j.angle}deg) ${_}`),_.length>0&&(O.transform=_)}function c(r){if(r._canceled)return;const b=r._textDivs,w=r._capability;if(b.length>I){w.resolve();return}if(!r._isReadableStream)for(const p of b)r._layoutText(p);w.resolve()}class e{constructor({textContentSource:b,container:w,viewport:j,textDivs:p,textDivProperties:g,textContentItemsStr:M,isOffscreenCanvasSupported:O}){this._textContentSource=b,this._isReadableStream=b instanceof ReadableStream,this._container=this._rootContainer=w,this._textDivs=p||[],this._textContentItemsStr=M||[],this._isOffscreenCanvasSupported=O,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=g||new WeakMap,this._canceled=!1,this._capability=new o.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:j.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:n(0,O)};const{pageWidth:_,pageHeight:H,pageX:z,pageY:st}=j.rawDims;this._transform=[1,0,0,-1,-z,st+H],this._pageWidth=_,this._pageHeight=H,(0,f.setLayerDimensions)(w,j),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new o.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new o.AbortException("TextLayer task cancelled."))}_processItems(b,w){for(const j of b){if(j.str===void 0){if(j.type==="beginMarkedContentProps"||j.type==="beginMarkedContent"){const p=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),j.id!==null&&this._container.setAttribute("id",`${j.id}`),p.append(this._container)}else j.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(j.str),s(this,j,w)}}_layoutText(b){const w=this._layoutTextParams.properties=this._textDivProperties.get(b);if(this._layoutTextParams.div=b,a(this._layoutTextParams),w.hasText&&this._container.append(b),w.hasEOL){const j=document.createElement("br");j.setAttribute("role","presentation"),this._container.append(j)}}_render(){const b=new o.PromiseCapability;let w=Object.create(null);if(this._isReadableStream){const j=()=>{this._reader.read().then(({value:p,done:g})=>{if(g){b.resolve();return}Object.assign(w,p.styles),this._processItems(p.items,w),j()},b.reject)};this._reader=this._textContentSource.getReader(),j()}else if(this._textContentSource){const{items:j,styles:p}=this._textContentSource;this._processItems(j,p),b.resolve()}else throw new Error('No "textContentSource" parameter specified.');b.promise.then(()=>{w=null,c(this)},this._capability.reject)}}i.TextLayerRenderTask=e;function d(r){!r.textContentSource&&(r.textContent||r.textContentStream)&&((0,f.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),r.textContentSource=r.textContent||r.textContentStream);const{container:b,viewport:w}=r,j=getComputedStyle(b),p=j.getPropertyValue("visibility"),g=parseFloat(j.getPropertyValue("--scale-factor"));p==="visible"&&(!g||Math.abs(g-w.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const M=new e(r);return M._render(),M}function m({container:r,viewport:b,textDivs:w,textDivProperties:j,isOffscreenCanvasSupported:p,mustRotate:g=!0,mustRescale:M=!0}){if(g&&(0,f.setLayerDimensions)(r,{rotation:b.rotation}),M){const O=n(0,p),H={prevFontSize:null,prevFontFamily:null,div:null,scale:b.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:O};for(const z of w)H.properties=j.get(z),H.div=z,a(H)}}}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AnnotationEditorLayer=void 0;var o=R(1),f=R(4),I=R(28),A=R(33),T=R(6),P=R(34);class n{#t;#e=!1;#s=null;#n=this.pointerup.bind(this);#o=this.pointerdown.bind(this);#a=new Map;#r=!1;#l=!1;#c=!1;#i;static _initialized=!1;constructor({uiManager:s,pageIndex:a,div:c,accessibilityManager:e,annotationLayer:d,viewport:m,l10n:r}){const b=[I.FreeTextEditor,A.InkEditor,P.StampEditor];if(!n._initialized){n._initialized=!0;for(const w of b)w.initialize(r)}s.registerEditorTypes(b),this.#i=s,this.pageIndex=a,this.div=c,this.#t=e,this.#s=d,this.viewport=m,this.#i.addLayer(this)}get isEmpty(){return this.#a.size===0}updateToolbar(s){this.#i.updateToolbar(s)}updateMode(s=this.#i.getMode()){this.#m(),s===o.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),s!==o.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",s===o.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",s===o.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",s===o.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(s){if(!s&&this.#i.getMode()!==o.AnnotationEditorType.INK)return;if(!s){for(const c of this.#a.values())if(c.isEmpty()){c.setInBackground();return}}this.#h({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(s){this.#i.setEditingState(s)}addCommands(s){this.#i.addCommands(s)}enable(){this.div.style.pointerEvents="auto";const s=new Set;for(const c of this.#a.values())c.enableEditing(),c.annotationElementId&&s.add(c.annotationElementId);if(!this.#s)return;const a=this.#s.getEditableAnnotations();for(const c of a){if(c.hide(),this.#i.isDeletedAnnotationElement(c.data.id)||s.has(c.data.id))continue;const e=this.deserialize(c);e&&(this.addOrRebuild(e),e.enableEditing())}}disable(){this.#c=!0,this.div.style.pointerEvents="none";const s=new Set;for(const a of this.#a.values()){if(a.disableEditing(),!a.annotationElementId||a.serialize()!==null){s.add(a.annotationElementId);continue}this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}if(this.#s){const a=this.#s.getEditableAnnotations();for(const c of a){const{id:e}=c.data;s.has(e)||this.#i.isDeletedAnnotationElement(e)||c.show()}}this.#m(),this.isEmpty&&(this.div.hidden=!0),this.#c=!1}getEditableAnnotation(s){return this.#s?.getEditableAnnotation(s)||null}setActiveEditor(s){this.#i.getActive()!==s&&this.#i.setActiveEditor(s)}enableClick(){this.div.addEventListener("pointerdown",this.#o),this.div.addEventListener("pointerup",this.#n)}disableClick(){this.div.removeEventListener("pointerdown",this.#o),this.div.removeEventListener("pointerup",this.#n)}attach(s){this.#a.set(s.id,s);const{annotationElementId:a}=s;a&&this.#i.isDeletedAnnotationElement(a)&&this.#i.removeDeletedAnnotationElement(s)}detach(s){this.#a.delete(s.id),this.#t?.removePointerInTextLayer(s.contentDiv),!this.#c&&s.annotationElementId&&this.#i.addDeletedAnnotationElement(s)}remove(s){this.detach(s),this.#i.removeEditor(s),s.div.contains(document.activeElement)&&setTimeout(()=>{this.#i.focusMainContainer()},0),s.div.remove(),s.isAttachedToDOM=!1,this.#l||this.addInkEditorIfNeeded(!1)}changeParent(s){s.parent!==this&&(s.annotationElementId&&(this.#i.addDeletedAnnotationElement(s.annotationElementId),f.AnnotationEditor.deleteAnnotationElement(s),s.annotationElementId=null),this.attach(s),s.parent?.detach(s),s.setParent(this),s.div&&s.isAttachedToDOM&&(s.div.remove(),this.div.append(s.div)))}add(s){if(this.changeParent(s),this.#i.addEditor(s),this.attach(s),!s.isAttachedToDOM){const a=s.render();this.div.append(a),s.isAttachedToDOM=!0}s.fixAndSetPosition(),s.onceAdded(),this.#i.addToAnnotationStorage(s)}moveEditorInDOM(s){if(!s.isAttachedToDOM)return;const{activeElement:a}=document;s.div.contains(a)&&(s._focusEventsAllowed=!1,setTimeout(()=>{s.div.contains(document.activeElement)?s._focusEventsAllowed=!0:(s.div.addEventListener("focusin",()=>{s._focusEventsAllowed=!0},{once:!0}),a.focus())},0)),s._structTreeParentId=this.#t?.moveElementInDOM(this.div,s.div,s.contentDiv,!0)}addOrRebuild(s){s.needsToBeRebuilt()?s.rebuild():this.add(s)}addUndoableEditor(s){const a=()=>s._uiManager.rebuild(s),c=()=>{s.remove()};this.addCommands({cmd:a,undo:c,mustExec:!1})}getNextId(){return this.#i.getId()}#p(s){switch(this.#i.getMode()){case o.AnnotationEditorType.FREETEXT:return new I.FreeTextEditor(s);case o.AnnotationEditorType.INK:return new A.InkEditor(s);case o.AnnotationEditorType.STAMP:return new P.StampEditor(s)}return null}pasteEditor(s,a){this.#i.updateToolbar(s),this.#i.updateMode(s);const{offsetX:c,offsetY:e}=this.#u(),d=this.getNextId(),m=this.#p({parent:this,id:d,x:c,y:e,uiManager:this.#i,isCentered:!0,...a});m&&this.add(m)}deserialize(s){switch(s.annotationType??s.annotationEditorType){case o.AnnotationEditorType.FREETEXT:return I.FreeTextEditor.deserialize(s,this,this.#i);case o.AnnotationEditorType.INK:return A.InkEditor.deserialize(s,this,this.#i);case o.AnnotationEditorType.STAMP:return P.StampEditor.deserialize(s,this,this.#i)}return null}#h(s,a){const c=this.getNextId(),e=this.#p({parent:this,id:c,x:s.offsetX,y:s.offsetY,uiManager:this.#i,isCentered:a});return e&&this.add(e),e}#u(){const{x:s,y:a,width:c,height:e}=this.div.getBoundingClientRect(),d=Math.max(0,s),m=Math.max(0,a),r=Math.min(window.innerWidth,s+c),b=Math.min(window.innerHeight,a+e),w=(d+r)/2-s,j=(m+b)/2-a,[p,g]=this.viewport.rotation%180===0?[w,j]:[j,w];return{offsetX:p,offsetY:g}}addNewEditor(){this.#h(this.#u(),!0)}setSelected(s){this.#i.setSelected(s)}toggleSelected(s){this.#i.toggleSelected(s)}isSelected(s){return this.#i.isSelected(s)}unselect(s){this.#i.unselect(s)}pointerup(s){const{isMac:a}=o.FeatureTest.platform;if(!(s.button!==0||s.ctrlKey&&a)&&s.target===this.div&&this.#r){if(this.#r=!1,!this.#e){this.#e=!0;return}if(this.#i.getMode()===o.AnnotationEditorType.STAMP){this.#i.unselectAll();return}this.#h(s,!1)}}pointerdown(s){if(this.#r){this.#r=!1;return}const{isMac:a}=o.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&a||s.target!==this.div)return;this.#r=!0;const c=this.#i.getActive();this.#e=!c||c.isEmpty()}findNewParent(s,a,c){const e=this.#i.findParent(a,c);return e===null||e===this?!1:(e.changeParent(s),!0)}destroy(){this.#i.getActive()?.parent===this&&(this.#i.commitOrRemove(),this.#i.setActiveEditor(null));for(const s of this.#a.values())this.#t?.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,this.#a.clear(),this.#i.removeLayer(this)}#m(){this.#l=!0;for(const s of this.#a.values())s.isEmpty()&&s.remove();this.#l=!1}render({viewport:s}){this.viewport=s,(0,T.setLayerDimensions)(this.div,s);for(const a of this.#i.getEditors(this.pageIndex))this.add(a);this.updateMode()}update({viewport:s}){this.#i.commitOrRemove(),this.viewport=s,(0,T.setLayerDimensions)(this.div,{rotation:s.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:s,pageHeight:a}=this.viewport.rawDims;return[s,a]}}i.AnnotationEditorLayer=n}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FreeTextEditor=void 0;var o=R(1),f=R(5),I=R(4),A=R(29);class T extends I.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#s=this.editorDivInput.bind(this);#n=this.editorDivKeydown.bind(this);#o;#a="";#r=`${this.id}-editor`;#l;#c=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const n=T.prototype,t=c=>c.isEmpty(),s=f.AnnotationEditorUIManager.TRANSLATE_SMALL,a=f.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,o.shadow)(this,"_keyboardManager",new f.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],n.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],n.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],n._translateEmpty,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],n._translateEmpty,{args:[-a,0],checker:t}],[["ArrowRight","mac+ArrowRight"],n._translateEmpty,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],n._translateEmpty,{args:[a,0],checker:t}],[["ArrowUp","mac+ArrowUp"],n._translateEmpty,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],n._translateEmpty,{args:[0,-a],checker:t}],[["ArrowDown","mac+ArrowDown"],n._translateEmpty,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],n._translateEmpty,{args:[0,a],checker:t}]]))}static _type="freetext";constructor(n){super({...n,name:"freeTextEditor"}),this.#o=n.color||T._defaultColor||I.AnnotationEditor._defaultLineColor,this.#l=n.fontSize||T._defaultFontSize}static initialize(n){I.AnnotationEditor.initialize(n,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(n,t){switch(n){case o.AnnotationEditorParamsType.FREETEXT_SIZE:T._defaultFontSize=t;break;case o.AnnotationEditorParamsType.FREETEXT_COLOR:T._defaultColor=t;break}}updateParams(n,t){switch(n){case o.AnnotationEditorParamsType.FREETEXT_SIZE:this.#i(t);break;case o.AnnotationEditorParamsType.FREETEXT_COLOR:this.#p(t);break}}static get defaultPropertiesToUpdate(){return[[o.AnnotationEditorParamsType.FREETEXT_SIZE,T._defaultFontSize],[o.AnnotationEditorParamsType.FREETEXT_COLOR,T._defaultColor||I.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[o.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[o.AnnotationEditorParamsType.FREETEXT_COLOR,this.#o]]}#i(n){const t=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--scale-factor))`,this.translate(0,-(a-this.#l)*this.parentScale),this.#l=a,this.#u()},s=this.#l;this.addCommands({cmd:()=>{t(n)},undo:()=>{t(s)},mustExec:!0,type:o.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#p(n){const t=this.#o;this.addCommands({cmd:()=>{this.#o=this.editorDiv.style.color=n},undo:()=>{this.#o=this.editorDiv.style.color=t},mustExec:!0,type:o.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(n,t){this._uiManager.translateSelectedEditors(n,t,!0)}getInitialTranslation(){const n=this.parentScale;return[-T._internalPadding*n,-(T._internalPadding+this.#l)*n]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(o.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#n),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#s))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#r),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#n),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#s),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(n){this._focusEventsAllowed&&(super.focusin(n),n.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#x();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}#h(){const n=this.editorDiv.getElementsByTagName("div");if(n.length===0)return this.editorDiv.innerText;const t=[];for(const s of n)t.push(s.innerText.replace(/\r\n?|\n/,""));return t.join(`
`)}#u(){const[n,t]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:a,div:c}=this,e=c.style.display;c.style.display="hidden",a.div.append(this.div),s=c.getBoundingClientRect(),c.remove(),c.style.display=e}this.rotation%180===this.parentRotation%180?(this.width=s.width/n,this.height=s.height/t):(this.width=s.height/n,this.height=s.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const n=this.#a,t=this.#a=this.#h().trimEnd();if(n===t)return;const s=a=>{if(this.#a=a,!a){this.remove();return}this.#m(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{s(t)},undo:()=>{s(n)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(n){this.enterInEditMode()}keydown(n){n.target===this.div&&n.key==="Enter"&&(this.enterInEditMode(),n.preventDefault())}editorDivKeydown(n){T._keyboardManager.exec(this,n)}editorDivFocus(n){this.isEditing=!0}editorDivBlur(n){this.isEditing=!1}editorDivInput(n){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let n,t;this.width&&(n=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#r),this.enableEditing(),I.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(a=>this.editorDiv?.setAttribute("aria-label",a)),I.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(a=>this.editorDiv?.setAttribute("default-content",a)),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#l}px * var(--scale-factor))`,s.color=this.#o,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,f.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[a,c]=this.parentDimensions;if(this.annotationElementId){const{position:e}=this.#c;let[d,m]=this.getInitialTranslation();[d,m]=this.pageTranslationToScreen(d,m);const[r,b]=this.pageDimensions,[w,j]=this.pageTranslation;let p,g;switch(this.rotation){case 0:p=n+(e[0]-w)/r,g=t+this.height-(e[1]-j)/b;break;case 90:p=n+(e[0]-w)/r,g=t-(e[1]-j)/b,[d,m]=[m,-d];break;case 180:p=n-this.width+(e[0]-w)/r,g=t-(e[1]-j)/b,[d,m]=[-d,-m];break;case 270:p=n+(e[0]-w-this.height*b)/r,g=t+(e[1]-j-this.width*r)/b,[d,m]=[-m,d];break}this.setAt(p*a,g*c,d,m)}else this.setAt(n*a,t*c,this.width*a,this.height*c);this.#m(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#m(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const n of this.#a.split(`
`)){const t=document.createElement("div");t.append(n?document.createTextNode(n):document.createElement("br")),this.editorDiv.append(t)}}get contentDiv(){return this.editorDiv}static deserialize(n,t,s){let a=null;if(n instanceof A.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:e,fontColor:d},rect:m,rotation:r,id:b},textContent:w,textPosition:j,parent:{page:{pageNumber:p}}}=n;if(!w||w.length===0)return null;a=n={annotationType:o.AnnotationEditorType.FREETEXT,color:Array.from(d),fontSize:e,value:w.join(`
`),position:j,pageIndex:p-1,rect:m,rotation:r,id:b,deleted:!1}}const c=super.deserialize(n,t,s);return c.#l=n.fontSize,c.#o=o.Util.makeHexColor(...n.color),c.#a=n.value,c.annotationElementId=n.id||null,c.#c=a,c}serialize(n=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const t=T._internalPadding*this.parentScale,s=this.getRect(t,t),a=I.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#o),c={annotationType:o.AnnotationEditorType.FREETEXT,color:a,fontSize:this.#l,value:this.#a,pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return n?c:this.annotationElementId&&!this.#g(c)?null:(c.id=this.annotationElementId,c)}#g(n){const{value:t,fontSize:s,color:a,rect:c,pageIndex:e}=this.#c;return n.value!==t||n.fontSize!==s||n.rect.some((d,m)=>Math.abs(d-c[m])>=1)||n.color.some((d,m)=>d!==a[m])||n.pageIndex!==e}#x(n=!1){if(!this.annotationElementId)return;if(this.#u(),!n&&(this.width===0||this.height===0)){setTimeout(()=>this.#x(!0),0);return}const t=T._internalPadding*this.parentScale;this.#c.rect=this.getRect(t,t)}}i.FreeTextEditor=T}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.StampAnnotationElement=i.InkAnnotationElement=i.FreeTextAnnotationElement=i.AnnotationLayer=void 0;var o=R(1),f=R(6),I=R(3),A=R(30),T=R(31),P=R(32);const n=1e3,t=9,s=new WeakSet;function a(C){return{width:C[2]-C[0],height:C[3]-C[1]}}class c{static create(l){switch(l.data.annotationType){case o.AnnotationType.LINK:return new d(l);case o.AnnotationType.TEXT:return new m(l);case o.AnnotationType.WIDGET:switch(l.data.fieldType){case"Tx":return new b(l);case"Btn":return l.data.radioButton?new p(l):l.data.checkBox?new j(l):new g(l);case"Ch":return new M(l);case"Sig":return new w(l)}return new r(l);case o.AnnotationType.POPUP:return new O(l);case o.AnnotationType.FREETEXT:return new H(l);case o.AnnotationType.LINE:return new z(l);case o.AnnotationType.SQUARE:return new st(l);case o.AnnotationType.CIRCLE:return new et(l);case o.AnnotationType.POLYLINE:return new K(l);case o.AnnotationType.CARET:return new J(l);case o.AnnotationType.INK:return new L(l);case o.AnnotationType.POLYGON:return new nt(l);case o.AnnotationType.HIGHLIGHT:return new y(l);case o.AnnotationType.UNDERLINE:return new h(l);case o.AnnotationType.SQUIGGLY:return new u(l);case o.AnnotationType.STRIKEOUT:return new E(l);case o.AnnotationType.STAMP:return new k(l);case o.AnnotationType.FILEATTACHMENT:return new N(l);default:return new e(l)}}}class e{#t=!1;constructor(l,{isRenderable:x=!1,ignoreBorder:v=!1,createQuadrilaterals:S=!1}={}){this.isRenderable=x,this.data=l.data,this.layer=l.layer,this.linkService=l.linkService,this.downloadManager=l.downloadManager,this.imageResourcesPath=l.imageResourcesPath,this.renderForms=l.renderForms,this.svgFactory=l.svgFactory,this.annotationStorage=l.annotationStorage,this.enableScripting=l.enableScripting,this.hasJSActions=l.hasJSActions,this._fieldObjects=l.fieldObjects,this.parent=l.parent,x&&(this.container=this._createContainer(v)),S&&this._createQuadrilaterals()}static _hasPopupData({titleObj:l,contentsObj:x,richText:v}){return!!(l?.str||x?.str||v?.str)}get hasPopupData(){return e._hasPopupData(this.data)}_createContainer(l){const{data:x,parent:{page:v,viewport:S}}=this,F=document.createElement("section");F.setAttribute("data-annotation-id",x.id),this instanceof r||(F.tabIndex=n),F.style.zIndex=this.parent.zIndex++,this.data.popupRef&&F.setAttribute("aria-haspopup","dialog"),x.noRotate&&F.classList.add("norotate");const{pageWidth:U,pageHeight:W,pageX:G,pageY:at}=S.rawDims;if(!x.rect||this instanceof O){const{rotation:it}=x;return!x.hasOwnCanvas&&it!==0&&this.setRotation(it,F),F}const{width:$,height:Q}=a(x.rect),tt=o.Util.normalizeRect([x.rect[0],v.view[3]-x.rect[1]+v.view[1],x.rect[2],v.view[3]-x.rect[3]+v.view[1]]);if(!l&&x.borderStyle.width>0){F.style.borderWidth=`${x.borderStyle.width}px`;const it=x.borderStyle.horizontalCornerRadius,ot=x.borderStyle.verticalCornerRadius;if(it>0||ot>0){const ht=`calc(${it}px * var(--scale-factor)) / calc(${ot}px * var(--scale-factor))`;F.style.borderRadius=ht}else if(this instanceof p){const ht=`calc(${$}px * var(--scale-factor)) / calc(${Q}px * var(--scale-factor))`;F.style.borderRadius=ht}switch(x.borderStyle.style){case o.AnnotationBorderStyleType.SOLID:F.style.borderStyle="solid";break;case o.AnnotationBorderStyleType.DASHED:F.style.borderStyle="dashed";break;case o.AnnotationBorderStyleType.BEVELED:(0,o.warn)("Unimplemented border style: beveled");break;case o.AnnotationBorderStyleType.INSET:(0,o.warn)("Unimplemented border style: inset");break;case o.AnnotationBorderStyleType.UNDERLINE:F.style.borderBottomStyle="solid";break}const ct=x.borderColor||null;ct?(this.#t=!0,F.style.borderColor=o.Util.makeHexColor(ct[0]|0,ct[1]|0,ct[2]|0)):F.style.borderWidth=0}F.style.left=`${100*(tt[0]-G)/U}%`,F.style.top=`${100*(tt[1]-at)/W}%`;const{rotation:Z}=x;return x.hasOwnCanvas||Z===0?(F.style.width=`${100*$/U}%`,F.style.height=`${100*Q/W}%`):this.setRotation(Z,F),F}setRotation(l,x=this.container){if(!this.data.rect)return;const{pageWidth:v,pageHeight:S}=this.parent.viewport.rawDims,{width:F,height:U}=a(this.data.rect);let W,G;l%180===0?(W=100*F/v,G=100*U/S):(W=100*U/v,G=100*F/S),x.style.width=`${W}%`,x.style.height=`${G}%`,x.setAttribute("data-main-rotation",(360-l)%360)}get _commonActions(){const l=(x,v,S)=>{const F=S.detail[x],U=F[0],W=F.slice(1);S.target.style[v]=A.ColorConverters[`${U}_HTML`](W),this.annotationStorage.setValue(this.data.id,{[v]:A.ColorConverters[`${U}_rgb`](W)})};return(0,o.shadow)(this,"_commonActions",{display:x=>{const{display:v}=x.detail,S=v%2===1;this.container.style.visibility=S?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:S,noPrint:v===1||v===2})},print:x=>{this.annotationStorage.setValue(this.data.id,{noPrint:!x.detail.print})},hidden:x=>{const{hidden:v}=x.detail;this.container.style.visibility=v?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:v,noView:v})},focus:x=>{setTimeout(()=>x.target.focus({preventScroll:!1}),0)},userName:x=>{x.target.title=x.detail.userName},readonly:x=>{x.target.disabled=x.detail.readonly},required:x=>{this._setRequired(x.target,x.detail.required)},bgColor:x=>{l("bgColor","backgroundColor",x)},fillColor:x=>{l("fillColor","backgroundColor",x)},fgColor:x=>{l("fgColor","color",x)},textColor:x=>{l("textColor","color",x)},borderColor:x=>{l("borderColor","borderColor",x)},strokeColor:x=>{l("strokeColor","borderColor",x)},rotation:x=>{const v=x.detail.rotation;this.setRotation(v),this.annotationStorage.setValue(this.data.id,{rotation:v})}})}_dispatchEventFromSandbox(l,x){const v=this._commonActions;for(const S of Object.keys(x.detail))(l[S]||v[S])?.(x)}_setDefaultPropertiesFromJS(l){if(!this.enableScripting)return;const x=this.annotationStorage.getRawValue(this.data.id);if(!x)return;const v=this._commonActions;for(const[S,F]of Object.entries(x)){const U=v[S];if(U){const W={detail:{[S]:F},target:l};U(W),delete x[S]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:l}=this.data;if(!l)return;const[x,v,S,F]=this.data.rect;if(l.length===1){const[,{x:ot,y:ct},{x:ht,y:ut}]=l[0];if(S===ot&&F===ct&&x===ht&&v===ut)return}const{style:U}=this.container;let W;if(this.#t){const{borderColor:ot,borderWidth:ct}=U;U.borderWidth=0,W=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ot}" stroke-width="${ct}">`],this.container.classList.add("hasBorder")}const G=S-x,at=F-v,{svgFactory:$}=this,Q=$.createElement("svg");Q.classList.add("quadrilateralsContainer"),Q.setAttribute("width",0),Q.setAttribute("height",0);const tt=$.createElement("defs");Q.append(tt);const Z=$.createElement("clipPath"),it=`clippath_${this.data.id}`;Z.setAttribute("id",it),Z.setAttribute("clipPathUnits","objectBoundingBox"),tt.append(Z);for(const[,{x:ot,y:ct},{x:ht,y:ut}]of l){const mt=$.createElement("rect"),xt=(ht-x)/G,yt=(F-ct)/at,vt=(ot-ht)/G,Y=(ct-ut)/at;mt.setAttribute("x",xt),mt.setAttribute("y",yt),mt.setAttribute("width",vt),mt.setAttribute("height",Y),Z.append(mt),W?.push(`<rect vector-effect="non-scaling-stroke" x="${xt}" y="${yt}" width="${vt}" height="${Y}"/>`)}this.#t&&(W.push("</g></svg>')"),U.backgroundImage=W.join("")),this.container.append(Q),this.container.style.clipPath=`url(#${it})`}_createPopup(){const{container:l,data:x}=this;l.setAttribute("aria-haspopup","dialog");const v=new O({data:{color:x.color,titleObj:x.titleObj,modificationDate:x.modificationDate,contentsObj:x.contentsObj,richText:x.richText,parentRect:x.rect,borderStyle:0,id:`popup_${x.id}`,rotation:x.rotation},parent:this.parent,elements:[this]});this.parent.div.append(v.render())}render(){(0,o.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(l,x=null){const v=[];if(this._fieldObjects){const S=this._fieldObjects[l];if(S)for(const{page:F,id:U,exportValues:W}of S){if(F===-1||U===x)continue;const G=typeof W=="string"?W:null,at=document.querySelector(`[data-element-id="${U}"]`);if(at&&!s.has(at)){(0,o.warn)(`_getElementsByName - element not allowed: ${U}`);continue}v.push({id:U,exportValue:G,domElement:at})}return v}for(const S of document.getElementsByName(l)){const{exportValue:F}=S,U=S.getAttribute("data-element-id");U!==x&&s.has(S)&&v.push({id:U,exportValue:F,domElement:S})}return v}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const l=this.getElementsToTriggerPopup();if(Array.isArray(l))for(const x of l)x.classList.add("highlightArea");else l.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:l,data:{id:x}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:l,editId:x})})}}class d extends e{constructor(l,x=null){super(l,{isRenderable:!0,ignoreBorder:!!x?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=l.data.isTooltipOnly}render(){const{data:l,linkService:x}=this,v=document.createElement("a");v.setAttribute("data-element-id",l.id);let S=!1;return l.url?(x.addLinkAttributes(v,l.url,l.newWindow),S=!0):l.action?(this._bindNamedAction(v,l.action),S=!0):l.attachment?(this._bindAttachment(v,l.attachment),S=!0):l.setOCGState?(this.#e(v,l.setOCGState),S=!0):l.dest?(this._bindLink(v,l.dest),S=!0):(l.actions&&(l.actions.Action||l.actions["Mouse Up"]||l.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(v,l),S=!0),l.resetForm?(this._bindResetFormAction(v,l.resetForm),S=!0):this.isTooltipOnly&&!S&&(this._bindLink(v,""),S=!0)),this.container.classList.add("linkAnnotation"),S&&this.container.append(v),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(l,x){l.href=this.linkService.getDestinationHash(x),l.onclick=()=>(x&&this.linkService.goToDestination(x),!1),(x||x==="")&&this.#t()}_bindNamedAction(l,x){l.href=this.linkService.getAnchorUrl(""),l.onclick=()=>(this.linkService.executeNamedAction(x),!1),this.#t()}_bindAttachment(l,x){l.href=this.linkService.getAnchorUrl(""),l.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,x.content,x.filename),!1),this.#t()}#e(l,x){l.href=this.linkService.getAnchorUrl(""),l.onclick=()=>(this.linkService.executeSetOCGState(x),!1),this.#t()}_bindJSAction(l,x){l.href=this.linkService.getAnchorUrl("");const v=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const S of Object.keys(x.actions)){const F=v.get(S);F&&(l[F]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:x.id,name:S}}),!1))}l.onclick||(l.onclick=()=>!1),this.#t()}_bindResetFormAction(l,x){const v=l.onclick;if(v||(l.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,o.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),v||(l.onclick=()=>!1);return}l.onclick=()=>{v?.();const{fields:S,refs:F,include:U}=x,W=[];if(S.length!==0||F.length!==0){const $=new Set(F);for(const Q of S){const tt=this._fieldObjects[Q]||[];for(const{id:Z}of tt)$.add(Z)}for(const Q of Object.values(this._fieldObjects))for(const tt of Q)$.has(tt.id)===U&&W.push(tt)}else for(const $ of Object.values(this._fieldObjects))W.push(...$);const G=this.annotationStorage,at=[];for(const $ of W){const{id:Q}=$;switch(at.push(Q),$.type){case"text":{const Z=$.defaultValue||"";G.setValue(Q,{value:Z});break}case"checkbox":case"radiobutton":{const Z=$.defaultValue===$.exportValues;G.setValue(Q,{value:Z});break}case"combobox":case"listbox":{const Z=$.defaultValue||"";G.setValue(Q,{value:Z});break}default:continue}const tt=document.querySelector(`[data-element-id="${Q}"]`);if(tt){if(!s.has(tt)){(0,o.warn)(`_bindResetFormAction - element not allowed: ${Q}`);continue}}else continue;tt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:at,name:"ResetForm"}}),!1}}}class m extends e{constructor(l){super(l,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const l=document.createElement("img");return l.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",l.alt="[{{type}} Annotation]",l.dataset.l10nId="text_annotation_type",l.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(l),this.container}}class r extends e{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(l){this.data.hasOwnCanvas&&(l.previousSibling?.nodeName==="CANVAS"&&(l.previousSibling.hidden=!0),l.hidden=!1)}_getKeyModifier(l){const{isWin:x,isMac:v}=o.FeatureTest.platform;return x&&l.ctrlKey||v&&l.metaKey}_setEventListener(l,x,v,S,F){v.includes("mouse")?l.addEventListener(v,U=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:S,value:F(U),shift:U.shiftKey,modifier:this._getKeyModifier(U)}})}):l.addEventListener(v,U=>{if(v==="blur"){if(!x.focused||!U.relatedTarget)return;x.focused=!1}else if(v==="focus"){if(x.focused)return;x.focused=!0}F&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:S,value:F(U)}})})}_setEventListeners(l,x,v,S){for(const[F,U]of v)(U==="Action"||this.data.actions?.[U])&&((U==="Focus"||U==="Blur")&&(x||={focused:!1}),this._setEventListener(l,x,F,U,S),U==="Focus"&&!this.data.actions?.Blur?this._setEventListener(l,x,"blur","Blur",null):U==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(l,x,"focus","Focus",null))}_setBackgroundColor(l){const x=this.data.backgroundColor||null;l.style.backgroundColor=x===null?"transparent":o.Util.makeHexColor(x[0],x[1],x[2])}_setTextStyle(l){const x=["left","center","right"],{fontColor:v}=this.data.defaultAppearanceData,S=this.data.defaultAppearanceData.fontSize||t,F=l.style;let U;const W=2,G=at=>Math.round(10*at)/10;if(this.data.multiLine){const at=Math.abs(this.data.rect[3]-this.data.rect[1]-W),$=Math.round(at/(o.LINE_FACTOR*S))||1,Q=at/$;U=Math.min(S,G(Q/o.LINE_FACTOR))}else{const at=Math.abs(this.data.rect[3]-this.data.rect[1]-W);U=Math.min(S,G(at/o.LINE_FACTOR))}F.fontSize=`calc(${U}px * var(--scale-factor))`,F.color=o.Util.makeHexColor(v[0],v[1],v[2]),this.data.textAlignment!==null&&(F.textAlign=x[this.data.textAlignment])}_setRequired(l,x){x?l.setAttribute("required",!0):l.removeAttribute("required"),l.setAttribute("aria-required",x)}}class b extends r{constructor(l){const x=l.renderForms||!l.data.hasAppearance&&!!l.data.fieldValue;super(l,{isRenderable:x})}setPropertyOnSiblings(l,x,v,S){const F=this.annotationStorage;for(const U of this._getElementsByName(l.name,l.id))U.domElement&&(U.domElement[x]=v),F.setValue(U.id,{[S]:v})}render(){const l=this.annotationStorage,x=this.data.id;this.container.classList.add("textWidgetAnnotation");let v=null;if(this.renderForms){const S=l.getValue(x,{value:this.data.fieldValue});let F=S.value||"";const U=l.getValue(x,{charLimit:this.data.maxLen}).charLimit;U&&F.length>U&&(F=F.slice(0,U));let W=S.formattedValue||this.data.textContent?.join(`
`)||null;W&&this.data.comb&&(W=W.replaceAll(/\s+/g,""));const G={userValue:F,formattedValue:W,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(v=document.createElement("textarea"),v.textContent=W??F,this.data.doNotScroll&&(v.style.overflowY="hidden")):(v=document.createElement("input"),v.type="text",v.setAttribute("value",W??F),this.data.doNotScroll&&(v.style.overflowX="hidden")),this.data.hasOwnCanvas&&(v.hidden=!0),s.add(v),v.setAttribute("data-element-id",x),v.disabled=this.data.readOnly,v.name=this.data.fieldName,v.tabIndex=n,this._setRequired(v,this.data.required),U&&(v.maxLength=U),v.addEventListener("input",$=>{l.setValue(x,{value:$.target.value}),this.setPropertyOnSiblings(v,"value",$.target.value,"value"),G.formattedValue=null}),v.addEventListener("resetform",$=>{const Q=this.data.defaultFieldValue??"";v.value=G.userValue=Q,G.formattedValue=null});let at=$=>{const{formattedValue:Q}=G;Q!=null&&($.target.value=Q),$.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){v.addEventListener("focus",Q=>{if(G.focused)return;const{target:tt}=Q;G.userValue&&(tt.value=G.userValue),G.lastCommittedValue=tt.value,G.commitKey=1,G.focused=!0}),v.addEventListener("updatefromsandbox",Q=>{this.showElementAndHideCanvas(Q.target);const tt={value(Z){G.userValue=Z.detail.value??"",l.setValue(x,{value:G.userValue.toString()}),Z.target.value=G.userValue},formattedValue(Z){const{formattedValue:it}=Z.detail;G.formattedValue=it,it!=null&&Z.target!==document.activeElement&&(Z.target.value=it),l.setValue(x,{formattedValue:it})},selRange(Z){Z.target.setSelectionRange(...Z.detail.selRange)},charLimit:Z=>{const{charLimit:it}=Z.detail,{target:ot}=Z;if(it===0){ot.removeAttribute("maxLength");return}ot.setAttribute("maxLength",it);let ct=G.userValue;!ct||ct.length<=it||(ct=ct.slice(0,it),ot.value=G.userValue=ct,l.setValue(x,{value:ct}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:x,name:"Keystroke",value:ct,willCommit:!0,commitKey:1,selStart:ot.selectionStart,selEnd:ot.selectionEnd}}))}};this._dispatchEventFromSandbox(tt,Q)}),v.addEventListener("keydown",Q=>{G.commitKey=1;let tt=-1;if(Q.key==="Escape"?tt=0:Q.key==="Enter"&&!this.data.multiLine?tt=2:Q.key==="Tab"&&(G.commitKey=3),tt===-1)return;const{value:Z}=Q.target;G.lastCommittedValue!==Z&&(G.lastCommittedValue=Z,G.userValue=Z,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:x,name:"Keystroke",value:Z,willCommit:!0,commitKey:tt,selStart:Q.target.selectionStart,selEnd:Q.target.selectionEnd}}))});const $=at;at=null,v.addEventListener("blur",Q=>{if(!G.focused||!Q.relatedTarget)return;G.focused=!1;const{value:tt}=Q.target;G.userValue=tt,G.lastCommittedValue!==tt&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:x,name:"Keystroke",value:tt,willCommit:!0,commitKey:G.commitKey,selStart:Q.target.selectionStart,selEnd:Q.target.selectionEnd}}),$(Q)}),this.data.actions?.Keystroke&&v.addEventListener("beforeinput",Q=>{G.lastCommittedValue=null;const{data:tt,target:Z}=Q,{value:it,selectionStart:ot,selectionEnd:ct}=Z;let ht=ot,ut=ct;switch(Q.inputType){case"deleteWordBackward":{const mt=it.substring(0,ot).match(/\w*[^\w]*$/);mt&&(ht-=mt[0].length);break}case"deleteWordForward":{const mt=it.substring(ot).match(/^[^\w]*\w*/);mt&&(ut+=mt[0].length);break}case"deleteContentBackward":ot===ct&&(ht-=1);break;case"deleteContentForward":ot===ct&&(ut+=1);break}Q.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:x,name:"Keystroke",value:it,change:tt||"",willCommit:!1,selStart:ht,selEnd:ut}})}),this._setEventListeners(v,G,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Q=>Q.target.value)}if(at&&v.addEventListener("blur",at),this.data.comb){const Q=(this.data.rect[2]-this.data.rect[0])/U;v.classList.add("comb"),v.style.letterSpacing=`calc(${Q}px * var(--scale-factor) - 1ch)`}}else v=document.createElement("div"),v.textContent=this.data.fieldValue,v.style.verticalAlign="middle",v.style.display="table-cell";return this._setTextStyle(v),this._setBackgroundColor(v),this._setDefaultPropertiesFromJS(v),this.container.append(v),this.container}}class w extends r{constructor(l){super(l,{isRenderable:!!l.data.hasOwnCanvas})}}class j extends r{constructor(l){super(l,{isRenderable:l.renderForms})}render(){const l=this.annotationStorage,x=this.data,v=x.id;let S=l.getValue(v,{value:x.exportValue===x.fieldValue}).value;typeof S=="string"&&(S=S!=="Off",l.setValue(v,{value:S})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const F=document.createElement("input");return s.add(F),F.setAttribute("data-element-id",v),F.disabled=x.readOnly,this._setRequired(F,this.data.required),F.type="checkbox",F.name=x.fieldName,S&&F.setAttribute("checked",!0),F.setAttribute("exportValue",x.exportValue),F.tabIndex=n,F.addEventListener("change",U=>{const{name:W,checked:G}=U.target;for(const at of this._getElementsByName(W,v)){const $=G&&at.exportValue===x.exportValue;at.domElement&&(at.domElement.checked=$),l.setValue(at.id,{value:$})}l.setValue(v,{value:G})}),F.addEventListener("resetform",U=>{const W=x.defaultFieldValue||"Off";U.target.checked=W===x.exportValue}),this.enableScripting&&this.hasJSActions&&(F.addEventListener("updatefromsandbox",U=>{const W={value(G){G.target.checked=G.detail.value!=="Off",l.setValue(v,{value:G.target.checked})}};this._dispatchEventFromSandbox(W,U)}),this._setEventListeners(F,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],U=>U.target.checked)),this._setBackgroundColor(F),this._setDefaultPropertiesFromJS(F),this.container.append(F),this.container}}class p extends r{constructor(l){super(l,{isRenderable:l.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const l=this.annotationStorage,x=this.data,v=x.id;let S=l.getValue(v,{value:x.fieldValue===x.buttonValue}).value;typeof S=="string"&&(S=S!==x.buttonValue,l.setValue(v,{value:S}));const F=document.createElement("input");if(s.add(F),F.setAttribute("data-element-id",v),F.disabled=x.readOnly,this._setRequired(F,this.data.required),F.type="radio",F.name=x.fieldName,S&&F.setAttribute("checked",!0),F.tabIndex=n,F.addEventListener("change",U=>{const{name:W,checked:G}=U.target;for(const at of this._getElementsByName(W,v))l.setValue(at.id,{value:!1});l.setValue(v,{value:G})}),F.addEventListener("resetform",U=>{const W=x.defaultFieldValue;U.target.checked=W!=null&&W===x.buttonValue}),this.enableScripting&&this.hasJSActions){const U=x.buttonValue;F.addEventListener("updatefromsandbox",W=>{const G={value:at=>{const $=U===at.detail.value;for(const Q of this._getElementsByName(at.target.name)){const tt=$&&Q.id===v;Q.domElement&&(Q.domElement.checked=tt),l.setValue(Q.id,{value:tt})}}};this._dispatchEventFromSandbox(G,W)}),this._setEventListeners(F,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],W=>W.target.checked)}return this._setBackgroundColor(F),this._setDefaultPropertiesFromJS(F),this.container.append(F),this.container}}class g extends d{constructor(l){super(l,{ignoreBorder:l.data.hasAppearance})}render(){const l=super.render();l.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(l.title=this.data.alternativeText);const x=l.lastChild;return this.enableScripting&&this.hasJSActions&&x&&(this._setDefaultPropertiesFromJS(x),x.addEventListener("updatefromsandbox",v=>{this._dispatchEventFromSandbox({},v)})),l}}class M extends r{constructor(l){super(l,{isRenderable:l.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const l=this.annotationStorage,x=this.data.id,v=l.getValue(x,{value:this.data.fieldValue}),S=document.createElement("select");s.add(S),S.setAttribute("data-element-id",x),S.disabled=this.data.readOnly,this._setRequired(S,this.data.required),S.name=this.data.fieldName,S.tabIndex=n;let F=this.data.combo&&this.data.options.length>0;this.data.combo||(S.size=this.data.options.length,this.data.multiSelect&&(S.multiple=!0)),S.addEventListener("resetform",$=>{const Q=this.data.defaultFieldValue;for(const tt of S.options)tt.selected=tt.value===Q});for(const $ of this.data.options){const Q=document.createElement("option");Q.textContent=$.displayValue,Q.value=$.exportValue,v.value.includes($.exportValue)&&(Q.setAttribute("selected",!0),F=!1),S.append(Q)}let U=null;if(F){const $=document.createElement("option");$.value=" ",$.setAttribute("hidden",!0),$.setAttribute("selected",!0),S.prepend($),U=()=>{$.remove(),S.removeEventListener("input",U),U=null},S.addEventListener("input",U)}const W=$=>{const Q=$?"value":"textContent",{options:tt,multiple:Z}=S;return Z?Array.prototype.filter.call(tt,it=>it.selected).map(it=>it[Q]):tt.selectedIndex===-1?null:tt[tt.selectedIndex][Q]};let G=W(!1);const at=$=>{const Q=$.target.options;return Array.prototype.map.call(Q,tt=>({displayValue:tt.textContent,exportValue:tt.value}))};return this.enableScripting&&this.hasJSActions?(S.addEventListener("updatefromsandbox",$=>{const Q={value(tt){U?.();const Z=tt.detail.value,it=new Set(Array.isArray(Z)?Z:[Z]);for(const ot of S.options)ot.selected=it.has(ot.value);l.setValue(x,{value:W(!0)}),G=W(!1)},multipleSelection(tt){S.multiple=!0},remove(tt){const Z=S.options,it=tt.detail.remove;Z[it].selected=!1,S.remove(it),Z.length>0&&Array.prototype.findIndex.call(Z,ct=>ct.selected)===-1&&(Z[0].selected=!0),l.setValue(x,{value:W(!0),items:at(tt)}),G=W(!1)},clear(tt){for(;S.length!==0;)S.remove(0);l.setValue(x,{value:null,items:[]}),G=W(!1)},insert(tt){const{index:Z,displayValue:it,exportValue:ot}=tt.detail.insert,ct=S.children[Z],ht=document.createElement("option");ht.textContent=it,ht.value=ot,ct?ct.before(ht):S.append(ht),l.setValue(x,{value:W(!0),items:at(tt)}),G=W(!1)},items(tt){const{items:Z}=tt.detail;for(;S.length!==0;)S.remove(0);for(const it of Z){const{displayValue:ot,exportValue:ct}=it,ht=document.createElement("option");ht.textContent=ot,ht.value=ct,S.append(ht)}S.options.length>0&&(S.options[0].selected=!0),l.setValue(x,{value:W(!0),items:at(tt)}),G=W(!1)},indices(tt){const Z=new Set(tt.detail.indices);for(const it of tt.target.options)it.selected=Z.has(it.index);l.setValue(x,{value:W(!0)}),G=W(!1)},editable(tt){tt.target.disabled=!tt.detail.editable}};this._dispatchEventFromSandbox(Q,$)}),S.addEventListener("input",$=>{const Q=W(!0);l.setValue(x,{value:Q}),$.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:x,name:"Keystroke",value:G,changeEx:Q,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(S,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],$=>$.target.value)):S.addEventListener("input",function($){l.setValue(x,{value:W(!0)})}),this.data.combo&&this._setTextStyle(S),this._setBackgroundColor(S),this._setDefaultPropertiesFromJS(S),this.container.append(S),this.container}}class O extends e{constructor(l){const{data:x,elements:v}=l;super(l,{isRenderable:e._hasPopupData(x)}),this.elements=v}render(){this.container.classList.add("popupAnnotation");const l=new _({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),x=[];for(const v of this.elements)v.popup=l,x.push(v.data.id),v.addHighlightArea();return this.container.setAttribute("aria-controls",x.map(v=>`${o.AnnotationPrefix}${v}`).join(",")),this.container}}class _{#t=null;#e=this.#d.bind(this);#s=this.#_.bind(this);#n=this.#A.bind(this);#o=this.#b.bind(this);#a=null;#r=null;#l=null;#c=null;#i=null;#p=null;#h=!1;#u=null;#m=null;#g=null;#x=null;#f=!1;constructor({container:l,color:x,elements:v,titleObj:S,modificationDate:F,contentsObj:U,richText:W,parent:G,rect:at,parentRect:$,open:Q}){this.#r=l,this.#x=S,this.#l=U,this.#g=W,this.#i=G,this.#a=x,this.#m=at,this.#p=$,this.#c=v;const tt=f.PDFDateString.toDateObject(F);tt&&(this.#t=G.l10n.get("annotation_date_string",{date:tt.toLocaleDateString(),time:tt.toLocaleTimeString()})),this.trigger=v.flatMap(Z=>Z.getElementsToTriggerPopup());for(const Z of this.trigger)Z.addEventListener("click",this.#o),Z.addEventListener("mouseenter",this.#n),Z.addEventListener("mouseleave",this.#s),Z.classList.add("popupTriggerArea");for(const Z of v)Z.container?.addEventListener("keydown",this.#e);this.#r.hidden=!0,Q&&this.#b()}render(){if(this.#u)return;const{page:{view:l},viewport:{rawDims:{pageWidth:x,pageHeight:v,pageX:S,pageY:F}}}=this.#i,U=this.#u=document.createElement("div");if(U.className="popup",this.#a){const mt=U.style.outlineColor=o.Util.makeHexColor(...this.#a);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?U.style.backgroundColor=`color-mix(in srgb, ${mt} 30%, white)`:U.style.backgroundColor=o.Util.makeHexColor(...this.#a.map(yt=>Math.floor(.7*(255-yt)+yt)))}const W=document.createElement("span");W.className="header";const G=document.createElement("h1");if(W.append(G),{dir:G.dir,str:G.textContent}=this.#x,U.append(W),this.#t){const mt=document.createElement("span");mt.classList.add("popupDate"),this.#t.then(xt=>{mt.textContent=xt}),W.append(mt)}const at=this.#l,$=this.#g;if($?.str&&(!at?.str||at.str===$.str))P.XfaLayer.render({xfaHtml:$.html,intent:"richText",div:U}),U.lastChild.classList.add("richText","popupContent");else{const mt=this._formatContents(at);U.append(mt)}let Q=!!this.#p,tt=Q?this.#p:this.#m;for(const mt of this.#c)if(!tt||o.Util.intersect(mt.data.rect,tt)!==null){tt=mt.data.rect,Q=!0;break}const Z=o.Util.normalizeRect([tt[0],l[3]-tt[1]+l[1],tt[2],l[3]-tt[3]+l[1]]),ot=Q?tt[2]-tt[0]+5:0,ct=Z[0]+ot,ht=Z[1],{style:ut}=this.#r;ut.left=`${100*(ct-S)/x}%`,ut.top=`${100*(ht-F)/v}%`,this.#r.append(U)}_formatContents({str:l,dir:x}){const v=document.createElement("p");v.classList.add("popupContent"),v.dir=x;const S=l.split(/(?:\r\n?|\n)/);for(let F=0,U=S.length;F<U;++F){const W=S[F];v.append(document.createTextNode(W)),F<U-1&&v.append(document.createElement("br"))}return v}#d(l){l.altKey||l.shiftKey||l.ctrlKey||l.metaKey||(l.key==="Enter"||l.key==="Escape"&&this.#h)&&this.#b()}#b(){this.#h=!this.#h,this.#h?(this.#A(),this.#r.addEventListener("click",this.#o),this.#r.addEventListener("keydown",this.#e)):(this.#_(),this.#r.removeEventListener("click",this.#o),this.#r.removeEventListener("keydown",this.#e))}#A(){this.#u||this.render(),this.isVisible?this.#h&&this.#r.classList.add("focused"):(this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#_(){this.#r.classList.remove("focused"),!(this.#h||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#f=this.isVisible,this.#f&&(this.#r.hidden=!0)}maybeShow(){this.#f&&(this.#f=!1,this.#r.hidden=!1)}get isVisible(){return this.#r.hidden===!1}}class H extends e{constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0}),this.textContent=l.data.textContent,this.textPosition=l.data.textPosition,this.annotationEditorType=o.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const l=document.createElement("div");l.classList.add("annotationTextContent"),l.setAttribute("role","comment");for(const x of this.textContent){const v=document.createElement("span");v.textContent=x,l.append(v)}this.container.append(l)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}i.FreeTextAnnotationElement=H;class z extends e{#t=null;constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const l=this.data,{width:x,height:v}=a(l.rect),S=this.svgFactory.create(x,v,!0),F=this.#t=this.svgFactory.createElement("svg:line");return F.setAttribute("x1",l.rect[2]-l.lineCoordinates[0]),F.setAttribute("y1",l.rect[3]-l.lineCoordinates[1]),F.setAttribute("x2",l.rect[2]-l.lineCoordinates[2]),F.setAttribute("y2",l.rect[3]-l.lineCoordinates[3]),F.setAttribute("stroke-width",l.borderStyle.width||1),F.setAttribute("stroke","transparent"),F.setAttribute("fill","transparent"),S.append(F),this.container.append(S),!l.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class st extends e{#t=null;constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const l=this.data,{width:x,height:v}=a(l.rect),S=this.svgFactory.create(x,v,!0),F=l.borderStyle.width,U=this.#t=this.svgFactory.createElement("svg:rect");return U.setAttribute("x",F/2),U.setAttribute("y",F/2),U.setAttribute("width",x-F),U.setAttribute("height",v-F),U.setAttribute("stroke-width",F||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),S.append(U),this.container.append(S),!l.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class et extends e{#t=null;constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const l=this.data,{width:x,height:v}=a(l.rect),S=this.svgFactory.create(x,v,!0),F=l.borderStyle.width,U=this.#t=this.svgFactory.createElement("svg:ellipse");return U.setAttribute("cx",x/2),U.setAttribute("cy",v/2),U.setAttribute("rx",x/2-F/2),U.setAttribute("ry",v/2-F/2),U.setAttribute("stroke-width",F||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),S.append(U),this.container.append(S),!l.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class K extends e{#t=null;constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const l=this.data,{width:x,height:v}=a(l.rect),S=this.svgFactory.create(x,v,!0);let F=[];for(const W of l.vertices){const G=W.x-l.rect[0],at=l.rect[3]-W.y;F.push(G+","+at)}F=F.join(" ");const U=this.#t=this.svgFactory.createElement(this.svgElementName);return U.setAttribute("points",F),U.setAttribute("stroke-width",l.borderStyle.width||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),S.append(U),this.container.append(S),!l.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class nt extends K{constructor(l){super(l),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class J extends e{constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class L extends e{#t=[];constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=o.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const l=this.data,{width:x,height:v}=a(l.rect),S=this.svgFactory.create(x,v,!0);for(const F of l.inkLists){let U=[];for(const G of F){const at=G.x-l.rect[0],$=l.rect[3]-G.y;U.push(`${at},${$}`)}U=U.join(" ");const W=this.svgFactory.createElement(this.svgElementName);this.#t.push(W),W.setAttribute("points",U),W.setAttribute("stroke-width",l.borderStyle.width||1),W.setAttribute("stroke","transparent"),W.setAttribute("fill","transparent"),!l.popupRef&&this.hasPopupData&&this._createPopup(),S.append(W)}return this.container.append(S),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}i.InkAnnotationElement=L;class y extends e{constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class h extends e{constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class u extends e{constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class E extends e{constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class k extends e{constructor(l){super(l,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}i.StampAnnotationElement=k;class N extends e{#t=null;constructor(l){super(l,{isRenderable:!0});const{filename:x,content:v}=this.data.file;this.filename=(0,f.getFilenameFromUrl)(x,!0),this.content=v,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:x,content:v})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:l,data:x}=this;let v;x.hasAppearance||x.fillAlpha===0?v=document.createElement("div"):(v=document.createElement("img"),v.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(x.name)?"paperclip":"pushpin"}.svg`,x.fillAlpha&&x.fillAlpha<1&&(v.style=`filter: opacity(${Math.round(x.fillAlpha*100)}%);`)),v.addEventListener("dblclick",this.#e.bind(this)),this.#t=v;const{isMac:S}=o.FeatureTest.platform;return l.addEventListener("keydown",F=>{F.key==="Enter"&&(S?F.metaKey:F.ctrlKey)&&this.#e()}),!x.popupRef&&this.hasPopupData?this._createPopup():v.classList.add("popupTriggerArea"),l.append(v),l}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class B{#t=null;#e=null;#s=new Map;constructor({div:l,accessibilityManager:x,annotationCanvasMap:v,l10n:S,page:F,viewport:U}){this.div=l,this.#t=x,this.#e=v,this.l10n=S,this.page=F,this.viewport=U,this.zIndex=0,this.l10n||=T.NullL10n}#n(l,x){const v=l.firstChild||l;v.id=`${o.AnnotationPrefix}${x}`,this.div.append(l),this.#t?.moveElementInDOM(this.div,l,v,!1)}async render(l){const{annotations:x}=l,v=this.div;(0,f.setLayerDimensions)(v,this.viewport);const S=new Map,F={data:null,layer:v,linkService:l.linkService,downloadManager:l.downloadManager,imageResourcesPath:l.imageResourcesPath||"",renderForms:l.renderForms!==!1,svgFactory:new f.DOMSVGFactory,annotationStorage:l.annotationStorage||new I.AnnotationStorage,enableScripting:l.enableScripting===!0,hasJSActions:l.hasJSActions,fieldObjects:l.fieldObjects,parent:this,elements:null};for(const U of x){if(U.noHTML)continue;const W=U.annotationType===o.AnnotationType.POPUP;if(W){const $=S.get(U.id);if(!$)continue;F.elements=$}else{const{width:$,height:Q}=a(U.rect);if($<=0||Q<=0)continue}F.data=U;const G=c.create(F);if(!G.isRenderable)continue;if(!W&&U.popupRef){const $=S.get(U.popupRef);$?$.push(G):S.set(U.popupRef,[G])}G.annotationEditorType>0&&this.#s.set(G.data.id,G);const at=G.render();U.hidden&&(at.style.visibility="hidden"),this.#n(at,U.id)}this.#o(),await this.l10n.translate(v)}update({viewport:l}){const x=this.div;this.viewport=l,(0,f.setLayerDimensions)(x,{rotation:l.rotation}),this.#o(),x.hidden=!1}#o(){if(!this.#e)return;const l=this.div;for(const[x,v]of this.#e){const S=l.querySelector(`[data-annotation-id="${x}"]`);if(!S)continue;const{firstChild:F}=S;F?F.nodeName==="CANVAS"?F.replaceWith(v):F.before(v):S.append(v)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(l){return this.#s.get(l)}}i.AnnotationLayer=B}),((D,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorConverters=void 0;function R(I){return Math.floor(Math.max(0,Math.min(1,I))*255).toString(16).padStart(2,"0")}function o(I){return Math.max(0,Math.min(255,255*I))}class f{static CMYK_G([A,T,P,n]){return["G",1-Math.min(1,.3*A+.59*P+.11*T+n)]}static G_CMYK([A]){return["CMYK",0,0,0,1-A]}static G_RGB([A]){return["RGB",A,A,A]}static G_rgb([A]){return A=o(A),[A,A,A]}static G_HTML([A]){const T=R(A);return`#${T}${T}${T}`}static RGB_G([A,T,P]){return["G",.3*A+.59*T+.11*P]}static RGB_rgb(A){return A.map(o)}static RGB_HTML(A){return`#${A.map(R).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([A,T,P,n]){return["RGB",1-Math.min(1,A+n),1-Math.min(1,P+n),1-Math.min(1,T+n)]}static CMYK_rgb([A,T,P,n]){return[o(1-Math.min(1,A+n)),o(1-Math.min(1,P+n)),o(1-Math.min(1,T+n))]}static CMYK_HTML(A){const T=this.CMYK_RGB(A).slice(1);return this.RGB_HTML(T)}static RGB_CMYK([A,T,P]){const n=1-A,t=1-T,s=1-P,a=Math.min(n,t,s);return["CMYK",n,t,s,a]}}i.ColorConverters=f}),((D,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NullL10n=void 0,i.getL10nFallback=o;const R={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} Ã— {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} Ã— {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typingâ€¦",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};R.print_progress_percent="{{progress}}%";function o(A,T){switch(A){case"find_match_count":A=`find_match_count[${T.total===1?"one":"other"}]`;break;case"find_match_count_limit":A=`find_match_count_limit[${T.limit===1?"one":"other"}]`;break}return R[A]||""}function f(A,T){return T?A.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(P,n)=>n in T?T[n]:"{{"+n+"}}"):A}const I={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(A,T=null,P=o(A,T)){return f(P,T)},async translate(A){}};i.NullL10n=I}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.XfaLayer=void 0;var o=R(25);class f{static setupStorage(A,T,P,n,t){const s=n.getValue(T,{value:null});switch(P.name){case"textarea":if(s.value!==null&&(A.textContent=s.value),t==="print")break;A.addEventListener("input",a=>{n.setValue(T,{value:a.target.value})});break;case"input":if(P.attributes.type==="radio"||P.attributes.type==="checkbox"){if(s.value===P.attributes.xfaOn?A.setAttribute("checked",!0):s.value===P.attributes.xfaOff&&A.removeAttribute("checked"),t==="print")break;A.addEventListener("change",a=>{n.setValue(T,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(s.value!==null&&A.setAttribute("value",s.value),t==="print")break;A.addEventListener("input",a=>{n.setValue(T,{value:a.target.value})})}break;case"select":if(s.value!==null){A.setAttribute("value",s.value);for(const a of P.children)a.attributes.value===s.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}A.addEventListener("input",a=>{const c=a.target.options,e=c.selectedIndex===-1?"":c[c.selectedIndex].value;n.setValue(T,{value:e})});break}}static setAttributes({html:A,element:T,storage:P=null,intent:n,linkService:t}){const{attributes:s}=T,a=A instanceof HTMLAnchorElement;s.type==="radio"&&(s.name=`${s.name}-${n}`);for(const[c,e]of Object.entries(s))if(e!=null)switch(c){case"class":e.length&&A.setAttribute(c,e.join(" "));break;case"dataId":break;case"id":A.setAttribute("data-element-id",e);break;case"style":Object.assign(A.style,e);break;case"textContent":A.textContent=e;break;default:(!a||c!=="href"&&c!=="newWindow")&&A.setAttribute(c,e)}a&&t.addLinkAttributes(A,s.href,s.newWindow),P&&s.dataId&&this.setupStorage(A,s.dataId,T,P)}static render(A){const T=A.annotationStorage,P=A.linkService,n=A.xfaHtml,t=A.intent||"display",s=document.createElement(n.name);n.attributes&&this.setAttributes({html:s,element:n,intent:t,linkService:P});const a=[[n,-1,s]],c=A.div;if(c.append(s),A.viewport){const d=`matrix(${A.viewport.transform.join(",")})`;c.style.transform=d}t!=="richText"&&c.setAttribute("class","xfaLayer xfaFont");const e=[];for(;a.length>0;){const[d,m,r]=a.at(-1);if(m+1===d.children.length){a.pop();continue}const b=d.children[++a.at(-1)[1]];if(b===null)continue;const{name:w}=b;if(w==="#text"){const p=document.createTextNode(b.value);e.push(p),r.append(p);continue}const j=b?.attributes?.xmlns?document.createElementNS(b.attributes.xmlns,w):document.createElement(w);if(r.append(j),b.attributes&&this.setAttributes({html:j,element:b,storage:T,intent:t,linkService:P}),b.children&&b.children.length>0)a.push([b,-1,j]);else if(b.value){const p=document.createTextNode(b.value);o.XfaText.shouldBuildText(w)&&e.push(p),j.append(p)}}for(const d of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:e}}static update(A){const T=`matrix(${A.viewport.transform.join(",")})`;A.div.style.transform=T,A.div.hidden=!1}}i.XfaLayer=f}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.InkEditor=void 0;var o=R(1),f=R(4),I=R(29),A=R(6),T=R(5);class P extends f.AnnotationEditor{#t=0;#e=0;#s=this.canvasPointermove.bind(this);#n=this.canvasPointerleave.bind(this);#o=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#r=new Path2D;#l=!1;#c=!1;#i=!1;#p=null;#h=0;#u=0;#m=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t){f.AnnotationEditor.initialize(t,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(t,s){switch(t){case o.AnnotationEditorParamsType.INK_THICKNESS:P._defaultThickness=s;break;case o.AnnotationEditorParamsType.INK_COLOR:P._defaultColor=s;break;case o.AnnotationEditorParamsType.INK_OPACITY:P._defaultOpacity=s/100;break}}updateParams(t,s){switch(t){case o.AnnotationEditorParamsType.INK_THICKNESS:this.#g(s);break;case o.AnnotationEditorParamsType.INK_COLOR:this.#x(s);break;case o.AnnotationEditorParamsType.INK_OPACITY:this.#f(s);break}}static get defaultPropertiesToUpdate(){return[[o.AnnotationEditorParamsType.INK_THICKNESS,P._defaultThickness],[o.AnnotationEditorParamsType.INK_COLOR,P._defaultColor||f.AnnotationEditor._defaultLineColor],[o.AnnotationEditorParamsType.INK_OPACITY,Math.round(P._defaultOpacity*100)]]}get propertiesToUpdate(){return[[o.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||P._defaultThickness],[o.AnnotationEditorParamsType.INK_COLOR,this.color||P._defaultColor||f.AnnotationEditor._defaultLineColor],[o.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??P._defaultOpacity))]]}#g(t){const s=this.thickness;this.addCommands({cmd:()=>{this.thickness=t,this.#R()},undo:()=>{this.thickness=s,this.#R()},mustExec:!0,type:o.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#x(t){const s=this.color;this.addCommands({cmd:()=>{this.color=t,this.#y()},undo:()=>{this.color=s,this.#y()},mustExec:!0,type:o.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#f(t){t/=100;const s=this.opacity;this.addCommands({cmd:()=>{this.opacity=t,this.#y()},undo:()=>{this.opacity=s,this.#y()},mustExec:!0,type:o.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#N(),this.#k()),this.isAttachedToDOM||(this.parent.add(this),this.#E()),this.#R()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#p.disconnect(),this.#p=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,s]=this.parentDimensions,a=this.width*t,c=this.height*s;this.setDimensions(a,c)}enableEditMode(){this.#l||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#a))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#d(){const{parentRotation:t,parentDimensions:[s,a]}=this;switch(t){case 90:return[0,a,a,s];case 180:return[s,a,s,a];case 270:return[s,0,a,s];default:return[0,0,s,a]}}#b(){const{ctx:t,color:s,opacity:a,thickness:c,parentScale:e,scaleFactor:d}=this;t.lineWidth=c*e/d,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${s}${(0,T.opacityToHex)(a)}`}#A(t,s){this.canvas.addEventListener("contextmenu",A.noContextMenu),this.canvas.addEventListener("pointerleave",this.#n),this.canvas.addEventListener("pointermove",this.#s),this.canvas.addEventListener("pointerup",this.#o),this.canvas.removeEventListener("pointerdown",this.#a),this.isEditing=!0,this.#i||(this.#i=!0,this.#E(),this.thickness||=P._defaultThickness,this.color||=P._defaultColor||f.AnnotationEditor._defaultLineColor,this.opacity??=P._defaultOpacity),this.currentPath.push([t,s]),this.#c=!1,this.#b(),this.#m=()=>{this.#F(),this.#m&&window.requestAnimationFrame(this.#m)},window.requestAnimationFrame(this.#m)}#_(t,s){const[a,c]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===a&&s===c)return;const e=this.currentPath;let d=this.#r;if(e.push([t,s]),this.#c=!0,e.length<=2){d.moveTo(...e[0]),d.lineTo(t,s);return}e.length===3&&(this.#r=d=new Path2D,d.moveTo(...e[0])),this.#I(d,...e.at(-3),...e.at(-2),t,s)}#w(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#r.lineTo(...t)}#C(t,s){this.#m=null,t=Math.min(Math.max(t,0),this.canvas.width),s=Math.min(Math.max(s,0),this.canvas.height),this.#_(t,s),this.#w();let a;if(this.currentPath.length!==1)a=this.#L();else{const r=[t,s];a=[[r,r.slice(),r.slice(),r]]}const c=this.#r,e=this.currentPath;this.currentPath=[],this.#r=new Path2D;const d=()=>{this.allRawPaths.push(e),this.paths.push(a),this.bezierPath2D.push(c),this.rebuild()},m=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#N(),this.#k()),this.#R())};this.addCommands({cmd:d,undo:m,mustExec:!0})}#F(){if(!this.#c)return;this.#c=!1;const t=Math.ceil(this.thickness*this.parentScale),s=this.currentPath.slice(-3),a=s.map(d=>d[0]),c=s.map(d=>d[1]);Math.min(...a)-t,Math.max(...a)+t,Math.min(...c)-t,Math.max(...c)+t;const{ctx:e}=this;e.save(),e.clearRect(0,0,this.canvas.width,this.canvas.height);for(const d of this.bezierPath2D)e.stroke(d);e.stroke(this.#r),e.restore()}#I(t,s,a,c,e,d,m){const r=(s+c)/2,b=(a+e)/2,w=(c+d)/2,j=(e+m)/2;t.bezierCurveTo(r+2*(c-r)/3,b+2*(e-b)/3,w+2*(c-w)/3,j+2*(e-j)/3,w,j)}#L(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const s=[];let a,[c,e]=t[0];for(a=1;a<t.length-2;a++){const[p,g]=t[a],[M,O]=t[a+1],_=(p+M)/2,H=(g+O)/2,z=[c+2*(p-c)/3,e+2*(g-e)/3],st=[_+2*(p-_)/3,H+2*(g-H)/3];s.push([[c,e],z,st,[_,H]]),[c,e]=[_,H]}const[d,m]=t[a],[r,b]=t[a+1],w=[c+2*(d-c)/3,e+2*(m-e)/3],j=[r+2*(d-r)/3,b+2*(m-b)/3];return s.push([[c,e],w,j,[r,b]]),s}#y(){if(this.isEmpty()){this.#j();return}this.#b();const{canvas:t,ctx:s}=this;s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),this.#j();for(const a of this.bezierPath2D)s.stroke(a)}commit(){this.#l||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#l=!0,this.div.classList.add("disabled"),this.#R(!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#l||(this.setInForeground(),t.preventDefault(),t.type!=="mouse"&&this.div.focus(),this.#A(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#_(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#M(t)}canvasPointerleave(t){this.#M(t)}#M(t){this.canvas.removeEventListener("pointerleave",this.#n),this.canvas.removeEventListener("pointermove",this.#s),this.canvas.removeEventListener("pointerup",this.#o),this.canvas.addEventListener("pointerdown",this.#a),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",A.noContextMenu)},10),this.#C(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#N(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",f.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(t=>this.canvas?.setAttribute("aria-label",t)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#k(){this.#p=new ResizeObserver(t=>{const s=t[0].contentRect;s.width&&s.height&&this.setDimensions(s.width,s.height)}),this.#p.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#l}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),f.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(m=>this.div?.setAttribute("aria-label",m));const[a,c,e,d]=this.#d();if(this.setAt(a,c,0,0),this.setDims(e,d),this.#N(),this.width){const[m,r]=this.parentDimensions;this.setAspectRatio(this.width*m,this.height*r),this.setAt(t*m,s*r,this.width*m,this.height*r),this.#i=!0,this.#E(),this.setDims(this.width*m,this.height*r),this.#y(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#k(),this.div}#E(){if(!this.#i)return;const[t,s]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*s),this.#j()}setDimensions(t,s){const a=Math.round(t),c=Math.round(s);if(this.#h===a&&this.#u===c)return;this.#h=a,this.#u=c,this.canvas.style.visibility="hidden";const[e,d]=this.parentDimensions;this.width=t/e,this.height=s/d,this.fixAndSetPosition(),this.#l&&this.#S(t,s),this.#E(),this.#y(),this.canvas.style.visibility="visible",this.fixDims()}#S(t,s){const a=this.#P(),c=(t-a)/this.#e,e=(s-a)/this.#t;this.scaleFactor=Math.min(c,e)}#j(){const t=this.#P()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#D(t){const s=new Path2D;for(let a=0,c=t.length;a<c;a++){const[e,d,m,r]=t[a];a===0&&s.moveTo(...e),s.bezierCurveTo(d[0],d[1],m[0],m[1],r[0],r[1])}return s}static#O(t,s,a){const[c,e,d,m]=s;switch(a){case 0:for(let r=0,b=t.length;r<b;r+=2)t[r]+=c,t[r+1]=m-t[r+1];break;case 90:for(let r=0,b=t.length;r<b;r+=2){const w=t[r];t[r]=t[r+1]+c,t[r+1]=w+e}break;case 180:for(let r=0,b=t.length;r<b;r+=2)t[r]=d-t[r],t[r+1]+=e;break;case 270:for(let r=0,b=t.length;r<b;r+=2){const w=t[r];t[r]=d-t[r+1],t[r+1]=m-w}break;default:throw new Error("Invalid rotation")}return t}static#B(t,s,a){const[c,e,d,m]=s;switch(a){case 0:for(let r=0,b=t.length;r<b;r+=2)t[r]-=c,t[r+1]=m-t[r+1];break;case 90:for(let r=0,b=t.length;r<b;r+=2){const w=t[r];t[r]=t[r+1]-e,t[r+1]=w-c}break;case 180:for(let r=0,b=t.length;r<b;r+=2)t[r]=d-t[r],t[r+1]-=e;break;case 270:for(let r=0,b=t.length;r<b;r+=2){const w=t[r];t[r]=m-t[r+1],t[r+1]=d-w}break;default:throw new Error("Invalid rotation")}return t}#U(t,s,a,c){const e=[],d=this.thickness/2,m=t*s+d,r=t*a+d;for(const b of this.paths){const w=[],j=[];for(let p=0,g=b.length;p<g;p++){const[M,O,_,H]=b[p],z=t*M[0]+m,st=t*M[1]+r,et=t*O[0]+m,K=t*O[1]+r,nt=t*_[0]+m,J=t*_[1]+r,L=t*H[0]+m,y=t*H[1]+r;p===0&&(w.push(z,st),j.push(z,st)),w.push(et,K,nt,J,L,y),j.push(et,K),p===g-1&&j.push(L,y)}e.push({bezier:P.#O(w,c,this.rotation),points:P.#O(j,c,this.rotation)})}return e}#T(){let t=1/0,s=-1/0,a=1/0,c=-1/0;for(const e of this.paths)for(const[d,m,r,b]of e){const w=o.Util.bezierBoundingBox(...d,...m,...r,...b);t=Math.min(t,w[0]),a=Math.min(a,w[1]),s=Math.max(s,w[2]),c=Math.max(c,w[3])}return[t,a,s,c]}#P(){return this.#l?Math.ceil(this.thickness*this.parentScale):0}#R(t=!1){if(this.isEmpty())return;if(!this.#l){this.#y();return}const s=this.#T(),a=this.#P();this.#e=Math.max(f.AnnotationEditor.MIN_SIZE,s[2]-s[0]),this.#t=Math.max(f.AnnotationEditor.MIN_SIZE,s[3]-s[1]);const c=Math.ceil(a+this.#e*this.scaleFactor),e=Math.ceil(a+this.#t*this.scaleFactor),[d,m]=this.parentDimensions;this.width=c/d,this.height=e/m,this.setAspectRatio(c,e);const r=this.translationX,b=this.translationY;this.translationX=-s[0],this.translationY=-s[1],this.#E(),this.#y(),this.#h=c,this.#u=e,this.setDims(c,e);const w=t?a/this.scaleFactor/2:0;this.translate(r-this.translationX-w,b-this.translationY-w)}static deserialize(t,s,a){if(t instanceof I.InkAnnotationElement)return null;const c=super.deserialize(t,s,a);c.thickness=t.thickness,c.color=o.Util.makeHexColor(...t.color),c.opacity=t.opacity;const[e,d]=c.pageDimensions,m=c.width*e,r=c.height*d,b=c.parentScale,w=t.thickness/2;c.#l=!0,c.#h=Math.round(m),c.#u=Math.round(r);const{paths:j,rect:p,rotation:g}=t;for(let{bezier:O}of j){O=P.#B(O,p,g);const _=[];c.paths.push(_);let H=b*(O[0]-w),z=b*(O[1]-w);for(let et=2,K=O.length;et<K;et+=6){const nt=b*(O[et]-w),J=b*(O[et+1]-w),L=b*(O[et+2]-w),y=b*(O[et+3]-w),h=b*(O[et+4]-w),u=b*(O[et+5]-w);_.push([[H,z],[nt,J],[L,y],[h,u]]),H=h,z=u}const st=this.#D(_);c.bezierPath2D.push(st)}const M=c.#T();return c.#e=Math.max(f.AnnotationEditor.MIN_SIZE,M[2]-M[0]),c.#t=Math.max(f.AnnotationEditor.MIN_SIZE,M[3]-M[1]),c.#S(m,r),c}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),s=f.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:o.AnnotationEditorType.INK,color:s,thickness:this.thickness,opacity:this.opacity,paths:this.#U(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}i.InkEditor=P}),((D,i,R)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.StampEditor=void 0;var o=R(1),f=R(4),I=R(6),A=R(29);class T extends f.AnnotationEditor{#t=null;#e=null;#s=null;#n=null;#o=null;#a=null;#r=null;#l=null;#c=!1;#i=!1;static _type="stamp";constructor(n){super({...n,name:"stampEditor"}),this.#n=n.bitmapUrl,this.#o=n.bitmapFile}static initialize(n){f.AnnotationEditor.initialize(n)}static get supportedTypes(){const n=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,o.shadow)(this,"supportedTypes",n.map(t=>`image/${t}`))}static get supportedTypesStr(){return(0,o.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(n){return this.supportedTypes.includes(n)}static paste(n,t){t.pasteEditor(o.AnnotationEditorType.STAMP,{bitmapFile:n.getAsFile()})}#p(n,t=!1){if(!n){this.remove();return}this.#t=n.bitmap,t||(this.#e=n.id,this.#c=n.isSvg),this.#m()}#h(){this.#s=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#u(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(t=>this.#p(t,!0)).finally(()=>this.#h());return}if(this.#n){const t=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(t).then(s=>this.#p(s)).finally(()=>this.#h());return}if(this.#o){const t=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(t).then(s=>this.#p(s)).finally(()=>this.#h());return}const n=document.createElement("input");n.type="file",n.accept=T.supportedTypesStr,this.#s=new Promise(t=>{n.addEventListener("change",async()=>{if(!n.files||n.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(n.files[0]);this.#p(s)}t()}),n.addEventListener("cancel",()=>{this.remove(),t()})}).finally(()=>this.#h()),n.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#r?.disconnect(),this.#r=null),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#u();return}super.rebuild(),this.div!==null&&(this.#e&&this.#u(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#n||this.#o)}get isResizable(){return!0}render(){if(this.div)return this.div;let n,t;if(this.width&&(n=this.x,t=this.y),super.render(),this.div.hidden=!0,this.#t?this.#m():this.#u(),this.width){const[s,a]=this.parentDimensions;this.setAt(n*s,t*a,this.width*s,this.height*a)}return this.div}#m(){const{div:n}=this;let{width:t,height:s}=this.#t;const[a,c]=this.pageDimensions,e=.75;if(this.width)t=this.width*a,s=this.height*c;else if(t>e*a||s>e*c){const b=Math.min(e*a/t,e*c/s);t*=b,s*=b}const[d,m]=this.parentDimensions;this.setDims(t*d/a,s*m/c),this._uiManager.enableWaiting(!1);const r=this.#a=document.createElement("canvas");n.append(r),n.hidden=!1,this.#f(t,s),this.#b(),this.#i||(this.parent.addUndoableEditor(this),this.#i=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()}#g(n,t){const[s,a]=this.parentDimensions;this.width=n/s,this.height=t/a,this.setDims(n,t),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#l!==null&&clearTimeout(this.#l);const c=200;this.#l=setTimeout(()=>{this.#l=null,this.#f(n,t)},c)}#x(n,t){const{width:s,height:a}=this.#t;let c=s,e=a,d=this.#t;for(;c>2*n||e>2*t;){const m=c,r=e;c>2*n&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2)),e>2*t&&(e=e>=16384?Math.floor(e/2)-1:Math.ceil(e/2));const b=new OffscreenCanvas(c,e);b.getContext("2d").drawImage(d,0,0,m,r,0,0,c,e),d=b.transferToImageBitmap()}return d}#f(n,t){n=Math.ceil(n),t=Math.ceil(t);const s=this.#a;if(!s||s.width===n&&s.height===t)return;s.width=n,s.height=t;const a=this.#c?this.#t:this.#x(n,t),c=s.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(a,0,0,a.width,a.height,0,0,n,t)}#d(n){if(n){if(this.#c){const a=this._uiManager.imageManager.getSvgUrl(this.#e);if(a)return a}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#c){const[t,s]=this.pageDimensions,a=Math.round(this.width*t*I.PixelsPerInch.PDF_TO_CSS_UNITS),c=Math.round(this.height*s*I.PixelsPerInch.PDF_TO_CSS_UNITS),e=new OffscreenCanvas(a,c);return e.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,a,c),e.transferToImageBitmap()}return structuredClone(this.#t)}#b(){this.#r=new ResizeObserver(n=>{const t=n[0].contentRect;t.width&&t.height&&this.#g(t.width,t.height)}),this.#r.observe(this.div)}static deserialize(n,t,s){if(n instanceof A.StampAnnotationElement)return null;const a=super.deserialize(n,t,s),{rect:c,bitmapUrl:e,bitmapId:d,isSvg:m,accessibilityData:r}=n;d&&s.imageManager.isValidId(d)?a.#e=d:a.#n=e,a.#c=m;const[b,w]=a.pageDimensions;return a.width=(c[2]-c[0])/b,a.height=(c[3]-c[1])/w,r&&(a.altTextData=r),a}serialize(n=!1,t=null){if(this.isEmpty())return null;const s={annotationType:o.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(n)return s.bitmapUrl=this.#d(!0),s.accessibilityData=this.altTextData,s;const{decorative:a,altText:c}=this.altTextData;if(!a&&c&&(s.accessibilityData={type:"Figure",alt:c}),t===null)return s;t.stamps||=new Map;const e=this.#c?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:e,serialized:s}),s.bitmap=this.#d(!1);else if(this.#c){const d=t.stamps.get(this.#e);e>d.area&&(d.area=e,d.serialized.bitmap.close(),d.serialized.bitmap=this.#d(!1))}return s}}i.StampEditor=T})],__webpack_module_cache__={};function __w_pdfjs_require__(D){var i=__webpack_module_cache__[D];if(i!==void 0)return i.exports;var R=__webpack_module_cache__[D]={exports:{}};return __webpack_modules__[D](R,R.exports,__w_pdfjs_require__),R.exports}var __webpack_exports__={};return(()=>{var D=__webpack_exports__;Object.defineProperty(D,"__esModule",{value:!0}),Object.defineProperty(D,"AbortException",{enumerable:!0,get:function(){return i.AbortException}}),Object.defineProperty(D,"AnnotationEditorLayer",{enumerable:!0,get:function(){return I.AnnotationEditorLayer}}),Object.defineProperty(D,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return i.AnnotationEditorParamsType}}),Object.defineProperty(D,"AnnotationEditorType",{enumerable:!0,get:function(){return i.AnnotationEditorType}}),Object.defineProperty(D,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return A.AnnotationEditorUIManager}}),Object.defineProperty(D,"AnnotationLayer",{enumerable:!0,get:function(){return T.AnnotationLayer}}),Object.defineProperty(D,"AnnotationMode",{enumerable:!0,get:function(){return i.AnnotationMode}}),Object.defineProperty(D,"CMapCompressionType",{enumerable:!0,get:function(){return i.CMapCompressionType}}),Object.defineProperty(D,"DOMSVGFactory",{enumerable:!0,get:function(){return o.DOMSVGFactory}}),Object.defineProperty(D,"FeatureTest",{enumerable:!0,get:function(){return i.FeatureTest}}),Object.defineProperty(D,"GlobalWorkerOptions",{enumerable:!0,get:function(){return P.GlobalWorkerOptions}}),Object.defineProperty(D,"ImageKind",{enumerable:!0,get:function(){return i.ImageKind}}),Object.defineProperty(D,"InvalidPDFException",{enumerable:!0,get:function(){return i.InvalidPDFException}}),Object.defineProperty(D,"MissingPDFException",{enumerable:!0,get:function(){return i.MissingPDFException}}),Object.defineProperty(D,"OPS",{enumerable:!0,get:function(){return i.OPS}}),Object.defineProperty(D,"PDFDataRangeTransport",{enumerable:!0,get:function(){return R.PDFDataRangeTransport}}),Object.defineProperty(D,"PDFDateString",{enumerable:!0,get:function(){return o.PDFDateString}}),Object.defineProperty(D,"PDFWorker",{enumerable:!0,get:function(){return R.PDFWorker}}),Object.defineProperty(D,"PasswordResponses",{enumerable:!0,get:function(){return i.PasswordResponses}}),Object.defineProperty(D,"PermissionFlag",{enumerable:!0,get:function(){return i.PermissionFlag}}),Object.defineProperty(D,"PixelsPerInch",{enumerable:!0,get:function(){return o.PixelsPerInch}}),Object.defineProperty(D,"PromiseCapability",{enumerable:!0,get:function(){return i.PromiseCapability}}),Object.defineProperty(D,"RenderingCancelledException",{enumerable:!0,get:function(){return o.RenderingCancelledException}}),Object.defineProperty(D,"SVGGraphics",{enumerable:!0,get:function(){return R.SVGGraphics}}),Object.defineProperty(D,"UnexpectedResponseException",{enumerable:!0,get:function(){return i.UnexpectedResponseException}}),Object.defineProperty(D,"Util",{enumerable:!0,get:function(){return i.Util}}),Object.defineProperty(D,"VerbosityLevel",{enumerable:!0,get:function(){return i.VerbosityLevel}}),Object.defineProperty(D,"XfaLayer",{enumerable:!0,get:function(){return n.XfaLayer}}),Object.defineProperty(D,"build",{enumerable:!0,get:function(){return R.build}}),Object.defineProperty(D,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return i.createValidAbsoluteUrl}}),Object.defineProperty(D,"getDocument",{enumerable:!0,get:function(){return R.getDocument}}),Object.defineProperty(D,"getFilenameFromUrl",{enumerable:!0,get:function(){return o.getFilenameFromUrl}}),Object.defineProperty(D,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return o.getPdfFilenameFromUrl}}),Object.defineProperty(D,"getXfaPageViewport",{enumerable:!0,get:function(){return o.getXfaPageViewport}}),Object.defineProperty(D,"isDataScheme",{enumerable:!0,get:function(){return o.isDataScheme}}),Object.defineProperty(D,"isPdfFile",{enumerable:!0,get:function(){return o.isPdfFile}}),Object.defineProperty(D,"loadScript",{enumerable:!0,get:function(){return o.loadScript}}),Object.defineProperty(D,"noContextMenu",{enumerable:!0,get:function(){return o.noContextMenu}}),Object.defineProperty(D,"normalizeUnicode",{enumerable:!0,get:function(){return i.normalizeUnicode}}),Object.defineProperty(D,"renderTextLayer",{enumerable:!0,get:function(){return f.renderTextLayer}}),Object.defineProperty(D,"setLayerDimensions",{enumerable:!0,get:function(){return o.setLayerDimensions}}),Object.defineProperty(D,"shadow",{enumerable:!0,get:function(){return i.shadow}}),Object.defineProperty(D,"updateTextLayer",{enumerable:!0,get:function(){return f.updateTextLayer}}),Object.defineProperty(D,"version",{enumerable:!0,get:function(){return R.version}});var i=__w_pdfjs_require__(1),R=__w_pdfjs_require__(2),o=__w_pdfjs_require__(6),f=__w_pdfjs_require__(26),I=__w_pdfjs_require__(27),A=__w_pdfjs_require__(5),T=__w_pdfjs_require__(29),P=__w_pdfjs_require__(14),n=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf)),pdf.exports}var pdfExports=requirePdf();pdfExports.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";const ImportFormModal=({adminPassword:D,onClose:i,onImportComplete:R})=>{const[o,f]=reactExports.useState("upload"),[I,A]=reactExports.useState(null),[T,P]=reactExports.useState(""),[n,t]=reactExports.useState(null),[s,a]=reactExports.useState(""),[c,e]=reactExports.useState(""),[d,m]=reactExports.useState(null),[r,b]=reactExports.useState(!1),w=async H=>{const z=await H.arrayBuffer(),st=await pdfExports.getDocument({data:z}).promise;let et="";for(let K=1;K<=st.numPages;K++){const J=await(await st.getPage(K)).getTextContent();et+=J.items.map(L=>L.str).join(" ")+`
`}return et},j=async H=>{const z=H.target.files?.[0];if(z){if(z.type!=="application/pdf"){m("Please select a PDF file");return}A(z),m(null),b(!0);try{const st=await w(z);P(st),f("processing")}catch(st){m(st instanceof Error?st.message:"Failed to extract PDF text")}finally{b(!1)}}},p=async()=>{if(T){b(!0),m(null);try{const H=await fetch(`${WORKER_URL}/api/forms/import`,{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Password":D},body:JSON.stringify({text:T,fileName:I?.name||"inventory.pdf"})});if(H.status===501){m("AI feature is not configured on the server. Please contact the administrator.");return}if(H.status===429){m("Daily AI quota exceeded. Please try again tomorrow.");return}if(!H.ok)throw new Error(`Server error: ${H.status}`);const z=await H.json();t(z.formJson),e(z.suggestedName||"Imported Form"),f("review")}catch(H){m(H instanceof Error?H.message:"Failed to convert PDF to form")}finally{b(!1)}}},g=()=>{if(!n||!s.trim()||!c.trim()){m("Please enter both apparatus name and template name");return}R(n,s.trim(),c.trim())},M=()=>jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[jsxRuntimeExports.jsx(Upload,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:"Select a PDF inventory sheet to import"}),jsxRuntimeExports.jsx("input",{type:"file",accept:"application/pdf",onChange:H=>j(H),className:"hidden",id:"pdf-upload"}),jsxRuntimeExports.jsx("label",{htmlFor:"pdf-upload",children:jsxRuntimeExports.jsx("span",{className:"inline-flex items-center justify-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg cursor-pointer transition-colors",children:"Choose PDF File"})}),I&&jsxRuntimeExports.jsxs("p",{className:"mt-4 text-sm text-gray-600",children:["Selected: ",I.name]})]}),r&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-600",children:[jsxRuntimeExports.jsx(Loader,{className:"w-5 h-5 animate-spin"}),"Extracting text from PDF..."]}),d&&jsxRuntimeExports.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5"}),d]})]}),O=()=>jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-4",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5"}),"PDF text extracted successfully"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Extracted Text (editable)"}),jsxRuntimeExports.jsx("textarea",{value:T,onChange:H=>P(H.target.value),rows:12,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Review and edit the extracted text if needed before converting to a form."})]}),r&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-600",children:[jsxRuntimeExports.jsx(Loader,{className:"w-5 h-5 animate-spin"}),"Converting to form with AI..."]}),d&&jsxRuntimeExports.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5"}),d]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 justify-end",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:i,disabled:r,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{onClick:p,disabled:r||!T.trim(),children:"Convert to Form"})]})]}),_=()=>jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-4",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5"}),"Form generated successfully"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:c,onChange:H=>e(H.target.value),placeholder:"e.g., Engine, Ladder, Rescue",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apparatus Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:s,onChange:H=>a(H.target.value),placeholder:"e.g., Engine 1, Rescue 5",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Generated Form JSON (preview)"}),jsxRuntimeExports.jsx("pre",{className:"w-full p-3 bg-gray-50 border border-gray-300 rounded-lg overflow-auto max-h-64 text-xs font-mono",children:JSON.stringify(n,null,2)}),jsxRuntimeExports.jsxs("p",{className:"mt-2 text-sm text-gray-500",children:[n?.compartments?.length||0," compartments detected"]})]}),d&&jsxRuntimeExports.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5"}),d]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 justify-end",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:i,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{onClick:g,disabled:!s.trim()||!c.trim(),children:"Save Form"})]})]});return jsxRuntimeExports.jsx(Modal,{isOpen:!0,onClose:i,title:"Import Form from PDF",children:jsxRuntimeExports.jsxs("div",{className:"min-h-[400px]",children:[o==="upload"&&M(),o==="processing"&&O(),o==="review"&&_()]})})},FormsTab=({adminPassword:D})=>{const[i,R]=reactExports.useState([]),[o,f]=reactExports.useState(!0),[I,A]=reactExports.useState(null),[T,P]=reactExports.useState(!1),[n,t]=reactExports.useState(!1),[s,a]=reactExports.useState(null),[c,e]=reactExports.useState(""),[d,m]=reactExports.useState(""),r=async()=>{f(!0),A(null);try{const j=await fetch(`${WORKER_URL}/api/forms`,{headers:{"X-Admin-Password":D}});if(!j.ok)throw new Error(`Failed: ${j.status}`);const p=await j.json();R(p.templates||[])}catch(j){A(j instanceof Error?j.message:"Failed to load templates")}finally{f(!1)}};reactExports.useEffect(()=>{r()},[]);const b=async()=>{if(!c.trim()||!d){alert("Please enter apparatus name and select a template");return}try{const j=await fetch(`${WORKER_URL}/api/forms`,{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Password":D},body:JSON.stringify({apparatus:c.trim(),templateId:d})});if(!j.ok)throw new Error(`Failed: ${j.status}`);P(!1),e(""),m(""),r()}catch(j){alert(j instanceof Error?j.message:"Failed to add apparatus")}},w=async(j,p,g)=>{try{const M=await fetch(`${WORKER_URL}/api/forms`,{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Password":D},body:JSON.stringify({apparatus:p,templateName:g,formJson:j})});if(!M.ok)throw new Error(`Failed: ${M.status}`);t(!1),r()}catch(M){alert(M instanceof Error?M.message:"Failed to save imported form")}};return o?jsxRuntimeExports.jsx("div",{className:"p-4",children:"Loading forms..."}):I?jsxRuntimeExports.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5"}),I]}):jsxRuntimeExports.jsxs("div",{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[jsxRuntimeExports.jsx(List,{className:"w-6 h-6"}),"Inventory Forms Management"]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs(Button,{onClick:()=>t(!0),className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FileUp,{className:"w-4 h-4"}),"Import from PDF"]}),jsxRuntimeExports.jsxs(Button,{onClick:()=>P(!0),className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),"Add Apparatus"]})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:jsxRuntimeExports.jsxs("table",{className:"w-full",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Template Name"}),jsxRuntimeExports.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Apparatus"}),jsxRuntimeExports.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Modified"}),jsxRuntimeExports.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.length===0?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:4,className:"px-6 py-4 text-center text-gray-500",children:"No forms found. Import from PDF or add an apparatus to get started."})}):i.map(j=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:j.name}),jsxRuntimeExports.jsx("td",{className:"px-6 py-4",children:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:j.apparatus_list.map((p,g)=>jsxRuntimeExports.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:p},g))})}),jsxRuntimeExports.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(j.modified_at).toLocaleDateString()}),jsxRuntimeExports.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:jsxRuntimeExports.jsxs("button",{onClick:()=>a(j.id),className:"text-blue-600 hover:text-blue-900 flex items-center gap-1",children:[jsxRuntimeExports.jsx(Pen,{className:"w-4 h-4"}),"Edit"]})})]},j.id))})]})}),T&&jsxRuntimeExports.jsx(Modal,{isOpen:T,onClose:()=>{P(!1),e(""),m("")},title:"Add New Apparatus",children:jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apparatus Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:c,onChange:j=>e(j.target.value),placeholder:"e.g., Engine 5",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Use Template"}),jsxRuntimeExports.jsxs("select",{value:d,onChange:j=>m(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select a template..."}),i.map(j=>jsxRuntimeExports.jsx("option",{value:j.id,children:j.name},j.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 justify-end",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:()=>{P(!1),e(""),m("")},children:"Cancel"}),jsxRuntimeExports.jsx(Button,{onClick:b,children:"Add Apparatus"})]})]})}),n&&jsxRuntimeExports.jsx(ImportFormModal,{adminPassword:D,onClose:()=>t(!1),onImportComplete:w}),s&&jsxRuntimeExports.jsx(FormEditor,{templateId:s,adminPassword:D,onClose:()=>a(null),onSaved:()=>{a(null),r()}})]})},AdminDashboard=()=>{const D=useNavigate(),[i,R]=reactExports.useState(!1),[o,f]=reactExports.useState(""),[I,A]=reactExports.useState(""),[T,P]=reactExports.useState("home"),[n,t]=reactExports.useState(new Map),[s,a]=reactExports.useState([]),[c,e]=reactExports.useState(null),[d,m]=reactExports.useState([]),[r,b]=reactExports.useState(!1),[w,j]=reactExports.useState([]),[p,g]=reactExports.useState(null),[M,O]=reactExports.useState(!1),[_,H]=reactExports.useState(null),[z,st]=reactExports.useState(!1),[et,K]=reactExports.useState(!1),[nt,J]=reactExports.useState(null),[L,y]=reactExports.useState(0),[h,u]=reactExports.useState(0),[E,k]=reactExports.useState(null),[N,B]=reactExports.useState(null),[C,l]=reactExports.useState(""),[x,v]=reactExports.useState(!1),[S,F]=reactExports.useState(""),[U,W]=reactExports.useState(null),[G,at]=reactExports.useState("defects"),[$,Q]=reactExports.useState(!1),tt=async Y=>{try{O(!0),g(Y),P("activity");const pt=(await githubService.getInspectionLogs(30)).filter(_t=>_t.title.includes(`[${Y}]`));j(pt)}catch(dt){console.error("Error loading apparatus logs:",dt),alert("Failed to load inspection history")}finally{O(!1)}},Z=async()=>{try{O(!0),g(null);const Y=await githubService.getInspectionLogs(30);j(Y)}catch(Y){console.error("Error loading all inspection logs:",Y)}finally{O(!1)}},it=async()=>{try{b(!0);const Y=await githubService.getAllDefects();console.log("ðŸ“Š Loaded defects:",Y.length,Y);const dt=githubService.computeFleetStatus(Y);console.log("ðŸ“Š Computed fleet status:",Object.fromEntries(dt)),a(Y),t(dt);try{const pt=await githubService.getDailySubmissions();e(pt)}catch(pt){console.error("Error fetching daily submissions:",pt)}try{const pt=await githubService.analyzeLowStockItems();m(pt)}catch(pt){console.error("Error analyzing low stock:",pt)}try{const pt=await fetchTasks("pending");u(pt.unseenCount)}catch(pt){console.error("Error fetching unseen inventory count:",pt)}try{const pt=await githubService.getInspectionLogs(30);j(pt)}catch(pt){console.error("Error loading inspection logs:",pt)}}catch(Y){throw console.error("Error loading dashboard data:",Y),Y instanceof Error&&Y.message.includes("Unauthorized")&&(R(!1),githubService.clearAdminPassword(),localStorage.removeItem("adminPassword")),Y}finally{b(!1)}},ot=async()=>{if(!o.trim()){A("Please enter a password");return}githubService.setAdminPassword(o),localStorage.setItem("adminPassword",o);try{await it(),R(!0),A("")}catch(Y){console.error("Authentication failed:",Y),Y instanceof Error&&Y.message.includes("Unauthorized")?A("Incorrect password. Please try again."):Y instanceof Error&&Y.message.includes("Failed to fetch")?A("Network error. Please check your connection and try again."):A("Authentication failed. Please try again."),githubService.clearAdminPassword(),localStorage.removeItem("adminPassword")}},ct=async Y=>{if(P(Y),Q(!1),Y==="inventory"&&h>0)try{await markTasksViewed(),u(0)}catch(dt){console.error("Error marking tasks as viewed:",dt)}Y==="notifications"&&!_&&ht(),Y==="insights"&&y(0)},ht=async()=>{if(o){st(!0),J(null);try{const Y=await githubService.getEmailConfig(o);H(Y)}catch(Y){J(Y.message||"Failed to load email configuration")}finally{st(!1)}}},ut=async Y=>{if(!(!o||!_)){K(!0),J(null);try{const dt=await githubService.updateEmailConfig(o,Y);H(dt.config),alert("Email configuration updated successfully")}catch(dt){J(dt.message||"Failed to update email configuration")}finally{K(!1)}}},mt=async()=>{if(o&&confirm("Send a test daily digest email now?"))try{await githubService.sendManualDigest(o),alert("Test digest sent successfully! Check your email.")}catch(Y){alert("Failed to send test digest: "+(Y.message||"Unknown error"))}},xt=async()=>{if(!(!N||!N.issueNumber)){v(!0);try{await githubService.resolveDefect(N.issueNumber,C||"Defect resolved via Admin Dashboard","Admin"),a(Y=>Y.filter(dt=>dt.issueNumber!==N.issueNumber)),t(Y=>{const dt=new Map(Y),pt=dt.get(N.apparatus)||0;return dt.set(N.apparatus,Math.max(0,pt-1)),dt}),B(null),l(""),alert("Defect successfully resolved!")}catch(Y){console.error("Error resolving defect:",Y),alert(`Failed to resolve defect: ${Y instanceof Error?Y.message:"Unknown error"}`)}finally{v(!1)}}};if(reactExports.useEffect(()=>{if(!i)return;const Y=setInterval(()=>{it().catch(console.error)},12e4);return()=>clearInterval(Y)},[i]),reactExports.useEffect(()=>{i&&T==="activity"&&w.length===0&&!M&&Z()},[i,T]),!i)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center p-4",children:jsxRuntimeExports.jsx(Card,{className:"max-w-md w-full",children:jsxRuntimeExports.jsxs(CardContent,{className:"py-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-8",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Lock,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Enter the admin password to continue"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Password"}),jsxRuntimeExports.jsx("input",{id:"password",type:"password",value:o,onChange:Y=>{f(Y.target.value),A("")},onKeyDown:Y=>{Y.key==="Enter"&&ot()},placeholder:"Enter admin password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0}),I&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm mt-2",children:I})]}),jsxRuntimeExports.jsx(Button,{onClick:ot,className:"w-full",size:"lg",children:"Access Admin Dashboard"}),jsxRuntimeExports.jsx("div",{className:"text-center mt-4",children:jsxRuntimeExports.jsx("button",{onClick:()=>D("/"),className:"text-sm text-gray-600 hover:text-gray-900 font-medium",children:"â† Back to Login"})})]})]})})});if(r)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading dashboard..."})]})});const yt=APPARATUS_LIST,vt=new Date().toLocaleDateString("en-US");return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50",children:[jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900 border-b border-blue-700 shadow-xl sticky top-0 z-50 pt-safe-top",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:jsxRuntimeExports.jsx("img",{src:"/mbfd-checkout-system/mbfd_logo.jpg",alt:"MBFD",className:"w-full h-full object-contain rounded-lg"})}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-white truncate",children:"Admin Dashboard"}),jsxRuntimeExports.jsx("p",{className:"text-xs sm:text-sm text-blue-200 mt-0.5 hidden sm:block",children:"MBFD Fleet Management System"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[jsxRuntimeExports.jsxs(Button,{onClick:()=>D("/"),variant:"secondary",className:"hidden sm:flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white border-white/20",size:"sm",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"hidden lg:inline",children:"Back to Login"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>Q(!$),className:"sm:hidden p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors","aria-label":"Toggle menu",children:$?jsxRuntimeExports.jsx(X,{className:"w-6 h-6 text-white"}):jsxRuntimeExports.jsx(Menu,{className:"w-6 h-6 text-white"})})]})]}),jsxRuntimeExports.jsx("div",{className:`${$?"block":"hidden sm:block"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex gap-1 border-b border-blue-700 overflow-x-auto pb-px scrollbar-hide",children:[jsxRuntimeExports.jsx(TabButton,{icon:House,label:"Home",isActive:T==="home",onClick:()=>ct("home")}),jsxRuntimeExports.jsx(TabButton,{icon:CircleAlert,label:"Inspection Issues",badge:s.length,isActive:T==="fleet",onClick:()=>ct("fleet")}),jsxRuntimeExports.jsx(TabButton,{icon:Calendar,label:"Daily Activity",isActive:T==="activity",onClick:()=>ct("activity")}),jsxRuntimeExports.jsx(TabButton,{icon:Package,label:"Supply Alerts",badge:d.length,isActive:T==="supplies",onClick:()=>ct("supplies")}),jsxRuntimeExports.jsx(TabButton,{icon:Warehouse,label:"Inventory",badge:h,isActive:T==="inventory",onClick:()=>ct("inventory")}),jsxRuntimeExports.jsx(TabButton,{icon:List,label:"Forms",isActive:T==="forms",onClick:()=>ct("forms")}),jsxRuntimeExports.jsx(TabButton,{icon:Truck,label:"Apparatus Status",isActive:T==="apparatus-status",onClick:()=>ct("apparatus-status")}),jsxRuntimeExports.jsx(TabButton,{icon:Mail,label:"Notifications",isActive:T==="notifications",onClick:()=>ct("notifications")}),jsxRuntimeExports.jsx(TabButton,{icon:Brain,label:"AI Insights",badge:L,badgeColor:"red",isActive:T==="insights",onClick:()=>ct("insights")})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[T==="home"&&jsxRuntimeExports.jsx(DashboardHome,{adminPassword:o}),T==="fleet"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Equipment & Vehicle Issues by Apparatus / Unit"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:yt.map(Y=>{const dt=n.get(Y)||0,pt=dt===0;return jsxRuntimeExports.jsx("div",{className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>tt(Y),children:jsxRuntimeExports.jsx(Card,{className:pt?"border-green-500":"border-red-500",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx(Truck,{className:`w-8 h-8 ${pt?"text-green-500":"text-red-500"}`}),pt?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-6 h-6 text-green-500"}):jsxRuntimeExports.jsx(CircleAlert,{className:"w-6 h-6 text-red-500"})]}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:Y}),jsxRuntimeExports.jsx("p",{className:`text-sm font-semibold ${pt?"text-green-600":"text-red-600"}`,children:pt?"âœ“ No Issues":`${dt} Issue${dt!==1?"s":""}`}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Click to view history"})]})})},Y)})})]}),jsxRuntimeExports.jsx("div",{className:"border-b border-gray-200 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>at("defects"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${G==="defects"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5"}),"Open Issues (",s.length,")"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{at("history"),w.length===0&&!M&&Z()},className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${G==="history"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Calendar,{className:"w-5 h-5"}),"Inspection History (Last 30 Days)",p&&jsxRuntimeExports.jsxs("span",{className:"text-sm text-blue-600",children:["- ",p]})]})]})}),G==="defects"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search defects...",className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",value:S,onChange:Y=>F(Y.target.value)}),jsxRuntimeExports.jsxs("select",{value:U||"",onChange:Y=>W(Y.target.value||null),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Apparatus"}),yt.map(Y=>jsxRuntimeExports.jsx("option",{value:Y,children:Y},Y))]})]}),s.length===0?jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Open Issues"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-1",children:"All apparatus equipment and inventory are fully operational"})]})}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:s.filter(Y=>(!U||Y.apparatus===U)&&(Y.item.toLowerCase().includes(S.toLowerCase())||Y.compartment.toLowerCase().includes(S.toLowerCase())||Y.apparatus.toLowerCase().includes(S.toLowerCase()))).sort((Y,dt)=>Y.apparatus.localeCompare(dt.apparatus)||Y.compartment.localeCompare(dt.compartment)||Y.item.localeCompare(dt.item)).map(Y=>jsxRuntimeExports.jsx(Card,{className:"hover:shadow-md transition-shadow",children:jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[jsxRuntimeExports.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:Y.apparatus}),jsxRuntimeExports.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${Y.status==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:Y.status==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:[Y.compartment,": ",Y.item]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:["Reported by ",Y.reportedBy," on ",formatDateTime(Y.reportedAt)]}),Y.notes&&jsxRuntimeExports.jsx("p",{className:"text-gray-700 text-sm bg-gray-50 p-3 rounded-lg mb-2 break-words",children:Y.notes.split(`
`).slice(0,3).join(`
`)}),Y.photoUrl&&jsxRuntimeExports.jsx("div",{className:"mt-3",children:jsxRuntimeExports.jsxs("button",{onClick:()=>k(Y.photoUrl||null),className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors border border-blue-200",children:[jsxRuntimeExports.jsx(Image$1,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold",children:"View Photo"})]})})]}),jsxRuntimeExports.jsx("div",{className:"md:text-right flex-shrink-0",children:jsxRuntimeExports.jsxs(Button,{onClick:()=>{B(Y),l("")},className:"bg-green-600 hover:bg-green-700",size:"sm",children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 mr-2"}),"Resolve"]})})]})})},`${Y.apparatus}-${Y.item}-${Y.issueNumber}`))})]}),G==="history"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:p&&jsxRuntimeExports.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:["Filtered: ",p]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[p&&jsxRuntimeExports.jsx(Button,{onClick:Z,variant:"secondary",size:"sm",children:"View All"}),jsxRuntimeExports.jsx(Button,{onClick:()=>p?tt(p):Z(),variant:"secondary",size:"sm",disabled:M,children:M?"Loading...":"Refresh"})]})]}),M?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Loading inspection logs..."})]}):w.length===0?jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(Calendar,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:p?`No inspection logs found for ${p} in the last 30 days.`:"No inspection logs found. Click an apparatus card in Fleet Status to view its history."})]})}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:w.map(Y=>{const dt=Y.title.match(/\[(.+)\]\s+Daily Inspection\s*-\s*(.+)/),pt=dt?dt[1]:"Unknown",_t=dt?dt[2]:formatDateTime(Y.created_at),Ct=Y.body?.match(/\*\*Conducted By:\*\*\s*(.+?)\s*\((.+?)\)/),Mt=Ct?Ct[1]:"Unknown",rt=Ct?Ct[2]:"",V=Y.body?.match(/\*\*Total Items Checked:\*\*\s*(\d+)/),q=V?parseInt(V[1]):0,lt=Y.body?.match(/\*\*Issues Found:\*\*\s*(\d+)/),ft=lt?parseInt(lt[1]):0,gt=Y.body?.match(/\[View Full Printable Receipt\]\((.+?)\)/),bt=gt?gt[1]:null,wt=Y.body?.match(/### Issues Reported\n([\s\S]+?)(?:\n\n|$)/),St=wt?wt[1].split(`
`).filter(Rt=>Rt.trim().startsWith("-")):[];return jsxRuntimeExports.jsx(Card,{className:"hover:shadow-md transition-shadow",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[jsxRuntimeExports.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:pt}),ft===0?jsxRuntimeExports.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold flex items-center gap-1",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),"All Clear"]}):jsxRuntimeExports.jsxs("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-semibold flex items-center gap-1",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-4 h-4"}),ft," Issue",ft!==1?"s":""]})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[jsxRuntimeExports.jsx("strong",{children:"Inspector:"})," ",Mt," ",rt&&`(${rt})`]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:[jsxRuntimeExports.jsx("strong",{children:"Date:"})," ",_t," â€¢ ",jsxRuntimeExports.jsx("strong",{children:"Items Checked:"})," ",q]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right text-xs text-gray-500 flex-shrink-0",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-600",children:Mt})," ",rt&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-gray-600",children:[" (",rt,")"]})]})]}),St.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4 bg-red-50 border-l-4 border-red-500 p-3 rounded",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"Reported Issues:"}),jsxRuntimeExports.jsx("ul",{className:"text-sm text-red-800 space-y-1",children:St.map((Rt,At)=>jsxRuntimeExports.jsx("li",{className:"pl-2 break-words",children:Rt.replace(/^-\s*/,"")},At))})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-gray-200",children:[bt&&jsxRuntimeExports.jsx("a",{href:bt,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded text-sm font-semibold transition-colors",children:"ðŸ“‹ View Receipt"}),jsxRuntimeExports.jsx("a",{href:`https://github.com/pdarleyjr/mbfd-checkout-system/issues/${Y.number}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm font-semibold transition-colors",children:"View on GitHub â†’"})]})]})},Y.number)})})]}),jsxRuntimeExports.jsx(Modal,{isOpen:N!==null,onClose:()=>{x||(B(null),l(""))},title:"Resolve Defect",children:N&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Apparatus"}),jsxRuntimeExports.jsx("p",{className:"font-semibold text-gray-900",children:N.apparatus})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Defect"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-gray-900",children:[N.compartment,": ",N.item]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Status"}),jsxRuntimeExports.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-semibold ${N.status==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:N.status==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"resolution-note",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Resolution Notes (Optional)"}),jsxRuntimeExports.jsx("textarea",{id:"resolution-note",value:C,onChange:Y=>l(Y.target.value),placeholder:"Describe how this defect was resolved...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none",rows:4,disabled:x})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-4",children:[jsxRuntimeExports.jsx(Button,{onClick:xt,className:"flex-1 bg-green-600 hover:bg-green-700",disabled:x,children:x?"Resolving...":"Confirm Resolution"}),jsxRuntimeExports.jsx(Button,{onClick:()=>{B(null),l("")},variant:"secondary",disabled:x,children:"Cancel"})]})]})}),E&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 p-4",onClick:()=>k(null),children:[jsxRuntimeExports.jsx("button",{onClick:()=>k(null),className:"absolute top-4 right-4 p-2 bg-white rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:jsxRuntimeExports.jsx(X,{className:"w-6 h-6 text-gray-900"})}),jsxRuntimeExports.jsx("img",{src:E,alt:"Defect photo",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:Y=>Y.stopPropagation()})]})]}),T==="activity"&&jsxRuntimeExports.jsx("div",{className:"space-y-6",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Calendar,{className:"w-6 h-6"}),"Daily Activity - ",vt]}),jsxRuntimeExports.jsx(Card,{className:"mb-6",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Today's Submissions"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:yt.map(Y=>{const dt=c?.today.includes(Y)||!1;return jsxRuntimeExports.jsxs("div",{className:`p-4 rounded-lg border-2 ${dt?"bg-green-50 border-green-500":"bg-gray-50 border-gray-300"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx(Truck,{className:`w-6 h-6 ${dt?"text-green-600":"text-gray-400"}`}),dt?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5 text-green-600"}):jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5 text-gray-400"})]}),jsxRuntimeExports.jsx("p",{className:"font-bold text-gray-900",children:Y}),jsxRuntimeExports.jsx("p",{className:`text-sm font-semibold ${dt?"text-green-600":"text-gray-500"}`,children:dt?"âœ“ Submitted":"Pending"})]},Y)})})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-5 h-5"}),"Submission Statistics (Last 30 Days)"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:yt.map(Y=>{const dt=c?.totals.get(Y)||0,pt=c?.lastSubmission.get(Y),_t=Math.round(dt/30*100);return jsxRuntimeExports.jsxs("div",{className:"border-b border-gray-200 pb-3 last:border-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(Truck,{className:"w-5 h-5 text-blue-600"}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:Y})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-blue-600",children:dt}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"submissions"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[jsxRuntimeExports.jsxs("span",{children:[_t,"% compliance rate"]}),pt&&jsxRuntimeExports.jsxs("span",{children:["Last: ",pt]})]}),jsxRuntimeExports.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:`h-2 rounded-full ${_t>=80?"bg-green-500":_t>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(_t,100)}%`}})})]},Y)})})]})})]})}),T==="supplies"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-6 h-6 text-orange-600"}),"Supply Alerts"]}),d.length===0?jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Supply Concerns"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mt-1",children:"All items are adequately stocked"})]})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 rounded",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-orange-800",children:[jsxRuntimeExports.jsx("strong",{children:"Note:"})," Items listed below have been reported missing multiple times across different apparatus in the last 30 days. This may indicate a supply shortage requiring attention."]})}),d.map((Y,dt)=>jsxRuntimeExports.jsx(Card,{className:"border-orange-300",children:jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-6 h-6 text-orange-600"}),jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:[Y.compartment,": ",Y.item]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("strong",{children:["Reported missing ",Y.occurrences," time",Y.occurrences!==1?"s":""]})," in the last 30 days"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Affected apparatus:"}),Y.apparatus.map(pt=>jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs font-semibold",children:pt},pt))]})]})]}),jsxRuntimeExports.jsx("div",{className:"ml-4",children:jsxRuntimeExports.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full",children:jsxRuntimeExports.jsx("span",{className:"text-xl font-bold text-orange-600",children:Y.occurrences})})})]})})},dt))]})]}),T==="inventory"&&jsxRuntimeExports.jsx(InventoryTab,{}),T==="forms"&&jsxRuntimeExports.jsx(FormsTab,{adminPassword:o}),T==="apparatus-status"&&jsxRuntimeExports.jsx(ApparatusStatusTab,{}),T==="insights"&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(AIFleetInsights,{adminPassword:o,onCriticalAlertCount:y})}),T==="notifications"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Email Notifications"}),jsxRuntimeExports.jsxs(Button,{onClick:mt,variant:"secondary",className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Mail,{className:"w-5 h-5"}),"Send Test Digest"]})]}),nt&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:nt}),z?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading configuration..."})]}):_?jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Notifications"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:_.enabled?"Notifications are currently enabled":"Notifications are currently disabled"})]}),jsxRuntimeExports.jsx(Button,{onClick:()=>ut({enabled:!_.enabled}),className:_.enabled?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",disabled:et,children:_.enabled?"Disable":"Enable"})]})})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Mode"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("input",{type:"radio",name:"email_mode",value:"daily_digest",checked:_.email_mode==="daily_digest",onChange:Y=>ut({email_mode:Y.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Daily Digest (Recommended)"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["Send one summary email per day at ",_.digest_send_time]})]})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("input",{type:"radio",name:"email_mode",value:"per_submission",checked:_.email_mode==="per_submission",onChange:Y=>ut({email_mode:Y.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Per Submission"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Send an email immediately after each inspection"})]})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("input",{type:"radio",name:"email_mode",value:"hybrid",checked:_.email_mode==="hybrid",onChange:Y=>ut({email_mode:Y.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Hybrid"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Immediate for critical defects, daily digest for routine"})]})]})]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Recipients"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[_.recipients.map((Y,dt)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"email",value:Y,onChange:pt=>{const _t=[..._.recipients];_t[dt]=pt.target.value,H({..._,recipients:_t})},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"email@example.com"}),jsxRuntimeExports.jsx(Button,{onClick:()=>{const pt=_.recipients.filter((_t,Ct)=>Ct!==dt);ut({recipients:pt})},variant:"secondary",className:"bg-red-50 hover:bg-red-100 text-red-700",children:"Remove"})]},dt)),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>{const Y=[..._.recipients,""];H({..._,recipients:Y})},variant:"secondary",children:"+ Add Recipient"}),jsxRuntimeExports.jsx(Button,{onClick:()=>ut({recipients:_.recipients.filter(Y=>Y!=="")}),disabled:et,children:"Save Recipients"})]})]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:_.enable_immediate_for_critical,onChange:Y=>ut({enable_immediate_for_critical:Y.target.checked}),className:"mt-1 w-5 h-5 text-blue-600 rounded"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:"Immediate Alerts for Critical Defects"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Send immediate email when critical defects are found (only in hybrid mode)"})]})]})})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Daily Email Limit"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("input",{type:"number",value:_.daily_email_hard_cap,onChange:Y=>H({..._,daily_email_hard_cap:parseInt(Y.target.value)||250}),className:"w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"500"}),jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"emails per day (max: 500)"}),jsxRuntimeExports.jsx(Button,{onClick:()=>ut({daily_email_hard_cap:_.daily_email_hard_cap}),disabled:et,children:"Save"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current: ",_.daily_email_hard_cap," / Recommended: 250"]})]})})]}):jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(Mail,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:"Click the button below to load email configuration"}),jsxRuntimeExports.jsx(Button,{onClick:ht,children:"Load Configuration"})]})})]})]})]})},TabButton=({icon:D,label:i,badge:R,badgeColor:o="red",isActive:f,onClick:I})=>{const A=i==="Home"?"Home":i==="Inspection Issues"?"Issues":i==="Daily Activity"?"Activity":i==="Supply Alerts"?"Supplies":i==="Apparatus Status"?"Apparatus":i==="AI Insights"?"AI":i;return jsxRuntimeExports.jsxs("button",{onClick:I,className:`flex items-center gap-2 px-3 sm:px-4 lg:px-6 py-2 sm:py-3 font-semibold transition-all whitespace-nowrap relative flex-shrink-0 text-sm sm:text-base ${f?"text-white border-b-2 border-white bg-white/10":"text-blue-200 hover:text-white hover:bg-white/5"}`,children:[jsxRuntimeExports.jsx(D,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:i}),jsxRuntimeExports.jsx("span",{className:"sm:hidden",children:A}),R!==void 0&&R>0&&jsxRuntimeExports.jsx("span",{className:`${o==="red"?"bg-red-500":"bg-yellow-500"} text-white text-xs px-2 py-0.5 rounded-full font-bold min-w-[20px] text-center`,children:R})]})};export{AdminDashboard};
//# sourceMappingURL=AdminDashboard-CGMzfuw_.js.map
