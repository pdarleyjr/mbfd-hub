import{r as d,j as e,u as Se}from"./index-CTqLvJ19.js";import{c as R,b as M,B as p,W as de,u as Ce,F as $e,C as Ie,d as De,a as Ee,s as Pe,e as Fe}from"./useApparatusStatus-D3iYQgib.js";import{C as ge,X as le,T as V,M as X,U as pe,g as ce,a as Me,b as fe}from"./github-DwNqGJYJ.js";const Te=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],be=R("camera",Te);const _e=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Ue=R("check-check",_e);const Oe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Re=R("chevron-left",Oe);const Le=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ae=R("chevron-right",Le);const Be=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],ze=R("gauge",Be);const Ve=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],He=R("shield",Ve);const qe=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],ye=R("wrench",qe),We=({item:n,status:l,hasExistingDefect:t,onStatusChange:h,compartmentId:f})=>{const[$,i]=d.useState(!1),[u,x]=d.useState("missing"),[b,I]=d.useState(""),[Z,v]=d.useState(!1),[E,ee]=d.useState(""),[L,H]=d.useState(null),[T,se]=d.useState(null),[w,N]=d.useState(!1),[P,j]=d.useState(null),[D,A]=d.useState(null),k=typeof n=="string"?n:n.name,q=typeof n=="object"?n.expectedQuantity:void 0,_=typeof n=="object"?n.note:void 0,te=(typeof n=="object"?n.inputType:"checkbox")==="radio"||typeof n=="object"&&n.name.toLowerCase().includes("radio"),S=c=>{c==="present"?t?v(!0):(h("present",void 0,void 0,void 0,E),I("")):(x(c),i(!0))},F=c=>{c==="fixed"?h("present","Item has been fixed and is now back in service",void 0,"fixed"):c==="still_damaged"?h("damaged","Issue still present - previously reported",void 0,"still_damaged"):h("present"),v(!1)},W=c=>{const y=c.target.files?.[0];if(!y)return;if(!["image/jpeg","image/png","image/webp","image/gif"].includes(y.type)){j("Please select a valid image file (JPG, PNG, WEBP, or GIF)");return}const Q=10*1024*1024;if(y.size>Q){j("File size must be less than 10MB");return}H(y),j(null);const K=new FileReader;K.onload=Y=>{se(Y.target?.result)},K.readAsDataURL(y)},B=()=>{H(null),se(null),A(null),j(null)},G=async()=>{if(!L)return null;N(!0),j(null);try{const c=new FormData;c.append("file",L),c.append("inspector","Inspector"),c.append("apparatus",f.split("-")[0]||"Unknown"),c.append("item",k),c.append("reportedAt",new Date().toISOString());const y=await fetch(`${de}/api/uploads`,{method:"POST",body:c});if(!y.ok){const Q=await y.json();throw new Error(Q.error||"Upload failed")}const J=await y.json();return A(J.photoUrl),J.photoUrl}catch(c){const y=c instanceof Error?c.message:"Failed to upload image";return j(y),null}finally{N(!1)}},ae=async()=>{if(!b.trim()){alert("Please enter notes describing the issue");return}let c=D;L&&!D&&(c=await G(),!c&&P&&!confirm(`Photo upload failed: ${P}

Do you want to submit without the photo?`))||(h(u,b,c||void 0,void 0,E),i(!1),I(""),B())},z=()=>{i(!1),I(""),B()};return te?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:M("p-4 rounded-2xl transition-all duration-200 border-2 shadow-sm space-y-3",{"bg-white border-gray-200 hover:border-gray-300":l==="present"&&!t,"bg-green-50 border-green-500 shadow-green-100":l==="present"&&!t,"bg-red-50 border-red-500 shadow-red-100":l==="missing","bg-yellow-50 border-yellow-500 shadow-yellow-100":l==="damaged","bg-orange-50 border-orange-500 shadow-orange-100":t}),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-3",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-base leading-tight",children:k}),_&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:_}),t&&e.jsx("span",{className:"inline-block mt-2 px-3  py-1 bg-orange-600 text-white text-xs font-bold rounded-full shadow-sm",children:"âš ï¸ Previously Reported"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>S("present"),className:M("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",l==="present"?"bg-green-500 text-white shadow-lg scale-105 shadow-green-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Present/Working",children:e.jsx(ge,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>S("missing"),className:M("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",l==="missing"?"bg-red-500 text-white shadow-lg scale-105 shadow-red-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Missing",children:e.jsx(le,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>S("damaged"),className:M("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",l==="damaged"?"bg-yellow-500 text-white shadow-lg scale-105 shadow-yellow-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Damaged",children:e.jsx(V,{className:"w-7 h-7 stroke-[3]"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-600 mb-1",children:"Radio Number (Optional):"}),e.jsx("input",{type:"text",value:E,onChange:c=>ee(c.target.value),placeholder:"Enter radio #",className:"w-full px-3 py-2 text-sm rounded-lg border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-600 outline-none bg-white text-gray-900 font-medium"})]})]}),e.jsx(X,{isOpen:Z,onClose:()=>v(!1),title:`Previously Reported Issue: "${k}"`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-300 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-orange-900 font-semibold mb-2",children:"âš ï¸ This item was previously reported as defective."}),e.jsx("p",{className:"text-xs text-orange-800",children:"Please select the current status of this item:"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(p,{onClick:()=>F("fixed"),className:"w-full h-14 text-base font-bold rounded-xl bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 flex items-center justify-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Fixed / Back in Service"]}),e.jsxs(p,{onClick:()=>F("still_damaged"),variant:"secondary",className:"w-full h-14 text-base font-bold rounded-xl bg-yellow-100 hover:bg-yellow-200 text-yellow-900 flex items-center justify-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Still Damaged / Missing"]}),e.jsx(p,{onClick:()=>F("no_change"),variant:"secondary",className:"w-full h-12 text-sm font-bold rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Skip - No Change"})]})]})}),e.jsx(X,{isOpen:$,onClose:z,title:`Item ${u==="missing"?"Missing":"Damaged"}: "${k}"`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-gradient-to-r from-gray-50 to-gray-100",children:[u==="missing"?e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"w-6 h-6 text-red-600"})}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0",children:e.jsx(V,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600",children:u==="missing"?"Missing Equipment":"Damaged Equipment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Please provide detailed information"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{value:b,onChange:c=>I(c.target.value),placeholder:"Describe the issue in detail...",rows:4,className:"w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-4 focus:ring-blue-400 focus:border-blue-500 outline-none transition-all resize-none text-base",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Provide as much detail as possible to help with resolution"})]}),te&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Radio Number (if known)"}),e.jsx("input",{type:"text",value:E,onChange:c=>ee(c.target.value),placeholder:"Enter radio # if known",className:"w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-600 outline-none bg-white text-gray-900"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-4",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"ðŸ“¸ Photo (Optional)"}),T?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:T,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:B,variant:"secondary",size:"sm",className:"flex-1",children:"Remove Photo"}),!D&&e.jsx(p,{onClick:G,disabled:w,size:"sm",className:"flex-1 flex items-center justify-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4"}),"Upload Now"]})}),D&&e.jsx("span",{className:"flex-1 text-sm text-green-600 font-semibold flex items-center justify-center gap-1",children:"âœ“ Uploaded"})]}),P&&e.jsx("p",{className:"text-xs text-red-600",children:P})]}):e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:W,className:"hidden",id:"photo-upload-radio"}),e.jsxs("label",{htmlFor:"photo-upload-radio",className:"flex flex-col items-center justify-center py-6 cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Take Photo or Upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JPG, PNG, WEBP, or GIF (max 10MB)"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(p,{onClick:ae,className:"flex-1 h-12 text-base font-bold rounded-xl",disabled:w,children:"Submit Report"}),e.jsx(p,{onClick:z,variant:"secondary",className:"flex-1 h-12 text-base font-bold rounded-xl",disabled:w,children:"Cancel"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:M("flex items-center justify-between p-4 rounded-2xl transition-all duration-200 border-2 shadow-sm",{"bg-white border-gray-200 hover:border-gray-300":l==="present"&&!t,"bg-green-50 border-green-500 shadow-green-100":l==="present"&&!t,"bg-red-50 border-red-500 shadow-red-100":l==="missing","bg-yellow-50 border-yellow-500 shadow-yellow-100":l==="damaged","bg-orange-50 border-orange-500 shadow-orange-100":t}),children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-3",children:[e.jsxs("p",{className:"font-semibold text-gray-900 text-base leading-tight",children:[k,q&&e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",q,")"]})]}),_&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:_}),t&&e.jsx("span",{className:"inline-block mt-2 px-3 py-1 bg-orange-600 text-white text-xs font-bold rounded-full shadow-sm",children:"âš ï¸ Previously Reported"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>S("present"),className:M("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",l==="present"?"bg-green-500 text-white shadow-lg scale-105 shadow-green-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Present/Working",children:e.jsx(ge,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>S("missing"),className:M("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",l==="missing"?"bg-red-500 text-white shadow-lg scale-105 shadow-red-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Missing",children:e.jsx(le,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>S("damaged"),className:M("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",l==="damaged"?"bg-yellow-500 text-white shadow-lg scale-105 shadow-yellow-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Damaged",children:e.jsx(V,{className:"w-7 h-7 stroke-[3]"})})]})]}),e.jsx(X,{isOpen:Z,onClose:()=>v(!1),title:`Previously Reported Issue: "${k}"`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-300 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-orange-900 font-semibold mb-2",children:"âš ï¸ This item was previously reported as defective."}),e.jsx("p",{className:"text-xs text-orange-800",children:"Please select the current status of this item:"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(p,{onClick:()=>F("fixed"),className:"w-full h-14 text-base font-bold rounded-xl bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 flex items-center justify-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Fixed / Back in Service"]}),e.jsxs(p,{onClick:()=>F("still_damaged"),variant:"secondary",className:"w-full h-14 text-base font-bold rounded-xl bg-yellow-100 hover:bg-yellow-200 text-yellow-900 flex items-center justify-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Still Damaged / Missing"]}),e.jsx(p,{onClick:()=>F("no_change"),variant:"secondary",className:"w-full h-12 text-sm font-bold rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Skip - No Change"})]})]})}),e.jsx(X,{isOpen:$,onClose:z,title:`Item ${u==="missing"?"Missing":"Damaged"}: "${k}"`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-gradient-to-r from-gray-50 to-gray-100",children:[u==="missing"?e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"w-6 h-6 text-red-600"})}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0",children:e.jsx(V,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600",children:u==="missing"?"Missing Equipment":"Damaged Equipment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Please provide detailed information"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{value:b,onChange:c=>I(c.target.value),placeholder:"Describe the issue in detail...",rows:4,className:"w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-4 focus:ring-blue-400 focus:border-blue-500 outline-none transition-all resize-none text-base",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Provide as much detail as possible to help with resolution"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-4",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"ðŸ“¸ Photo (Optional)"}),T?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:T,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:B,variant:"secondary",size:"sm",className:"flex-1",children:"Remove Photo"}),!D&&e.jsx(p,{onClick:G,disabled:w,size:"sm",className:"flex-1 flex items-center justify-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4"}),"Upload Now"]})}),D&&e.jsx("span",{className:"flex-1 text-sm text-green-600 font-semibold flex items-center justify-center gap-1",children:"âœ“ Uploaded"})]}),P&&e.jsx("p",{className:"text-xs text-red-600",children:P})]}):e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:W,className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"flex flex-col items-center justify-center py-6 cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Take Photo or Upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JPG, PNG, WEBP, or GIF (max 10MB)"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(p,{onClick:ae,className:"flex-1 h-12 text-base font-bold rounded-xl",disabled:w,children:"Submit Report"}),e.jsx(p,{onClick:z,variant:"secondary",className:"flex-1 h-12 text-base font-bold rounded-xl",disabled:w,children:"Cancel"})]})]})})]})},Ge=()=>{const[n,l]=d.useState(()=>{const t=window.innerWidth,h=window.innerHeight;return{isMobile:t<768,isTablet:t>=768&&t<1024,isDesktop:t>=1024,screenWidth:t,screenHeight:h,orientation:t>h?"landscape":"portrait"}});return d.useEffect(()=>{const t=()=>{const h=window.innerWidth,f=window.innerHeight;l({isMobile:h<768,isTablet:h>=768&&h<1024,isDesktop:h>=1024,screenWidth:h,screenHeight:f,orientation:h>f?"landscape":"portrait"})};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),n};function ve(n,l){const t=()=>{if(typeof window>"u")return l;try{const i=window.localStorage.getItem(n);return i?JSON.parse(i):l}catch(i){return console.warn(`Error reading localStorage key "${n}":`,i),l}},[h,f]=d.useState(t),$=i=>{try{const u=i instanceof Function?i(h):i;f(u),typeof window<"u"&&window.localStorage.setItem(n,JSON.stringify(u))}catch(u){console.warn(`Error setting localStorage key "${n}":`,u)}};return d.useEffect(()=>{f(t())},[]),[h,$]}function Je(n,l=10){const[t,h]=ve(`field_history_${n}`,[]);return{history:t,addToHistory:i=>{!i||!i.trim()||h(u=>{const x=u.filter(I=>I!==i);return[i,...x].slice(0,l)})},clearHistory:()=>{h([])}}}const Ze=()=>{const n=Se(),l=Ge(),[t,h]=d.useState(null),[f,$]=d.useState(null),[i,u]=d.useState(0),[x,b]=d.useState(new Map),[I,Z]=d.useState(new Map),[v,E]=d.useState([]),[ee,L]=d.useState(!0),[H,T]=d.useState(!1),[se,w]=d.useState(!1),[N,P]=d.useState(0),[j,D]=d.useState(""),[A,k]=d.useState(!1),{statuses:q,getVehicleNumber:_}=Ce(),[he,te]=d.useState(!1),[S,F]=d.useState(),[W,B]=ve("mbfd_last_officer_values",{});d.useEffect(()=>{const s=sessionStorage.getItem("user");if(!s){n("/");return}const a=JSON.parse(s);h(a),G(a)},[n]),d.useEffect(()=>{if(t&&q.length>0){const s=_(t.apparatus);s&&(F(s),t.unitNumber&&t.unitNumber!==s&&te(!0))}},[t,q,_]);const G=async s=>{try{let a=null;if($e)try{const r=await fetch(`${de}/api/forms/apparatus/${encodeURIComponent(s.apparatus)}`);r.ok?(a=await r.json(),console.log("Loaded checklist from dynamic forms API")):console.warn("Dynamic forms API failed, falling back to static files")}catch(r){console.error("Dynamic form load failed, using static fallback:",r)}if(!a){let r;s.apparatus.startsWith("Engine")?r="engine_checklist.json":s.apparatus==="Ladder 1"?r="ladder1_checklist.json":s.apparatus==="Ladder 3"?r="ladder3_checklist.json":s.apparatus==="Rope Inventory"?r="rope_checklist.json":r="rescue_checklist.json",a=await(await fetch(`/mbfd-checkout-system/data/${r}`)).json(),console.log("Loaded checklist from static file:",r)}if(!a)throw new Error("Failed to load checklist data");$(a);const o=new Map;a.compartments.forEach(r=>{r.items.forEach(m=>{const O=typeof m=="string"?m:m.name,ie=`${r.id}:${O}`;o.set(ie,{name:O,status:"present",inputType:typeof m=="object"?m.inputType:"checkbox",expectedQuantity:typeof m=="object"?m.expectedQuantity:void 0})})}),b(o),a.officerChecklist&&E(a.officerChecklist.map(r=>({...r,checked:!1,value:W[r.id]||""})));const g=await ce.checkExistingDefects(s.apparatus);Z(g),L(!1)}catch(a){console.error("Error loading data:",a),alert("Error loading inspection data. Please try again."),L(!1)}},ae=(s,a,o,g)=>{b(r=>{const m=new Map(r),O=m.get(s);return O&&m.set(s,{...O,status:a,notes:o,photoUrl:g}),m})},z=(s,a,o)=>{E(g=>{const r=[...g];r[s]={...r[s],checked:a,value:o};const m={...W};return m[r[s].id]=o||"",B(m),r})},c=()=>{E(s=>s.map(a=>{let o=a.value||"";if(!a.value||a.value==="")switch(a.id){case"psi_front":case"psi_rear":o=115;break;case"brake_psi":o=120;break;case"m_cylinder_psi":o=1800;break;case"fuel_percent":o=100;break;case"def_percent":o=100;break;default:a.required&&a.inputType!=="checkbox"&&(o="N/A");break}return{...a,checked:!0,value:o}}))},y=()=>{C&&b(s=>{const a=new Map(s);return C.items.forEach(o=>{const g=typeof o=="string"?o:o.name,r=`${C.id}:${g}`,m=a.get(r);m&&a.set(r,{...m,status:"present"})}),a})},J=async()=>{if(!(!t||!f)){T(!0);try{const s=[];if(x.forEach(a=>{if(a.status!=="present"){const o=f.compartments.find(g=>g.items.some(r=>(typeof r=="string"?r:r.name)===a.name));s.push({compartment:o?.title||"Unknown",item:a.name,status:a.status,notes:a.notes||"",photoUrl:a.photoUrl})}}),await ce.submitChecklist({user:t,apparatus:t.apparatus,date:new Date().toISOString(),items:Array.from(x.values()),defects:s,shift:t.shift,unitNumber:t.unitNumber,officerChecklist:v}),he&&S&&t.unitNumber!==S)try{await Pe({apparatus:t.apparatus,oldVehicleNo:S,newVehicleNo:t.unitNumber,reportedBy:t.name,notes:`Vehicle change detected during inspection on ${new Date().toLocaleDateString()}`}),console.log("Vehicle change request submitted successfully")}catch(a){console.error("Failed to submit vehicle change request (non-critical):",a)}try{const a=x.size,o=Array.from(x.values()).filter(m=>m.status==="present").length;let g="rescue";t.apparatus.startsWith("Engine")?g="engine":t.apparatus.startsWith("Ladder")?g="ladder":t.apparatus==="Rope Inventory"&&(g="rope");const r=s.map(m=>({item:m.item,category:m.compartment,severity:m.status==="missing"?"critical":"high"}));await ce.sendNotification({apparatus:t.apparatus,operator:t.name,checklistType:g,totalItems:a,completedItems:o,defects:r,githubIssueUrl:void 0}),console.log("Notification queued/sent successfully")}catch(a){console.error("Failed to send notification (non-critical):",a)}if(s.length>0)try{const a=s.map(o=>({apparatus:t.apparatus,compartment:o.compartment,item:o.item,deficiencyType:o.status,createdBy:t.name,notes:o.notes||void 0}));await Fe(a),console.log(`Successfully created ${a.length} supply task(s)`)}catch(a){console.error("Failed to create supply tasks (non-critical):",a)}sessionStorage.removeItem("user"),P(s.length),w(!0)}catch(s){console.error("Error submitting inspection:",s);let a="Error submitting inspection. Please try again.";s instanceof Error&&(s.message.includes("Failed to fetch")?a="No internet connection. Please check your connection and try again.":s.message.includes("defect submissions failed")&&(a="Some defects failed to submit. Please check your connection and try again. Partial data may have been recorded.")),alert(a)}finally{T(!1)}}},Q=async()=>{if(!j||!j.includes("@")){alert("Please enter a valid email address");return}k(!0);try{const s=`MBFD Inspection Summary - ${t?.apparatus} - ${new Date().toLocaleDateString()}`,a=`
MBFD Inspection Summary

Apparatus: ${t?.apparatus}
Operator: ${t?.name} (${t?.rank})
Shift: ${t?.shift}
Unit Number: ${t?.unitNumber}
Date: ${new Date().toLocaleString()}
Defects Found: ${N}

${v.length>0?`
Officer Checklist:
${v.map(r=>`- ${r.name}: ${r.checked?"âœ“":"âœ—"} ${r.value?`(${r.value})`:""}`).join(`
`)}`:""}

This inspection has been recorded successfully.
${N>0?`
Issues have been logged and will be reviewed by maintenance.`:`
No issues were found during this inspection.`}

---
Generated by MBFD Checkout System
      `.trim(),o=`
<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
    .header { background-color: #1e40af; color: white; padding: 20px; }
    .content { padding: 20px; }
    .info-grid { display: grid; grid-template-columns: 150px 1fr; gap: 10px; margin: 20px 0; }
    .label { font-weight: bold; color: #555; }
    .value { color: #333; }
    .checklist { background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0; }
    .footer { background-color: #f9fafb; padding: 15px; text-align: center; color: #666; font-size: 12px; }
    .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-weight: bold; }
    .badge-success { background-color: #10b981; color: white; }
    .badge-warning { background-color: #f59e0b; color: white; }
  </style>
</head>
<body>
  <div class="header">
    <h1 style="margin: 0;">MBFD Inspection Summary</h1>
  </div>
  <div class="content">
    <div class="info-grid">
      <div class="label">Apparatus:</div>
      <div class="value">${t?.apparatus}</div>
      <div class="label">Operator:</div>
      <div class="value">${t?.name} (${t?.rank})</div>
      <div class="label">Shift:</div>
      <div class="value">${t?.shift}</div>
      <div class="label">Unit Number:</div>
      <div class="value">${t?.unitNumber}</div>
      <div class="label">Date:</div>
      <div class="value">${new Date().toLocaleString()}</div>
      <div class="label">Defects Found:</div>
      <div class="value"><span class="badge ${N===0?"badge-success":"badge-warning"}">${N}</span></div>
    </div>
    ${v.length>0?`
    <div class="checklist">
      <h3 style="margin-top: 0;">Officer Checklist</h3>
      <ul>`+v.map(r=>`<li><strong>${r.name}:</strong> ${r.checked?"âœ“":"âœ—"} ${r.value?`<em>(${r.value})</em>`:""}</li>`).join("")+`</ul>
    </div>
    `:""}
    <p style="margin-top: 20px;">
      ${N>0?"Issues have been logged and will be reviewed by maintenance.":"No issues were found during this inspection. All equipment is operational."}
    </p>
  </div>
  <div class="footer">
    Generated by MBFD Checkout System
  </div>
</body>
</html>
      `.trim(),g=await fetch(`${de}/api/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:j,subject:s,body:a,htmlBody:o})});if(!g.ok){const r=await g.json().catch(()=>({error:"Failed to send email"}));throw new Error(r.error||"Failed to send email")}alert("âœ… Inspection summary sent to your email!"),D("")}catch(s){console.error("Error sending email:",s),alert(`Failed to send email: ${s instanceof Error?s.message:"Unknown error"}`)}finally{k(!1)}},K=()=>{w(!1),n("/")};if(ee)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-semibold",children:"Loading inspection checklist..."})]})});if(!t||!f)return null;const Y=v.length>0,oe=(Y?1:0)+f.compartments.length,U=Y&&i===0,je=Y?i-1:i,C=U?null:f.compartments[je],we=i===oe-1,me=U?v.every(s=>s.inputType==="checkbox"?s.checked:s.required?s.checked&&s.value&&s.value.toString().trim()!=="":s.checked||s.value&&s.value.toString().trim()!==""):C?.items.every(s=>{const a=typeof s=="string"?s:s.name,o=`${C.id}:${a}`;return x.get(o)?.status!==void 0}),ue=new Date().toLocaleDateString("en-US",{weekday:"long"}),re=f.dailySchedule?.find(s=>s.day===ue),ne=l.isDesktop?"max-w-7xl mx-auto":l.isTablet?"max-w-4xl px-4":"max-w-2xl px-4",xe=l.isDesktop?"grid grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-gray-100 pb-24",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-800 via-blue-900 to-blue-800 text-white sticky top-0 z-10 shadow-2xl pt-safe-top",children:e.jsxs("div",{className:`${ne} mx-auto ${l.isDesktop?"px-6":"px-4"} py-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.apparatus}),e.jsxs("p",{className:"text-sm text-blue-100",children:[t.name," â€¢ ",t.rank]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-blue-200",children:["Shift ",t.shift]}),e.jsxs("p",{className:"text-sm font-semibold",children:["Unit ",t.unitNumber]}),l.isDesktop&&e.jsx("p",{className:"text-xs text-blue-300 mt-1",children:"ðŸ–¥ï¸ Desktop Mode"})]})]}),e.jsx("div",{className:"flex items-center gap-1.5",children:Array.from({length:oe}).map((s,a)=>e.jsx("div",{className:`h-2 flex-1 rounded-full transition-all duration-300 ${a<i?"bg-green-400":a===i?"bg-white":"bg-blue-600"}`},a))}),e.jsxs("p",{className:"text-xs text-blue-100 mt-2 text-center font-medium",children:["Step ",i+1," of ",oe]})]})}),re&&re.tasks.length>0&&re.tasks[0]!=="None"&&e.jsx("div",{className:`${ne} mx-auto ${l.isDesktop?"px-6":"px-4"} mt-4`,children:e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 border-2 border-amber-400 rounded-2xl p-4 shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{className:"w-6 h-6 text-amber-700 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-amber-900 mb-1",children:["Today's Schedule - ",ue]}),e.jsx("ul",{className:"space-y-1",children:re.tasks.map((s,a)=>e.jsxs("li",{className:"text-sm text-amber-800 font-medium",children:["â€¢ ",s]},a))})]})]})})}),e.jsx("div",{className:`${ne} mx-auto ${l.isDesktop?"px-6":"px-4"} py-6`,children:e.jsxs(Ie,{className:`shadow-2xl ${l.isDesktop?"rounded-xl":"rounded-2xl"}`,children:[e.jsx(De,{className:"bg-gradient-to-r from-gray-50 to-slate-50 border-b-2 border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[U?e.jsx(He,{className:"w-8 h-8 text-blue-700"}):e.jsx(ze,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:U?"Officer Checklist":C?.title}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:U?"Complete all officer-specific checks":"Check all equipment in this compartment"})]})]}),e.jsxs(p,{onClick:U?c:y,variant:"secondary",className:"flex items-center gap-2 h-10 px-4 text-sm font-bold bg-blue-100 hover:bg-blue-200 text-blue-800",children:[e.jsx(Ue,{className:"w-5 h-5"}),l.isMobile?"All OK":"Check All"]})]})}),e.jsx(Ee,{className:l.isDesktop?"p-6":"p-4",children:U?e.jsx("div",{className:xe,children:v.map((s,a)=>e.jsx(Qe,{item:s,index:a,onChange:z},s.id))}):e.jsx("div",{className:xe,children:C?.items.map(s=>{const a=typeof s=="string"?s:s.name,o=`${C.id}:${a}`,g=x.get(o),r=`${C.title}:${a}`,m=I.has(r),O=typeof s=="object"?s:{name:s,inputType:"checkbox"};return e.jsx(We,{item:O,compartmentId:C.id,status:g?.status||"present",hasExistingDefect:m,onStatusChange:(ie,Ne,ke)=>ae(o,ie,Ne,ke)},o)})})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-300 p-4 shadow-2xl pb-safe-bottom",children:e.jsxs("div",{className:`${ne} mx-auto ${l.isDesktop?"px-6":""} flex gap-3`,children:[i>0&&e.jsxs(p,{onClick:()=>u(i-1),variant:"secondary",className:"flex items-center gap-2 h-14 px-6 rounded-xl font-bold bg-gray-100 hover:bg-gray-200 text-gray-800",children:[e.jsx(Re,{className:"w-5 h-5"}),"Previous"]}),e.jsx("div",{className:"flex-1"}),we?e.jsx(p,{onClick:J,disabled:!me||H,className:"flex items-center gap-2 h-14 px-8 rounded-xl font-bold shadow-lg bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500",children:H?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-6 h-6"}),"Complete Inspection"]})}):e.jsxs(p,{onClick:()=>u(i+1),disabled:!me,className:"flex items-center gap-2 h-14 px-8 rounded-xl font-bold shadow-lg bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 disabled:from-gray-400 disabled:to-gray-500",children:["Next",e.jsx(Ae,{className:"w-5 h-5"})]})]})}),e.jsx(X,{isOpen:se,onClose:K,title:"Inspection Complete!",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(fe,{className:"w-12 h-12 text-green-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"âœ… Inspection Submitted Successfully!"}),e.jsxs("p",{className:"text-gray-700 font-medium",children:["Your ",t?.apparatus," inspection has been recorded."]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border-2 border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-800 font-semibold",children:[e.jsx("strong",{children:"Defects Reported:"})," ",N]}),N>0&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Issues have been logged and will be reviewed by maintenance."})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border-2 border-blue-200",children:[e.jsx("p",{className:"text-sm font-bold text-blue-900 mb-3",children:"ðŸ“§ Get a copy of this inspection via email"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"email",value:j,onChange:s=>D(s.target.value),placeholder:"Enter your email address",className:"w-full px-4 py-3 rounded-xl border-2 border-blue-300 focus:ring-4 focus:ring-blue-400 focus:border-blue-600 outline-none transition-all text-base",disabled:A}),e.jsx(p,{onClick:Q,disabled:A||!j,variant:"secondary",className:"w-full h-10 text-sm font-bold rounded-xl bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-400",children:A?"Sending...":"Send Summary"})]})]}),e.jsx(p,{onClick:K,className:"w-full h-12 text-base font-bold rounded-xl bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900",children:"Return to Home"})]})})]})},Qe=({item:n,index:l,onChange:t})=>{const{history:h,addToHistory:f}=Je(n.id),[$,i]=d.useState(!1),u=(x,b)=>{t(l,x,b),b&&typeof b=="string"&&f(b)};return n.inputType==="checkbox"?e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-white border-2 border-gray-300 transition-all hover:border-blue-400 shadow-sm",children:[e.jsx("input",{type:"checkbox",checked:n.checked,onChange:x=>u(x.target.checked),className:"w-10 h-10 rounded-lg border-2 border-gray-400 text-blue-600 focus:ring-4 focus:ring-blue-400 cursor-pointer"}),e.jsx("label",{className:"flex-1 font-semibold text-gray-900 cursor-pointer",children:n.name})]}):e.jsxs("div",{className:"p-4 rounded-xl bg-white border-2 border-gray-300 space-y-2 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.checked,onChange:()=>u(n.checked,n.value),className:"w-10 h-10 rounded border-2 border-gray-400 text-blue-600 cursor-pointer"}),e.jsxs("label",{className:"font-semibold text-gray-900 text-sm",children:[n.name,n.required&&e.jsx("span",{className:"text-red-600 ml-1",children:"*"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n.inputType==="number"||n.inputType==="percentage"?"number":"text",value:n.value||"",onChange:x=>u(n.checked,n.inputType==="number"?parseFloat(x.target.value)||"":x.target.value),onFocus:()=>i(!0),onBlur:()=>setTimeout(()=>i(!1),200),placeholder:n.inputType==="percentage"?"Enter %":n.inputType==="number"?"Enter number":"Enter value",className:"w-full px-3 py-3 text-base rounded-lg border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-600 outline-none bg-white text-gray-900 font-medium"}),$&&h.length>0&&n.inputType==="text"&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-40 overflow-y-auto",children:h.map((x,b)=>e.jsx("button",{onClick:()=>{u(!0,x),i(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-blue-50 transition-colors text-gray-900 font-medium",children:x},b))})]})]})};export{Ze as InspectionWizard};
//# sourceMappingURL=InspectionWizard-V5hY9QcM.js.map
