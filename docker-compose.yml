services:
  app:
    image: webdevops/php-nginx:8.3-alpine
    container_name: mbfd-hub-app
    restart: unless-stopped
    working_dir: /app
    environment:
      - WEB_DOCUMENT_ROOT=/app/public
      - PHP_MEMORY_LIMIT=512M
      - PHP_UPLOAD_MAX_FILESIZE=256M
      - PHP_POST_MAX_SIZE=256M
    volumes:
      - './laravel-app:/app'
    ports:
      - '127.0.0.1:8082:80'
    networks:
      - mbfd_net
    depends_on:
      - pgsql

  pgsql:
    image: 'postgres:16-alpine'
    container_name: mbfd-hub-db
    restart: unless-stopped
    environment:
      - POSTGRES_DB=mbfd_hub
      - POSTGRES_USER=mbfd_user
      - POSTGRES_PASSWORD=mbfd_secure_pass_2026
    volumes:
      - 'postgres_data:/var/lib/postgresql/data'
    networks:
      - mbfd_net
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U mbfd_user -d mbfd_hub"]
      retries: 3
      timeout: 5s
      interval: 10s

networks:
  mbfd_net:
    driver: bridge

volumes:
  postgres_data:
    driver: local
